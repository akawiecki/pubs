<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ania Kawiecki" />


<title>epi curious</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 45px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h2 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h3 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h4 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h5 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h6 {
  padding-top: 50px;
  margin-top: -50px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">epi curious</h1>
<h4 class="author">Ania Kawiecki</h4>
<h4 class="date">9/29/2020</h4>

</div>


<pre class="r"><code>library(tidyverse)
library(rethinking)
library(dagitty)
library(knitr)
library(&quot;ggdag&quot;)
library(&quot;ggrepel&quot;)
library(INLA)
library(knitr)
library(stringr)
library(&quot;patchwork&quot;)
library(&quot;ghibli&quot;)
library(&quot;fpp2&quot;)</code></pre>
<p><strong>DISCLAIMER</strong></p>
<p>Ths documents is a compilation of notes and information from textbooks I compiled while I was studying for my Qualifying Exam in the PhD Epidemiology program at UC Davis. The books, articles, blogs, and webpages I used to compile this study guide are listed under “Resources”. I am not the author of anything in this document. In addition, these are my personal notes, and should not be treated as the definitive or true information, for that please see the source material.</p>
<p>That being said, I hope these notes may be useful to other students in epidemiology as they have been to me. I really profited from having all the information searchable on a single document, and gaining insights on a topic from different sources.</p>
<p>Enjoy!</p>
<p>Ania Kawiecki</p>
<div id="resources" class="section level1">
<h1>Resources</h1>
<ul>
<li>Intro to Epidemiology</li>
</ul>
<p><a href="https://www.elsevier.com/books/epidemiology/gordis/978-1-4557-3733-8">Epidemiology,5th edition, Leon Gordis</a></p>
<ul>
<li>Causal inference</li>
</ul>
<p><a href="https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/">Causal Inference: What If, by Miguel A. Hernán, James M. Robins</a></p>
<p><a href="http://xcelab.net/rm/statistical-rethinking/">Statistical Rethinking: A Bayesian Course with Examples in R and Stan. Second edition, by Richard McElreath</a></p>
<p><a href="https://academic.oup.com/aje/article/155/2/176/108106">Causal Knowledge as a Prerequisite for Confounding Evaluation: An Application to Birth Defects Epidemiology, Hernàn 2002</a></p>
<p><a href="https://projecteuclid.org/euclid.ssu/1255440554http://projecteuclid.org/euclid.ssu/1255440554">Causal inference in statistics: an overview, Pearl 2009</a></p>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2836213/">An introduction to causal inference, Pearl 2010</a></p>
<ul>
<li>Models</li>
</ul>
<p><a href="http://www.stat.columbia.edu/~gelman/arm/">Gelman and Hill 2005</a></p>
<p><a href="http://xcelab.net/rm/statistical-rethinking/">Statistical Rethinking: A Bayesian Course with Examples in R and Stan. Second edition, by Richard McElreath</a></p>
<p><a href="https://online.stat.psu.edu/stat462/node/95/">STAT 462 Applied Regression Analysis</a></p>
<ul>
<li>Forecasts</li>
</ul>
<p><a href="https://otexts.com/fpp2/">Forecasting: Principles and Practice, by Rob J Hyndman and George Athanasopoulos</a></p>
<p><a href="https://medium.com/analytics-vidhya/basics-of-forecast-accuracy-db704b0b001b#:~:text=A%20simple%20measure%20of%20forecast,known%20as%20Mean%20Forecast%20Error.&amp;text=The%20MFE%20for%20this%20forecasting,more%20than%20the%20forecast%20values.">Basics of Forecast Accuracy</a></p>
<ul>
<li>ggdag</li>
</ul>
<p><a href="https://ggdag.malco.io/" class="uri">https://ggdag.malco.io/</a></p>
<p><a href="https://malco.io/2019/09/17/tidy-causal-dags-with-ggdag-0-2-0/" class="uri">https://malco.io/2019/09/17/tidy-causal-dags-with-ggdag-0-2-0/</a></p>
<p><a href="https://cran.r-project.org/web/packages/ggdag/vignettes/intro-to-ggdag.html" class="uri">https://cran.r-project.org/web/packages/ggdag/vignettes/intro-to-ggdag.html</a></p>
<p><a href="https://cran.r-project.org/web/packages/ggdag/vignettes/bias-structures.html" class="uri">https://cran.r-project.org/web/packages/ggdag/vignettes/bias-structures.html</a></p>
<ul>
<li>spatial</li>
</ul>
<p><a href="https://www.satscan.org/cgi-bin/satscan/register.pl/SaTScan_Users_Guide.pdf?todo=process_userguide_download">satscan user guide</a></p>
<p>EPI223 notes</p>
</div>
<div id="epidemiological-concepts" class="section level1">
<h1><strong>EPIDEMIOLOGICAL CONCEPTS</strong></h1>
<div id="measures-of-disease-frequency" class="section level2">
<h2>MEASURES OF DISEASE FREQUENCY</h2>
<div id="morbidity" class="section level3">
<h3>MORBIDITY</h3>
</div>
<div id="prevalence" class="section level3">
<h3>prevalence</h3>
<p>Proportion of the population affected at time t = snapshot of disease.</p>
<p>Units: 0-1 or 0-100%</p>
<p><span class="math display">\[\frac{cases\:at\:time\:t\:(new + existing)}{total\:population\:at\:time\:t}\]</span> Risk of <em>being</em> a case.</p>
<p><span class="math display">\[prevalence = incidence * duration\]</span> It’s a bad measure of risk because it depends on the duration of disease. Chronic diseases will have high prevalnce, and very fatal diseases will have low prevalence, regardless of the incidence.</p>
<ul>
<li><strong>point prevalence</strong>: prevalence at a given timepoint t</li>
</ul>
<p><span class="math display">\[\frac{cases\:at\:time\:t\:(new + existing)}{total\:population\:at\:time\:t}\]</span></p>
<ul>
<li><strong>period prevalence</strong>: prevalence at any given timepoint during a time period t</li>
</ul>
<p><span class="math display">\[\frac{cases\:observed\:over\:period\:t\:(new + existing)}{total\:population\:at\:midpoint\:of\:period\:t}\]</span></p>
</div>
<div id="incidence" class="section level3">
<h3>incidence</h3>
<p>Proportion of the population at risk of being affected that does become affected during a time period t. cases/population * time at risk</p>
<p><span class="math display">\[\frac{new\:cases\:observed\:over\:period\:t}{total\:population\:at\:risk\:during\:period\:t}\]</span></p>
<p>Risk of <em>becoming</em> a case.</p>
<p><span class="math display">\[\frac{cases}{population*time\:at\:risk}\]</span> It measures risk because it measures events or transitions from affected to not affected state.</p>
<ul>
<li><strong>cumulative incidence</strong></li>
</ul>
<p>The population at risk is a crude measure of the population at risk at the beginning of the time period. It assumes a static population at risk.</p>
<p>Units: 0-1 or 0-100% per time interval.</p>
<p><span class="math display">\[\frac{new\:cases\:observed\:over\:period\:t}{total\:population\:at\:risk\:at\:start\:of\:time\:period\:t}\]</span> Measures average risk. Is apt for short time-periods or static populations.</p>
<ul>
<li><strong>incidence density rate</strong></li>
</ul>
<p>The population at risk is the sum of all the disease-free/ at risk time periods for each individual. It assumes the risk of each person in the population does not change over time.</p>
<p>Units: 0- <span class="math inline">\(\infty\)</span> cases/population-time</p>
<p><span class="math display">\[\frac{new\:cases\:observed\:over\:period\:t}{total\:population-time}\]</span> Measures risk by taking into account the time elapsed before disease occured for each individual, thus it also measures the speed at which disease occurs at a certain timepoint. Is apt for prolonged time-periods or dynamic populations.</p>
<p>To calculate population-time:</p>
<ul>
<li>sum all the disease-free time for each individual.</li>
<li>estimate:
<ul>
<li>count the population-time midway through the time period</li>
<li>average the population-time at the beginning and the end of the period.</li>
</ul></li>
</ul>
</div>
<div id="attack-rate" class="section level3">
<h3>attack rate</h3>
<p>Proportion of the exposed individuals that becomes affected during a time period t.</p>
<p><span class="math display">\[\frac{cases}{exposed}\]</span></p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-02%20at%2013.35.40.png" alt="" />
<p class="caption">Relationship between incidence and prevalence. Gordis</p>
</div>
</div>
<div id="mortality" class="section level3">
<h3>MORTALITY</h3>
</div>
<div id="mortality-rate" class="section level3">
<h3>mortality rate</h3>
<p>Speed of death in time t.</p>
<p>Measures risk: good measure when disease is mild, bad measure when disease is very deadly and the case-fatality is high.</p>
<p><span class="math display">\[\frac{deaths\:over\:period\:t}{total\:population\:at\:risk\:during\:time\:period\:t}\]</span></p>
<ul>
<li><strong>crude mortality rate</strong></li>
</ul>
<p>overall deaths</p>
<p><span class="math display">\[\frac{deaths\:over\:period\:t}{total\:population\:at\:risk\:during\:time\:period\:t}\]</span></p>
<ul>
<li><strong>specific mortality rate</strong></li>
</ul>
<p>deaths in a specific subgroup (age, sex, diseased with a certain disease)</p>
<p><span class="math display">\[\frac{deaths\:in\:subgroup\:over\:period\:t}{population\:at\:risk\:in\:subgroup\:during\:time\:period\:t}\]</span></p>
</div>
<div id="case-fatality-rate" class="section level3">
<h3>case fatality rate</h3>
<p>Proportion of the individuals that become affected by disease X who die during a time period t.</p>
<p>Measures disease severity</p>
<p><span class="math display">\[\frac{deaths}{cases}\]</span></p>
</div>
<div id="proportionate-mortality" class="section level3">
<h3>proportionate mortality</h3>
<p>Fraction of all the deaths caused by disease X</p>
<p><span class="math display">\[\frac{deaths\:from\:disease\:X}{all\:deaths}\]</span></p>
</div>
<div id="rates" class="section level3">
<h3>RATES</h3>
</div>
<div id="crude" class="section level3">
<h3>crude</h3>
<p>overall population</p>
</div>
<div id="adjusted" class="section level3">
<h3>adjusted</h3>
<p>adjusted rates controlling for confounding factors to remove the effect of that factor</p>
<ul>
<li><strong>direct</strong></li>
</ul>
<p>Apply the specific subgroup rates of each population to a standard population and calculate the rate on the standard population.</p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-02%20at%2013.04.03.png" alt="" />
<p class="caption">direct adjusted example from Gordis</p>
</div>
<ul>
<li><strong>indirect</strong></li>
</ul>
<p>Compare populations: subgroup vs general</p>
<p>SMR = Strandard Mortality Ratio <span class="math display">\[SMR= \frac{Observed}{Expected}\]</span></p>
<p>Expected: Apply the general population rates to each specific subgroup and add all the cases Observed: add all the observed cases in each specific subgroup</p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-02%20at%2013.08.05.png" alt="" />
<p class="caption">indirect adjusted example from Gordis</p>
</div>
</div>
</div>
<div id="diagnostic-test-evaluation-and-screening-tests" class="section level2">
<h2>DIAGNOSTIC TEST EVALUATION AND SCREENING TESTS</h2>
<p><em>test precision</em>: ability to produce consistent results when repeated under the same conditions:</p>
<ul>
<li><p>repeatability: consistency of test results under same condition except time</p></li>
<li><p>reproducibility: consistency of test results under different conditions</p></li>
</ul>
<table>
<colgroup>
<col width="6%" />
<col width="33%" />
<col width="33%" />
<col width="27%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Disease +</th>
<th align="left">Disease -</th>
<th align="left">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Test +</td>
<td align="left">a = P[T(+) &amp; D(+)] = true positive</td>
<td align="left">b = P[T(+) &amp; D(-)] = false positive</td>
<td align="left">a+b = P[T(+)] = test positive</td>
</tr>
<tr class="even">
<td align="left">Test -</td>
<td align="left">c = P[T(-) &amp; D(+)] = false negative</td>
<td align="left">d = P[T(-) &amp; D(-)] = true negative</td>
<td align="left">c+d = P[T(-)] = test positive</td>
</tr>
<tr class="odd">
<td align="left">Total</td>
<td align="left">a+c = P[D(+)] = disease positive</td>
<td align="left">b+d = P[D(-)] = disease negative</td>
<td align="left">1=a+b+c+d = total</td>
</tr>
</tbody>
</table>
<div id="test-performance-characteristics" class="section level3">
<h3>TEST PERFORMANCE CHARACTERISTICS</h3>
</div>
<div id="sensitivity" class="section level3">
<h3>sensitivity</h3>
<p>Probability that test is positive given that the individual is diseased</p>
<p><span class="math display">\[P(T^+|D^+)= \frac{P(T^+ \cap D^+)}{P(D^+)}\]</span></p>
</div>
<div id="specificity" class="section level3">
<h3>specificity</h3>
<p>Probability that test is negative given that the individual is not diseased</p>
<p><span class="math display">\[P(T^-|D^-)= \frac{P(T^- \cap D^-)}{P(D^-)}\]</span></p>
<p><strong>TRADE-OFF</strong></p>
<p>In continuous results, the cut-off that for a positive test can determine the specificiity and sensitivity of the test, and should be chosen depending on the purpose.</p>
<ul>
<li><p>lower threshold:increases the sensitivity but decreases the specificity by increasing false positives</p></li>
<li><p>higher threshold:increases the specificity but decreases the sensitivity by increasing false negatives</p></li>
</ul>
<p><img src="notes%20screenshots/Gordis%20Epidemiology%205th%20se.jpg" /> <strong>ROC curve</strong>: Receiver Operating Characteristic (ROC) curve: is a graphic portrayal of the sensitivity-specificity trade-off as cut-off values vary.</p>
<p><strong>AUC</strong>: is the area under the curve.</p>
<ul>
<li>The AUC of a useful test must be <span class="math inline">\(&gt;\)</span> 0.5
<ul>
<li>area of the total square = 1</li>
<li>area of a random process = 0.5</li>
<li>1 - 0.5 = 0.5</li>
</ul></li>
<li>It can also be defined as the probability that a randomly selected diseased individual will have a higher test value that a randomly selected non-diseased individual.</li>
</ul>
<p>Example: AUC = 0.9 : a randomly selected diseased individual will have a higher test value that a randomly selected non-diseased individual 90 % of the time.</p>
<ul>
<li>It can also be defined as the:
<ul>
<li>average sensitivity across all possible 1- specificity values</li>
<li>average true positive ratio across all possible false positive ratio</li>
</ul></li>
</ul>
<p><strong>Youden’s index</strong>= <strong>J-statistic</strong>: sensitivity + specificity - 1 = true positive ratio - false positive ratio</p>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-09%20at%2017.18.14.png" /></p>
</div>
<div id="likelihood-ratio-negative" class="section level3">
<h3>likelihood ratio negative</h3>
<p>likelihood that a non-diseased individual will test negative vs an individual that is not diseased = the odds that a negative test would be expected in a diseased individual</p>
<p><span class="math display">\[\frac{P(T^-|D^+)}{P(T^-|D^-)}= \frac{1-P(T^+ | D^+)}{P(T^- | D^-)}= \frac{1-sensitivity}{specificity}\]</span></p>
</div>
<div id="likelihood-ratio-positive" class="section level3">
<h3>likelihood ratio positive</h3>
<p>likelihood that a diseased individual will test positive vs an individual that is not diseased = the odds that a positive test would be expected in a diseased individual</p>
<p><span class="math display">\[\frac{P(T^+|D^+)}{P(T^+|D^-)}= \frac{P(T^+ | D^+)}{1-P(T^- | D^-)}= \frac{sensitivity}{1-specificity}\]</span></p>
<p><strong>CHARACTERISTICS OF LIKELIHOOD RATIOS</strong></p>
<ol style="list-style-type: decimal">
<li><p>independent from prevalence</p></li>
<li><p>can be used to shorten list of diagnostic possibilities. If LR = 1, the test provides no information on disease status.</p></li>
</ol>
</div>
<div id="post-test-probabilities" class="section level3">
<h3>POST-TEST PROBABILITIES</h3>
<p>once you have a test result, how likely is it that you have disease?</p>
</div>
<div id="ppv-positive-predictive-value" class="section level3">
<h3>ppv : positive predictive value</h3>
<p>Probability that the individual is diseased given that the test was positive</p>
<p><span class="math display">\[P(D^+|T^+)= \frac{P(T^+ \cap D^+)}{P(T^+)}\]</span></p>
</div>
<div id="npv-negative-predictive-value" class="section level3">
<h3>npv : negative predictive value</h3>
<p>Probability that the individual is not diseased given that the test was negative</p>
<p><span class="math display">\[P(D^-|T^-)= \frac{P(T^- \cap D^-)}{P(T^-)}\]</span></p>
<p><strong>WHAT AFFECTS PREDICTIVE VALUES ?</strong></p>
<ul>
<li>prevalence</li>
</ul>
<p>The ppv of a test increased and the npv of a test decreases as the prevalence of the disease in the population increases.</p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-09%20at%2016.24.46.png" alt="" />
<p class="caption">Gordis</p>
</div>
<ul>
<li><p>specificity: for the same prevalence, a test with higher specificity has higher ppv.</p>
<ul>
<li><p>in common diseases: the sensitivity has a larger effect on the ppv because it decreases the false positives.</p></li>
<li><p>in rare diseases: the specificity has a larger effect on the ppv because it decreases the false negatives.</p></li>
</ul>
<p>Because disease are usually infrequent and there are more healthy individuals than diseases individuals, any increase in specifcity that affects the number of healthy individuals has a greater effect than finding diseased individuals.</p></li>
</ul>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-09%20at%2016.23.06.png" alt="" />
<p class="caption">Gordis</p>
</div>
<p>TO IMPROVE PREDICTIVE VALUES:</p>
<ul>
<li><p>test high-risk populations</p></li>
<li><p>increase the cut-off to increase specificity.</p></li>
</ul>
</div>
<div id="test-precision" class="section level3">
<h3>TEST PRECISION</h3>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Oberver A Test +</th>
<th align="left">Oberver A Test -</th>
<th align="left">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Oberver B Test +</td>
<td align="left">a</td>
<td align="left">b</td>
<td align="left">a+b</td>
</tr>
<tr class="even">
<td align="left">Oberver B Test -</td>
<td align="left">c</td>
<td align="left">d</td>
<td align="left">c+d</td>
</tr>
<tr class="odd">
<td align="left">Total</td>
<td align="left">a+c</td>
<td align="left">b+d</td>
<td align="left">1=a+b+c+d = total</td>
</tr>
</tbody>
</table>
</div>
<div id="kappa-statistic" class="section level3">
<h3>kappa statistic</h3>
<p><span class="math display">\[\kappa= \frac{P_O-P_E}{1-P_E}\]</span></p>
<p>contrasts observed agreement with the agreement that would have been observed by chance alone.</p>
<ul>
<li><p><strong>percent agreement between 2 observers</strong>: <span class="math inline">\(P_O = \frac{a+d}{a+b+c+d}\)</span></p></li>
<li><p><strong>expected agreement by chance</strong>: % <span class="math inline">\(P_E = \frac{[P(T_{ObserverA}^+) * T_{ObserverB}^+] + [P(T_{ObserverA}^-) * T_{ObserverB}^-]}{total}=\frac{\frac{a+c}{a+b+c+d}*(a+b) + \frac{b+d}{a+b+c+d}*(c+d)}{a+b+c+d}\)</span></p></li>
</ul>
<p>Example: Pathologist A read 60% of all 75 slides (45 slides) as being grade II and 40% (30 slides) as grade III. If his or her readings had used criteria independent of those used by pathologist B (e.g., if pathologist A were to read 60% of any group of slides as grade II), we would expect that pathologist A would read as grade II both 60% of the slides that pathologist B had called grade II and 60% of the slides that patholo- gist B had called grade III. Therefore, we would expect that 60% (26.4) of the 44 slides called grade II by pathologist B would be called grade II by pathologist A and that 60% (18.6) of the 31 slides called grade III by pathologist B would also be called grade II by pathologist A. Of the 31 slides called grade III by pathologist B, 40% (12.4) would also be classified as grade III by pathologist A.</p>
<p><span class="math inline">\(P_E = \frac{[0.6 * 44] + [0.4 * 31]}{75}= \frac{26.4+ 12.4}{75}= 51.7\)</span></p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-09%20at%2017.29.35.png" alt="" />
<p class="caption">Gordis</p>
</div>
<ul>
<li>-1 = perfect disagreement</li>
<li>0 = agreement expected by chance</li>
<li>1 = perfect agreement</li>
</ul>
<p>Kappa is affected by prevalence, and therefore can only be used within studies but not across studies.</p>
</div>
<div id="multiple-test" class="section level3">
<h3>MULTIPLE TEST</h3>
</div>
<div id="sequential" class="section level3">
<h3>sequential</h3>
<p>An individual is considered disease positive if the individual tests positive on both tests.</p>
<p>This method is often used for screening</p>
<p>more opportunities to test negative lead to:</p>
<ul>
<li><p>decrease in sensitivity (<span class="math inline">\(P(T^+|D^+)\)</span>): a diseased individual has more opportunities to test negative</p></li>
<li><p>increase in specificity (<span class="math inline">\(P(T^-|D^-)\)</span>): a non-diseased individual has more opportunities to be correctly diagnosed as negative</p></li>
<li><p>increase in ppv (<span class="math inline">\(P(D^+|T^+)\)</span>): there are fewer false positive</p></li>
<li><p>decrease in npv (<span class="math inline">\(P(D^-|T^-)\)</span>): there are more false negatives</p></li>
</ul>
<p><strong>EXAMPLE</strong></p>
<ul>
<li>Original values:</li>
</ul>
<p>sensitivity (<span class="math inline">\(P(T^+|D^+)= 0.70\)</span></p>
<p>specificity <span class="math inline">\(P(T^-|D^-) = 0.80\)</span></p>
<p>ppv <span class="math inline">\(P(D^+|T^+)= 0.16\)</span></p>
<p>npv <span class="math inline">\(P(D^-|T^-) = 0.98\)</span></p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-09%20at%2018.06.46.png" alt="" />
<p class="caption">Gordis</p>
</div>
<ul>
<li>After sequential testing: 505 individuals are positive in both tests</li>
</ul>
<p>net sensitivity (<span class="math inline">\(P(T^+|D^+)= 315/500= 0.63\)</span></p>
<p>net specificity <span class="math inline">\(P(T^-|D^-) = (1710+7600)/9500= 0.98\)</span></p>
<p>net ppv <span class="math inline">\(P(D^+|T^+)= 350/505= 0.62\)</span></p>
<p>net npv <span class="math inline">\(P(D^-|T^-)= (1710+7600)/ (7750+1745) = 0.98\)</span></p>
</div>
<div id="simultaneous" class="section level3">
<h3>simultaneous</h3>
<p>An individual is considered disease positive if the individual tests positive on either tests.</p>
<p>more opportunities to test positive lead to:</p>
<ul>
<li><p>increase in sensitivity (<span class="math inline">\(P(T^+|D^+)\)</span>): a diseased individual has more opportunities to test positive</p></li>
<li><p>decrease in specificity (<span class="math inline">\(P(T^-|D^-)\)</span>): a non-diseased individual has more opportunities to be incorrectly diagnosed as positive, that is there are more false positives</p></li>
<li><p>decrease in ppv (<span class="math inline">\(P(D^+|T^+)\)</span>): there are more false positives</p></li>
<li><p>increase in npv (<span class="math inline">\(P(D^-|T^-)\)</span>): if an individual is negative on both tests, it is more likely not to be diseased</p></li>
</ul>
<p><strong>EXAMPLE</strong></p>
<ul>
<li>Original values:</li>
</ul>
<p>TEST A</p>
<p>sensitivity test A (<span class="math inline">\(P(T^+|D^+)= 0.80\)</span></p>
<p>specificity test A <span class="math inline">\(P(T^-|D^-) = 0.60\)</span></p>
<p>ppv test A <span class="math inline">\(P(D^+|T^+)= 0.33\)</span></p>
<p>npv test A <span class="math inline">\(P(D^-|T^-) = 0.92\)</span></p>
<p>TEST B</p>
<p>sensitivity test B (<span class="math inline">\(P(T^+|D^+)= 0.90\)</span></p>
<p>specificity test B <span class="math inline">\(P(T^-|D^-) = 0.90\)</span></p>
<p>ppv test A <span class="math inline">\(P(D^+|T^+)= 0.69\)</span></p>
<p>npv test A <span class="math inline">\(P(D^-|T^-) = 0.97\)</span></p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-09%20at%2018.27.34.png" alt="" />
<p class="caption">Gordis</p>
</div>
<ul>
<li>After simultaneus testing:</li>
</ul>
<p><strong>net sensitivity</strong></p>
<p><span class="math inline">\(T_A^+ =80\%sensitivity * total = 0.8*200= 160\)</span></p>
<p><span class="math inline">\(T_B^+ =90\%sensitivity * total = 0.9*200= 180\)</span></p>
<p><span class="math inline">\(T_{AB}^+ =90\%sensitivity * 80\%sensitivity* total = 0.8* 0.9*200= 144\)</span></p>
<p>or <span class="math inline">\(P(A)+P(B)-P(A\cap B) = 0.8+0.9+ (0.8*0.9) = 0.98\)</span></p>
<p><span class="math inline">\(T_{only A}^+ = 160-144=16\)</span></p>
<p><span class="math inline">\(T_{only B}^+ = 180-144=36\)</span></p>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-09%20at%2018.34.40.png" alt="Gordis" /> <strong>net specificity</strong></p>
<p><span class="math inline">\(T_{AB}^-= 0.6*0.9 = 0.54\)</span></p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-09%20at%2018.47.04.png" alt="" />
<p class="caption">Gordis</p>
</div>
<p>net ppv = <span class="math inline">\(196/564=0.35\)</span></p>
<p>net npv = <span class="math inline">\(432/436=0.99\)</span></p>
</div>
</div>
</div>
<div id="causal-inference" class="section level1">
<h1><strong>CAUSAL INFERENCE</strong></h1>
<div id="introduction-to-causality" class="section level2">
<h2>INTRODUCTION TO CAUSALITY</h2>
<p>“The questions that motivate most studies in the health, social and behavioral sciences are not associational but causal in nature. For example, what is the efficacy of a given drug in a given population? What was the cause of death of a given individual, in a specific incident? These are causal questions because they require some knowledge of the data-generating process; they cannot be computed from the data alone, nor from the distributions that govern the data” (<span class="citation">@Pearl2009</span>).</p>
<p>"The aim of standard statistical analysis is to assess parameters of a distribution from samples drawn of that distribution. With the help of such parameters, associations among variables can be inferred, which permits the researcher to estimate probabilities of past and future events and update those probabilities in light of new information. These tasks are managed well by standard statistical analysis so long as experimental conditions remain the same. Causal analysis goes one step further; its aim is to infer probabilities under conditions that are <strong>changing</strong>, for example, changes induced by treatments or external interventions.</p>
<p>This distinction implies that causal and associational concepts do not mix; there is nothing in a distribution function to tell us how that distribution would differ if external conditions were to change—say from observational to experimental setup—because the laws of probability theory do not dictate how one property of a distribution ought to change when another property is modified. This information must be provided by <strong>causal assumptions which identify relationships that remain invariant when external conditions change</strong>.</p>
<p>Causal relations cannot be expressed in the language of probability and, hence, that any mathematical approach to causal analysis must acquire new notation – probability calculus is insufficient. To illustrate, the syntax of probability calculus does not permit us to express the simple fact that “symptoms do not cause diseases,” let alone draw mathematical conclusions from such facts. All we can say is that two events are dependent—meaning that if we find one, we can expect to encounter the other, but we cannot distinguish statistical dependence, quantified by the conditional probability P(disease|symptom) from causal dependence, for which we have no expression in standard probability calculus." (Pearl 2010)</p>
<p><strong>Summary</strong>: The difference between association and causality is that causality is <strong>directional</strong>, which cannot be represented with standard calculus notation.</p>
</div>
<div id="causation" class="section level2">
<h2><strong>CAUSATION</strong></h2>
</div>
<div id="types-of-associations" class="section level2">
<h2>types of associations</h2>
<p>A statistical association between an exposure and an outcome can be due to either or both a:</p>
<ul>
<li><strong>causal effect</strong>: the exposure causes the outcome. This is the effect we want to isolate using causal inference.</li>
</ul>
<p><img src="index_files/figure-html/dag%20causal%201-1.png" width="672" /></p>
<ul>
<li><strong>spurious effect</strong>: the exposed and the unexposed groups in the study are not comparable, or exchangeable, which is the ultimate source of the bias (the unexposed group is not the counterfactual of the exposed group) (<span class="citation">@Hernan2002</span>).</li>
</ul>
<p><img src="index_files/figure-html/dag%20spurious%201-1.png" width="672" /></p>
<ul>
<li>a <strong>common effect</strong> = <strong>collider</strong></li>
</ul>
<p><img src="index_files/figure-html/dag3%201-1.png" width="672" /></p>
</div>
<div id="types-of-causal-relationships" class="section level2">
<h2>types of causal relationships</h2>
<div id="necessary" class="section level3">
<h3>necessary</h3>
<p>disease does not develop without this factor</p>
</div>
<div id="sufficient" class="section level3">
<h3>sufficient</h3>
<p>disease always develops with this factor</p>
<ol style="list-style-type: decimal">
<li><p><strong>necessary AND sufficient</strong>: without that factor, the disease never develops, and in the presence of that factor, the disease always develops. This never occurs in nature, even pathogens require other factors.</p></li>
<li><p><strong>necessary AND NOT sufficient</strong>: each factor is needed but alone is not able to cause disease. Ex: pathogen + immune susceptibility</p></li>
<li><p><strong>NOT necessary BUT sufficient</strong>: each factor alone is able to cause disease, but so can other factors. Ex: leukemia can be caused by radiation or benzene exposure</p></li>
<li><p><strong>NOT necessary NOR sufficient</strong>: presence of the factor by itself does not cuase disease</p></li>
</ol>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-03%20at%2013.31.01.png" /> <img src="notes%20screenshots/Screen%20Shot%202020-12-03%20at%2013.31.41.png" alt="Gordis figure 14-12 to 14-15" /></p>
</div>
<div id="direct-effect" class="section level3">
<h3>direct effect</h3>
<p>Example: a direct effect would arise because younger people change faster than older people and are therefore more likely to grow incompatible with a partner.</p>
<p><img src="index_files/figure-html/direct-1.png" width="672" /></p>
</div>
<div id="indirect-effect" class="section level3">
<h3>indirect effect</h3>
<p>Example: age of marriage has an indirect effect by influencing the marriage rate, which then influences divorce. If people get married earlier, then the marriage rate may rise, because there are more young people. Consider for example if an evil dictator forced everyone to marry at age 65. Since a smaller fraction of the population lives to 65 than to 25, forcing delayed marriage will also reduce the marriage rate. If marriage rate itself has any direct effect on divorce, maybe by making marriage more or less normative, then some of that direct effect could be the indirect effect of age at marriage.</p>
<p><img src="index_files/figure-html/indirect-1.png" width="672" /></p>
</div>
</div>
<div id="guidelines-for-establishing-a-causal-relationship" class="section level2">
<h2>guidelines for establishing a causal relationship</h2>
<div id="koch-henle-criteria" class="section level3">
<h3>Koch-Henle Criteria</h3>
<ol style="list-style-type: decimal">
<li><p>The organism is <strong>always</strong> found with the disease</p></li>
<li><p>The organism is <strong>not</strong> found with any other disease</p></li>
<li><p>The organism isolated from one individual with disease <strong>produces</strong> the disease in other individuals</p></li>
</ol>
</div>
<div id="bradford-hill-criteria" class="section level3">
<h3>Bradford Hill Criteria</h3>
<p>Most important</p>
<ol style="list-style-type: decimal">
<li><p>temporal relationship: exposure to the factor occurs before disease</p></li>
<li><p>biologic plausibility: the association makes sense in the contex of existing knowledge.</p></li>
<li><p>consistency: the same result is replicated in different studies and populations</p></li>
<li><p>alternative explanations: confounding. exploration of the effect of other factors on the association.</p></li>
</ol>
<p>Others</p>
<ol start="5" style="list-style-type: decimal">
<li><p>strength: as measured by measures of effect (risk ratio or odds ratio)</p></li>
<li><p>dose - response: the higher the exposure, the higher the risk of disease</p></li>
<li><p>specificity: hard to ascertain as most outcomes are multifactorial</p></li>
<li><p>cessation effect: if the exposure ceases, so does the effect</p></li>
</ol>
</div>
</div>
<div id="measures-of-disease-effect-or-association" class="section level2">
<h2>MEASURES OF DISEASE EFFECT OR ASSOCIATION</h2>
<p><strong>Measures of effect</strong> compare an exposed population to it’s counterfactual unexposed population, that is the exact same population at the same time point had it not been exposed. That is, the effect of <span class="math inline">\(E^+\)</span> on the probability of being <span class="math inline">\(D^+\)</span> in the SAME population.</p>
<p><strong>Measures of association</strong> compare one exposed population to another unexposed population (a different population or the same population at a different time point) assuming that both populations are comparable. That is the effect of <span class="math inline">\(E^+\)</span> on the probability of being <span class="math inline">\(D^+\)</span> between <span class="math inline">\(E^-\)</span> and <span class="math inline">\(E^+\)</span>.</p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-02%20at%2013.46.37.png" alt="" />
<p class="caption">causal types</p>
</div>
<p><em>Doomed</em> = always has disease, exposed or not</p>
<p><em>Susceptible</em> = has disease when exposed</p>
<p><em>Protected</em>= does not have disease when exposed, but has disease when unexposed</p>
<p><em>Immune</em>= never has disease, exposed or not</p>
<p><span class="math inline">\(P(D^+|E^+) = p_1 + p_2 = doomed + susceptible\)</span></p>
<p><span class="math inline">\(P(D^-|E^+) = p_3 + p_4 = protected + immune\)</span></p>
<p><span class="math inline">\(P(D^+|E^-) = p_1 + p_3 = doomed + protected\)</span></p>
<p><span class="math inline">\(P(D^-|E^-) = p_2 + p_4 = susceptible + immune\)</span></p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Disease +</th>
<th align="left">Disease -</th>
<th align="left">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Exposed +</td>
<td align="left">a = E(+) &amp; D(+)</td>
<td align="left">b = E(+) &amp; D(-)</td>
<td align="left">a+b = E(+)</td>
</tr>
<tr class="even">
<td align="left">Exposed -</td>
<td align="left">c = E(-) &amp; D(+)</td>
<td align="left">d = E(-) &amp; D(-)</td>
<td align="left">c+d = E(-)</td>
</tr>
<tr class="odd">
<td align="left">Total</td>
<td align="left">a+c = D(+)</td>
<td align="left">b+d = D(-)</td>
<td align="left">a+b+c+d = total</td>
</tr>
</tbody>
</table>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-02%20at%2013.51.02.png" alt="" />
<p class="caption">measures of disease effect or association</p>
</div>
<p>Conditional probability refresher = <span class="math inline">\(P(A|B)=\frac{P(A \cup B)}{P(B)}\)</span></p>
<div id="absolute-risk-incidence" class="section level3">
<h3>absolute risk = incidence</h3>
<p>Measures magnitude of risk. Does not take into account the unexposed population or whether risk is associated to exposure. <span class="math display">\[P(D^+|E^+)=\frac{a}{a+b}=\frac{new\:cases\:observed\:over\:period\:t}{total\:population\:at\:risk\:during\:period\:t}\]</span></p>
</div>
<div id="relative-risk-risk-ratio" class="section level3">
<h3>relative risk = risk ratio</h3>
<p>Measures the strength of the association and possible causal relationship</p>
<p>RR = 1 <span class="math inline">\(\to\)</span> no effect</p>
<p><span class="math display">\[\frac{P(D^+|E^+)}{P(D^+|E^-)}=\frac{\frac{a}{a+b}}{\frac{c}{c+d}}=\frac{incidence\:in\:exposed\:population}{incidence\:in\:unexposed\:population}\]</span> It can be expressed as:</p>
<ul>
<li><strong>Risk Ratio</strong> = <strong>RR</strong> = the ratio of cumulative incidence in the exposed and unexposed populations</li>
</ul>
<p><span class="math display">\[\frac{P(D^+|E^+)}{P(D^+|E^-)}=\frac{\frac{a}{a+b}}{\frac{c}{c+d}}=\frac{D^+\:in\:exposed\:population}{D^-\:in\:unexposed\:population}\]</span></p>
<ul>
<li><strong>Incidence Rate Ratio</strong> = <strong>IRR</strong> or <strong>IDR</strong> = the ratio of incidence densities in the exposed and unexposed populations</li>
</ul>
<p><span class="math display">\[\frac{D^+\:in\:person-time\:of\:exposed\:population}{D^+\:in\:person-time\:of\:unexposed\:population}=\frac{incidence\:in\:exposed\:population}{incidence\:in\:unexposed\:population}\]</span></p>
</div>
<div id="odds-ratio" class="section level3">
<h3>odds ratio</h3>
<p>Measures the strength of the association but cannot suggest a causal relationship</p>
<p><span class="math display">\[\frac{\frac{P(D^+|E^+)}{P(D^-|E^+)}}{\frac{P(D^+|E^-)}{P(D^-|E^-)}}=\frac{\frac{a}{b}}{\frac{c}{d}}=\frac{ad}{bc}=\frac{odds\:D^+\:in\:exposed\:population}{odds\:D^+\:in\:unexposed\:population}\]</span> or</p>
<p><span class="math display">\[\frac{\frac{P(E^+|D^+)}{P(E^-|D^+)}}{\frac{P(E^+|D^-)}{P(E^-|D^-)}}=\frac{\frac{a}{c}}{\frac{b}{d}}=\frac{ad}{bc}=\frac{odds\:E^+\:in\:diseased\:population}{odds\:E^+\:in\:not\:diseased\:population}\]</span></p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-02%20at%2016.17.24.png" alt="" />
<p class="caption">A: cohort study, B: case-control study, Gordis Figure 11-5</p>
</div>
<p><strong>matched-pairs OR</strong>:</p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-02%20at%2016.22.42.png" alt="" />
<p class="caption">Gordis Figure 11-9</p>
</div>
<p><strong>ODDS RATIO CAN BE A GOOD ESTIMATE OF RELATIVE RISK</strong> When:</p>
<p><span class="math display">\[\frac{P(D^+|E^+)}{P(D^+|E^-)}\approx\frac{\frac{P(D^+|E^+)}{P(D^-|E^+)}}{\frac{P(D^+|E^-)}{P(D^-|E^-)}}\]</span> <span class="math display">\[\frac{\frac{a}{a+b}}{\frac{c}{c+d}} \approx \frac{\frac{a}{b}}{\frac{c}{d}}\]</span></p>
<ul>
<li>We assume the disease is rare:
<ul>
<li><strong>rare disease assumption</strong></li>
</ul></li>
</ul>
<p>When the disease does not occur frequently <span class="math inline">\(a+b \approx b\)</span> and <span class="math inline">\(c+d \approx d\)</span></p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-03%20at%2010.47.42.png" alt="" />
<p class="caption">Gordis Figure 11-6, 11-7</p>
</div>
<ul>
<li><p>The cases are representative, with regards to the history of exposure, of all the people with disease in the population from which the cases were drawn:</p></li>
<li><p>The controls are representative, with regards to the history of exposure, of all the people without disease in the population from which the cases were drawn:</p></li>
</ul>
<p>The controls can be selected through different methods:</p>
<ul>
<li><p>Not matched on time</p>
<ul>
<li><p><em>case-based sampling</em>: sampling occurs at the beginning of the study (<span class="math inline">\(t_0\)</span>)</p></li>
<li><p><em>cumulative incidence sampling</em>: sampling occurs at the end of the study (<span class="math inline">\(t_1\)</span>)</p></li>
</ul></li>
</ul>
<p><strong>assumption of constant incidence density rate over the period of time</strong>: <span class="math inline">\(\frac{ID_{exposed(t)}}{ID_{unexposed(t)}}=\bar{IDR}_{t_0 \to t_1}\)</span></p>
<p><strong>assumption of a stable population with respect to exposure</strong> = <strong>time is NOT a confounder</strong></p>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-03%20at%2011.21.04.png" /></p>
<ul>
<li><p>Matched on time</p>
<ul>
<li><em>incidence density sampling</em>: match on time with the cases (<span class="math inline">\(t_0 - t_1\)</span>)</li>
</ul></li>
</ul>
<p><strong>assumption of constant incidence density rate over the period of time</strong>: <span class="math inline">\(\frac{ID_{exposed(t)}}{ID_{unexposed(t)}}=\bar{IDR}_{t_0 \to t_1} \to ID_{exposed(t)} = ID_{unexposed(t)} * \bar{IDR}_{t_0 \to t_1}\)</span></p>
<p>Both incidence and exposure change in function of time, therefore time is a confounder. By selecting the controls matching on time, we can interpret the odds ratio as a rate or risk measure, without making the rare disease assumption, by assuming only that the incidence is constant over time.</p>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-03%20at%2011.24.21.png" /> <strong>INTERPRETATION OF ODDS RATIO</strong></p>
<p><span class="math display">\[\frac{\frac{P(D^+|E^+)}{P(D^-|E^+)}}{\frac{P(D^+|E^-)}{P(D^-|E^-)}}= \frac{\frac{a/a+b}{b/a+b}}{\frac{c/c+d}{d/c+d}} \ne \frac{\frac{a}{b}}{a+b}\]</span></p>
<p>Ratio of average risk <span class="math inline">\(\frac{P(D^+|E^+)}{P(D^-|E^+)}= \frac{a/a+b}{b/a+b}\)</span> to average survival probability <span class="math inline">\(\frac{P(D^+|E^-)}{P(D^-|E^-)}= \frac{c/c+d}{d/c+d}\)</span></p>
<p>which is not the same as the average disease odds <span class="math inline">\(\frac{a/b}{a+b}\)</span></p>
<p><img src="notes%20screenshots/odds_interpretation1.jpg" /> <img src="notes%20screenshots/OR2.jpg" /> <img src="notes%20screenshots/OR3.jpg" /></p>
</div>
<div id="attributable-risk" class="section level3">
<h3>attributable risk</h3>
<p>Incidence of a disease in the exposed population that is attributable to the exposure.</p>
<p>If &gt; 1 the risk in the presence of exposure is greater that not in the presence of exposure</p>
<p>How much of the disease would be prevented if the exposure were eliminated?</p>
<p><span class="math display">\[{P(D^+|E^+)}-{P(D^+|E^-)}={\frac{a}{a+b}}-{\frac{c}{c+d}}={incidence\:in\:exposed\:population} -{incidence\:in\:unexposed\:population}\]</span></p>
<p>as a proportion:</p>
<p><span class="math display">\[\frac{{P(D^+|E^+)}-{P(D^+|E^-)}}{P(D^+|E^+)}=\frac{{\frac{a}{a+b}}-{\frac{c}{c+d}}}{\frac{a}{a+b}}=\frac{{incidence\:in\:exposed\:population} -{incidence\:in\:unexposed\:population}}{incidence\:in\:exposed\:population}\]</span> <span class="math display">\[\frac{{P(D^+|E^+)}/{P(D^+|E^-)}-{P(D^+|E^-)}/{P(D^+|E^-)}}{P(D^+|E^+){P(D^+|E^-)}}= \frac{RR - 1}{RR}= 1- 1/RR\]</span></p>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-03%20at%2012.11.43.png" alt="Grodis figure 12-1" /> <img src="notes%20screenshots/Screen%20Shot%202020-12-03%20at%2012.13.13.png" alt="Gordis Table 12.1" /></p>
<p><strong>ATTRIBUTABLE FRACTIONS</strong></p>
<ul>
<li><p>Etiologic fraction: proportion of cases in exposed population where exposure has a biological role in the disease</p></li>
<li><p>Excess fraction: proportion of cases in exposed population where exposure has a role of incrementing the disease incidence vs the unexposed population</p></li>
</ul>
</div>
<div id="population-attributable-risk" class="section level3">
<h3>population attributable risk</h3>
<p>Incidence of a disease in the total population that is attributable to the exposure.</p>
<p>How much of the disease in the total population would be prevented if the exposure were eliminated?</p>
<p>Incidence in the total population: <span class="math inline">\(P(D^+|E^+) * P(E^+) + P(D^+|E^-) * P(E^-)= \frac{a}{a+b} * \frac{a+b}{a+b+c+d} + \frac{a}{c+d} * \frac{c+d}{a+b+c+d}= incidence\:in\:exposed\:population * proportion\:exposed\:population + incidence\:in\:unexposed\:population * proportion\:unexposed\:population\)</span></p>
<p><span class="math display">\[\frac{[P(D^+|E^+) * P(E^+) + P(D^+|E^-) * P(E^-)]-{P(D^+|E^-)}}{P(D^+|E^+) * P(E^+) + P(D^+|E^-) * P(E^-)}=\frac{[{\frac{a}{a+b} * \frac{a+b}{a+b+c+d} + \frac{a}{c+d} * \frac{c+d}{a+b+c+d}}]-{\frac{c}{c+d}}}{\frac{a}{a+b} * \frac{a+b}{a+b+c+d} + \frac{a}{c+d} * \frac{c+d}{a+b+c+d}}=\frac{{incidence\:in\:total\:population} -{incidence\:in\:unexposed\:population}}{incidence\:in\:total\:population}\]</span></p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-03%20at%2012.58.29.png" alt="" />
<p class="caption">Gordis formula 12-4</p>
</div>
</div>
</div>
<div id="error-in-inference" class="section level2">
<h2><strong>ERROR IN INFERENCE</strong></h2>
<ul>
<li><strong>random error</strong></li>
</ul>
<p>Chance or random variation that remains unexplained.</p>
<p>The association lacks precision. The results are less reproducible.</p>
<ul>
<li><strong>systematic error</strong> = bias</li>
</ul>
<p>The association lacks validity. The results are biased.</p>
<p><em>insert irva/Causal Inference: What If by Miguel A. Hernán, James M. Robins here</em></p>
<div id="measures-of-accuracy" class="section level3">
<h3>MEASURES OF ACCURACY</h3>
</div>
<div id="precisionreliability" class="section level3">
<h3>precision/reliability</h3>
<p>the amount of random error. High precision indicates the results are always similar in different experiments.</p>
</div>
<div id="validity" class="section level3">
<h3>validity</h3>
<p>the amount of systematic error. High validity indicates proximity to the true value</p>
<ul>
<li><p><strong>external validity</strong>: generalizability of the results to the general population</p></li>
<li><p><strong>internal validity</strong>: comparability among the groups in the study</p></li>
</ul>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-03%20at%2014.10.51.png" alt="" />
<p class="caption">Gordis figure 15-9</p>
</div>
</div>
</div>
<div id="random-error" class="section level2">
<h2>RANDOM ERROR</h2>
<ul>
<li><p><strong>unexplained variation</strong> : non-deterministic counterfactuals</p></li>
<li><p><strong>sampling error</strong> : the degree to which a sample population deviates from the total population. It’s unpredictable and due to the sampling process.</p></li>
</ul>
<p>A <strong>sample</strong> is</p>
<p>a subset of the subjects in the population that could have been included in the study = a subset of the experiences the study subjects could have had</p>
<div id="statistical-inference" class="section level3">
<h3>STATISTICAL INFERENCE</h3>
<p>approaches to deal with random error</p>
<p><strong>ASSUMPTIONS OF SAMPLING</strong></p>
<ul>
<li><p><strong>Randomness assumption</strong>: the sample is a random selection of the subjects in the population that could have been included in the study</p></li>
<li><p><strong>Representativeness assumption</strong>: the sample is representative of the subjects in the population that could have been included in the study</p></li>
</ul>
<p><strong>SAMPLING DISTRIBUTION</strong></p>
<p>Different samples result in different measures of occurrence.</p>
<p>Sample size will determine:</p>
<ul>
<li><p>the magnitude of the effect = the proximity of the measure of occurrence to the true value</p></li>
<li><p>the precision of the estimation method = <strong>statistical precision</strong>: the inverse of the variance.</p></li>
</ul>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-03%20at%2015.55.00.png" /></p>
</div>
<div id="hypothesis-testing" class="section level3">
<h3>hypothesis testing</h3>
<p><strong>interpretation of the hypothesis test</strong>:</p>
<p><span class="math inline">\(H_0\)</span>: hypothesis that there is no association between 2 variables in the superpopulation that was sampled.</p>
<ul>
<li><p>Reject the <span class="math inline">\(H_0\)</span>: Under the sampling distribution of the <span class="math inline">\(H_0\)</span>, the observed point estimate of the sample is inconsistent with the <span class="math inline">\(H_0\)</span> for a given critical threshold (<span class="math inline">\(\alpha\)</span> = 0.05).</p></li>
<li><p>Fail to reject the <span class="math inline">\(H_0\)</span>: Under the sampling distribution of the <span class="math inline">\(H_0\)</span>, the observed point estimate of the sample is consistent with the <span class="math inline">\(H_0\)</span> for a given critical threshold (<span class="math inline">\(\alpha\)</span> = 0.05). We cannot reject the <span class="math inline">\(H_0\)</span> that the superpopulation groups are the same.</p></li>
</ul>
<p><strong>MISinterpretation of the hypothesis test</strong>:</p>
<ul>
<li>Reject the <span class="math inline">\(H_0\)</span>: the superpopulation groups are the different.</li>
</ul>
<p>There could be sources of uncontrolled bias, or chance alone could haveled to this point estimate.</p>
<ul>
<li>Fail to reject the the <span class="math inline">\(H_0\)</span>: the 2 observed groups from the superpopulation are the same.</li>
</ul>
<p><img src="notes%20screenshots/EPI%20203%20NOTES%20Jan%2012,%202019hyp1.jpg" alt="Hogg,Tannis,Zimmerman" /> <img src="notes%20screenshots/EPI%20203%20NOTES%20Jan%2012,%202019hyp2.jpg" alt="Hogg,Tannis,Zimmerman" /></p>
</div>
<div id="significance-testing" class="section level3">
<h3>significance testing</h3>
<p><strong>interpretation of the significance test</strong>:</p>
<p>p-value: probability of observing a more extreme point estimate than that observed in the sample if the <span class="math inline">\(H_0\)</span> were true.</p>
<p>Reject the <span class="math inline">\(H_0\)</span>: probability of observing a more extreme point estimate than that observed in the sample if the <span class="math inline">\(H_0\)</span> were true is less than the probability of the critical region (<span class="math inline">\(\alpha\)</span> = 0.05) = the smallest critical region (<span class="math inline">\(\alpha\)</span>) that would lead us to reject the <span class="math inline">\(H_0\)</span> if it were true.</p>
<p><strong>MISinterpretation of the significance test</strong>:</p>
<ul>
<li><p>p-value: probability of the observed data under the test hypothesis Incorrect because the p-value includes all other configurations of the data that result in a more extreme test statistic than that observed in the sample.</p></li>
<li><p>p-value: probability of the observed data would show as strong an association or stronger under the test hypothesis</p></li>
</ul>
<div class="figure">
<img src="notes%20screenshots/EPI%20203%20NOTES%20Jan%2012,%202019sig.jpg" alt="" />
<p class="caption">Hogg,Tannis,Zimmerman</p>
</div>
<p><strong>STATISTICAL ESTIMATION</strong></p>
<p>Epidemiological analysis is a measurement, not a decision-making, problem. We want to estimate</p>
<ul>
<li><p><strong>the magnitude of the effect</strong> = point estimate. The proximity of the measure of occurrence to the true value depends on sample size, bias, random error, etc…</p></li>
<li><p><strong>the precision</strong> of the estimation method = <strong>statistical precision</strong>: the inverse of the variance. Uncertainty of the point estimate. It depends on the random variability, the sample size, etc…</p></li>
</ul>
<p><strong>Interval estimation</strong>: provides information on:</p>
<ul>
<li>the direction and magnitude of the association</li>
<li>the random variability in the point estimate.</li>
</ul>
<p><strong>significance testing</strong> reduce the information to a yes/no choice. It provides the degree of consistency between the data and a single hypothesis.</p>
</div>
</div>
<div id="systematic-error-bias" class="section level2">
<h2>SYSTEMATIC ERROR = BIAS</h2>
<div id="selection-bias" class="section level3">
<h3>SELECTION BIAS</h3>
<p>Non-comparability of the exposed and unexposed groups induced by a restriction in the analysis on certain level/s of a common effect of E or O or variables correlated with E or O.</p>
<p>This can be caused by:</p>
<ul>
<li><p>unbalanced sampling fractions between the exposed and non-exposed population (see example below).</p></li>
<li><p>over-matching: when the cases and controls are matched on a factor that is not associated with the outcome but is associated with exposure.</p></li>
</ul>
<p>The difference with confounding: confounding is due to unmeasured common causes and selection bias is due to errors in the selection of the two study groups that affects the internal validity.</p>
<ul>
<li><p><strong>non-response bias</strong>: survey non-respondents may have different characteristics than those who do respond</p></li>
<li><p><strong>exclusion bias</strong>: different eligibility criteria between cases and controls or the controls are selected from a different population than the cases Foor example, if the disease is very deadly and the information about the cases comes from proxies (relatives, friends) that are from a different population than the controls.</p>
<ul>
<li><p><strong>berkson’s bias</strong>: “If the only way to cross the threshold is to score high, it is more common to score high on one item than on both. This general phenomenon is sometimes called Berkson’s paradox . But it is easier to remember if we call it the <em>selection-distortion effect</em>. Why do so many restaurants in good locations have bad food? The only way a restaurant with less-than-good food can survive is if it is in a nice location. Similarly, restaurants with excellent food can survive even in bad locations. Selection-distortion ruins your city.”(<span class="citation">@mcelreath</span>). In case-control studies that select cases from hospitals, often these cases are more likely to have concomitant diseases (hypertension, obesity) than the general population, which can lead to spurious associations.</p></li>
<li><p><strong>incidence/prevalence bias</strong>: Studies that select cases from hospitals are selecting for severe disease and having survived longer. To avoid this bias it’s better to select incidence cases.</p></li>
</ul></li>
</ul>
<p><img src="notes%20screenshots/EPI%20207%20notes%20irva_sel.jpg" /></p>
<p>Selection bias does not depend only on exposure, it depends on the sampling fraction of all the cells, that means it can also depend on disease.</p>
<p><img src="index_files/figure-html/dag%20selection%20bias-1.png" width="672" /></p>
</div>
<div id="information-bias" class="section level3">
<h3>INFORMATION BIAS</h3>
<p>Bias caused by measurement errors. Individuals are categorized incorrectly.</p>
<p>For continuous variables = <strong>INFORMATION ERROR</strong></p>
<p>For categorical variables = <strong>MISCLASSIFICATION</strong></p>
<ul>
<li><p>DIFFERENTIAL: the classification error depends on the actual values of other variables, that is, it varies between the study groups. The bias can be either towards or away from the <span class="math inline">\(H_0\)</span>.</p>
<ul>
<li><p><strong>recall bias</strong>: memory of events may bary between cases and controls. Example: Outcome: congenital malformation; Exposure: any; mothers of cases may have a better memory of the exposure than mothers of controls.</p></li>
<li><p><strong>detection/surveillance bias</strong>: the diagnosis of the outcome may be earlier or better in monitored study groups than in the general population. Example: Outcome: emphysema; Exposure: smoking; smokers have more respoiratory issues and seek out medical care more often, therefore emphysema is detected earlier and more often in the exposed than in the unexposed.</p></li>
<li><p><strong>observer bias</strong>: there is a systematic difference in how data are collected between study participants belonging to different groups. Occurs when the interviewer is not blinded and when there is interviewer drift, that is, when the data collection procedure for the same interviewer changes over time.</p></li>
</ul></li>
<li><p>NON-DIFFERENTIAL: the classification error dos NOT depend on the actual values of other variables, and is due to a lack of accuracy in the data collection. This bias is usually towards the <span class="math inline">\(H_0\)</span>, diluting the magnitude of effect (RR and OR), but it can be away from the <span class="math inline">\(H_0\)</span> if the exposure or outcome variables are non-binary, or if it’s a dependent missclasification (depends on error in the classification of other variables).</p>
<ul>
<li><strong>observer bias</strong>: Example: surrogate interviews, where the information might be inaccurate.</li>
</ul>
<p>NON-DIFFERENTIAL EXPOSURE MISSCLASIFICATION</p>
<div class="figure">
<img src="notes%20screenshots/EPI%20207%20notes%20irvanondif.jpg" alt="" />
<p class="caption">Modern Epidemiology</p>
</div>
<p>NON-DIFFERENTIAL DISEASE MISSCLASIFICATION</p>
<div class="figure">
<img src="notes%20screenshots/EPI%20207%20notes%20irvadis.jpg" alt="" />
<p class="caption">Modern Epidemiology</p>
</div></li>
<li><p>DEPENDENT: the classification error depends on errors made measuring or classifying other variables.</p></li>
<li><p>INDEPENDENT: the classification error does NOT depend on errors made measuring or classifying other variables.</p></li>
</ul>
</div>
<div id="confounding" class="section level3">
<h3>CONFOUNDING</h3>
<p>The exposed and the unexposed in the study are not comparable, or exchangeable, which is the ultimate source of the bias ( the unexposed group is not the counterfactual of the exposed group)</p>
<p>A <strong>CONFOUNDER</strong> is a variable that is:</p>
<ul>
<li><p>associated with the outcome, conditional on the exposure (i.e. in the exposed group) Example: smoking is a risk factor for cancer</p></li>
<li><p>associated with the exposure, conditional on the exposure (i.e. in the exposed group) Example: smoking is associated with drinking coffee</p></li>
<li><p>not on the causal pathway between the exposure and the outcome. Example: smoking is not a result of drinking coffee</p></li>
</ul>
</div>
<div id="difference-between-confouding-and-selection-bias" class="section level3">
<h3>difference between confouding and selection bias</h3>
<ul>
<li><p>There is <strong>confounding</strong> when the association between exposure and outcome includes a noncausal component attributable to their having an uncontrolled common cause.</p></li>
<li><p>There is <strong>selection bias</strong> when the association between exposure and outcome includes a noncausal component attributable to restricting the analysis to certain level(s) of a common effect of exposure and outcome or, more generally, to conditioning on a common effect of variables correlated with exposure and outcome.</p></li>
</ul>
</div>
<div id="methods-for-identifyingdetecting-confounding" class="section level3">
<h3>methods for identifying/detecting confounding</h3>
<p>The following methods are extracted from <span class="citation">@Hernan2002</span></p>
<p><strong>Statistical criteria alone are insufficient to characterize either confounding or selection bias</strong>. The only method to reliably identify a counfounder is to combine statistical associations from the data with background knowledge about the causal network that links exposure, outcome, and potential confounders.</p>
<ul>
<li>Methods relying on statistical associations that can easily be identified from the data:</li>
</ul>
<ol style="list-style-type: decimal">
<li><p><strong>automatic variable selection procedures</strong>: i.e stepwise regression. It’s based on including variables with “significant” p-values. It assumes that all important confounders will be selected.</p></li>
<li><p><strong>change in effect estimate</strong>: comparison of the effect estimates between adjusted and unadjusted effect estimates. It assumes that any variable substantially associated with an estimate change is worth adjusting for.</p></li>
</ol>
<p>We evaluate the effect measure of the exposure of interest: crude and stratified by the possible confounder. If the stratum-specific effect measures are similar to each other but different to the crude effect measure and the relative change greater than 10%, the variable is selected as a confounder. This change can be evaluated on the probability scale or transformed scale (exampe <span class="math inline">\(\beta\)</span> coefficient or OR for the exposure in a logistic model)</p>
<p>Example: Is the association causal or confounded by age?</p>
<p><img src="notes%20screenshots/strat%20example.png" /></p>
<p><img src="notes%20screenshots/strat.png" /></p>
<ul>
<li>Methods that combine statistical associations from the data with background knowledge:</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><strong>check whether the variable meets the criteria of a confounder</strong>: combines information from statistical associations and background knowledge. The presence of common causes, and therefore of confounding, can be represented by causal diagrams known as directed acyclic graphs (DAGs).</li>
</ol>
<p><strong>DAG = Directed Acyclic Graph</strong></p>
<p>DAGs are diagrams that link variables by arrows that represent direct causal effects (protective or causative) of one variable on another.</p>
<p>There are only four types of variable relations that combine to form all possible paths (from <span class="citation">@mcelreath2020</span>):</p>
<ol style="list-style-type: decimal">
<li><p>the <strong>confounder</strong> = <strong>fork</strong>: X ← Z → Y. This is the classic confounder: some variable Z is a common cause of X and Y, generating a correlation between them. If we condition on Z, then learning X tells us nothing about Y. X and Y are independent, conditional on Z.</p></li>
<li><p>the <strong>pipe</strong> = <strong>intermediary</strong>: X → Z → Y. The treatment X influences Z which influences Y. If we condition on Z, we block the path from X to Y. X and Y are independent, conditional on Z.</p></li>
<li><p>the <strong>collider</strong> = <strong>common effect</strong>: X → Z ← Y. Conditioning on Z, the collider variable, opens the path. X and Y are dependent, conditional on Z, however neither X nor Y has any causal influence on the other.</p></li>
<li><p>the <strong>descendent</strong> = <strong>association?</strong>: Z <span class="math inline">\(\to\)</span> D. Descendent is a variable influenced by another variable. Conditioning on a descendent partly conditions on its parent. Conditioning on D will also condition, to a lesser extent, on Z because D has some information about Z.</p></li>
</ol>
<p><strong>Backdoor criterion</strong></p>
<p>Path: any series of variables you could walk through to get from one variable to another, ignoring the directions of the arrows.</p>
<p>Blocking all confounding paths between some predictor X and some outcome Y is known as shutting the backdoor, thus eliminating spurious associations that are non-causal.</p>
<p>Example:</p>
<p><img src="index_files/figure-html/confounder%201-1.png" width="672" /></p>
<p>There are two paths connecting E and O:</p>
<ol style="list-style-type: decimal">
<li><p>E → O</p></li>
<li><p>E ← C → O.</p></li>
</ol>
<p>Both of these paths create a statistical association between E and O. But only the first path is causal. The second path is non-causal. If only the second path existed, and we changed E, it would not change O. Any causal influence of E on O operates only on the first path.</p>
<p>REMINDER:</p>
<ul>
<li><p>causal effect: The total causal effect is the sum of the direct and indirect effects: Example: age of marriage influences divorce in two ways.</p>
<ul>
<li><p>direct effect. A <span class="math inline">\(\to\)</span> D Example: a direct effect would arise because younger people change faster than older people and are therefore more likely to grow incompatible with a partner.</p></li>
<li><p>indirect effect. A <span class="math inline">\(\to\)</span> M <span class="math inline">\(\to\)</span> D Example: age of marriage has an indirect effect by influencing the marriage rate, which then influences divorce. If people get married earlier, then the marriage rate may rise, because there are more young people. Consider for example if an evil dictator forced everyone to marry at age 65. Since a smaller fraction of the population lives to 65 than to 25, forcing delayed marriage will also reduce the marriage rate. If marriage rate itself has any direct effect on divorce, maybe by making marriage more or less normative, then some of that direct effect could be the indirect effect of age at marriage.</p></li>
</ul></li>
</ul>
<p><img src="index_files/figure-html/dag1.3%20ex1-1.png" width="672" /></p>
<ul>
<li>spurious effect</li>
</ul>
<p><img src="index_files/figure-html/dag2%20ex1-1.png" width="672" /></p>
<p><strong>Do-operator</strong></p>
<p>do(E) closes the backdoor paths into E, as in a manipulative experiment.</p>
<p>P(O|do(E)) defines a causal relationship because it tells us the expected result of manipulating E on O</p>
<ul>
<li><p>Confounding: P(O|E) <span class="math inline">\(\ne\)</span> P(O|do(E)). The relationship between the E and O when the backdoor paths are closed is not the same, indicating that there is confounding.</p></li>
<li><p>Conditional probability, non-causal: P(O|E) <span class="math inline">\(\ne\)</span> P(O|not-E) doesn’t close the backdoor, and therefore does not give a causal relationship.</p></li>
<li><p>Total causal relationship: if P(O|do(E)) <span class="math inline">\(\ne\)</span> P(O|not-E), then E is the cause of O.</p></li>
<li><p>Direct causal relationship: might require closing more backdoor paths.</p></li>
</ul>
<p>Examples from <span class="citation">@Hernan2002</span></p>
<p><img src="notes%20screenshots/EPI%20207%20notes%20irva%20dag1.jpg" /></p>
<p><img src="notes%20screenshots/EPI%20207%20notes%20irva%20dag2.jpg" /></p>
<p>Example using all 3 methods of identifying confounders:</p>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-07%20at%2013.39.14.png" /></p>
<p><strong>Steps to identify which variables are confounders and must be controlled to obtain and unbiased causal effect estimate</strong>:</p>
<ol style="list-style-type: decimal">
<li><p>List all of the paths connecting E (the potential cause of interest) and O (the outcome).</p></li>
<li><p>Classify each path by whether it is open or closed. A path is open unless it contains a collider.</p></li>
<li><p>Classify each path by whether it is a backdoor path. A backdoor path has an arrow entering E.</p></li>
<li><p>If there are any open backdoor paths, decide which variable(s) to condition on to close it (if possible). To obtain a <strong>sufficient set</strong>, use the smallest set of confounders (preferable closer to the outcome)</p></li>
</ol>
<ul>
<li><p>Obtaining an unbiased estimate of the <strong>total causal effect</strong> requires measuring and adjusting for all confounders of the E <span class="math inline">\(\to\)</span> O association</p></li>
<li><p>Obtaining an unbiased estimate of the <strong>direct causal effect</strong> requires measuring and adjusting for all confounders of both the</p>
<ul>
<li><p>E <span class="math inline">\(\to\)</span> O association</p></li>
<li><p>J <span class="math inline">\(\to\)</span> O association</p></li>
</ul></li>
</ul>
<ol style="list-style-type: decimal">
<li>Example 1</li>
</ol>
<p><img src="index_files/figure-html/dag1.4%20ex1-1.png" width="672" /></p>
<ul>
<li><p>To obtain the <strong>total causal effect</strong> we don’t condition on C or J:</p>
<ul>
<li>C is a confounder of the J <span class="math inline">\(\to\)</span> O association but not the E <span class="math inline">\(\to\)</span> O association, thanks to J which is a collider and blocks the path between C <span class="math inline">\(\to\)</span> E, so it is unnecessary to control for C</li>
</ul></li>
</ul>
<p><img src="index_files/figure-html/adjust%20C%20ex-1.png" width="672" /></p>
<ul>
<li>J is a <strong>collider</strong> of the E <span class="math inline">\(\to\)</span> C association so if we condition on J we create a backdoor path between O <span class="math inline">\(\to\)</span> E through C.</li>
</ul>
<p><img src="index_files/figure-html/adjust%20J%20ex-1.png" width="672" /></p>
<ul>
<li>To obtain the <strong>direct causal effect</strong> we condition on both J and C, because we want only the</li>
</ul>
<p><img src="index_files/figure-html/adjust%20JC%20ex-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Example 2</li>
</ol>
<p><img src="index_files/figure-html/dag1.4%20ex2-1.png" width="672" /></p>
<ul>
<li><p>To obtain the <strong>total causal effect</strong> we condition on C but not J:</p>
<ul>
<li>C is a confounder of the E <span class="math inline">\(\to\)</span> O association so we must condition on it to obtain the unbiased total causal effect</li>
</ul></li>
</ul>
<p><img src="index_files/figure-html/adjust%20C%20ex2-1.png" width="672" /></p>
<ul>
<li>To obtain the <strong>direct causal effect</strong> we condition on J. C is no longer a confounder because we block the path through J so it’s no longer associated with O.</li>
</ul>
<p><img src="index_files/figure-html/adjust%20J%20ex2-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Example 3.</li>
</ol>
<p><img src="index_files/figure-html/dag1.5%20ex-1.png" width="672" /></p>
<ul>
<li>To obtain the total causal effect we condition on D</li>
</ul>
<p><img src="index_files/figure-html/adjust%20D%20ex-1.png" width="672" /></p>
<ul>
<li>To obtain the total causal effect we condition on C, D, J</li>
</ul>
<p><img src="index_files/figure-html/adjust%20JCD%20ex-1.png" width="672" /></p>
<p><strong>TESTABLE IMPLICATIONS</strong></p>
<p>Testable implications can be read off the diagrams using a graphical criterion known as <strong>d- separation</strong> (Pearl, 1988). Each diagram encodes causal assumptions, each corresponding to a missing arrow or a missing double-arrow between a pair of variables.</p>
<p>DAGs imply that some variables are independent of others under certain conditions, therefore the testable implications of a DAG are it’s <strong>CONDITIONAL INDEPENDENCIES</strong>.</p>
<p><strong>CONDITIONAL INDEPENDENCIES</strong> describe which variables should be associated with one another (or not) in the data, and which variables become disassociated when we condition on some other set of variables.</p>
<p>Condition independencies are pairs of variables that are not associated, once we condition on some set of other variables.</p>
<p><strong>Conditioning</strong>: conditioning on a variable Z means learning its value and then asking if X adds any additional information about Y. If learning X doesn’t give you any more information about Y, then we might say that Y is independent of X conditional on Z. This conditioning statement is sometimes written as: <span class="math inline">\(Y \!\perp\!\!\!\perp X|Z\)</span></p>
<p><span class="math inline">\(X \not\!\perp\!\!\!\perp Y\)</span> means “not independent of”</p>
<p><span class="math inline">\(X \!\perp\!\!\!\perp Y\)</span> means “independent of”</p>
<p><strong>Marginal and conditional assotiation</strong></p>
<div class="figure">
<img src="notes%20screenshots/EPI%20207%20notes%20irva%20ass.jpg" alt="" />
<p class="caption">Modern Epidemiology</p>
</div>
</div>
<div id="methods-for-controlling-confounding-obtaining-an-unbiased-estimate-of-the-causal-effect" class="section level3">
<h3>methods for controlling confounding = obtaining an unbiased estimate of the causal effect</h3>
<p><strong>DURING STUDY DESIGN</strong></p>
<p>Manipulation of the confounding factor in the study design removes the influence of C on E: when we determine E, the C variable does not influence E, thus blocking the non-causal path between E and O (E ← C → O). Once the path is blocked, there is only one way for information to go between E and O, and then measuring the association between E and O would yield a useful measure of causal influence.</p>
<ul>
<li><strong>Randomization</strong>: limits confounding by unmeasured factors probabilistically and accounts quantitavely for any residual confounding they produce.</li>
</ul>
<p>Limitations: feasibility, ethics</p>
<ul>
<li><strong>Restriction</strong>: the individuals in the study may be selected to have equal levels of the confounder.</li>
</ul>
<p>Limitations: reduction of the number of available individuals, the factor that is used for restriction can’t be analyzed, possible residual confounding if the restriction is insufficient.</p>
<ul>
<li><strong>Matching</strong>: it does not control for confounding, but it increases the efficiency of the study that does control for confounding, as the confounding factor may still be controlled in the analysis.</li>
</ul>
<p>Limitations: expensive, complicated logistics, the factor that is used for matching can’t be analyzed, as the variables must be collected before participant enrollment</p>
<p><strong>DURING DATA ANALYSIS</strong></p>
<p>Conditioning on the confounding factor in the study analysis: adding C to the model blocks the non-causal path E ← C → O.</p>
<p>Why? Think of this path in isolation, as a complete model.</p>
<p><img src="index_files/figure-html/dag%20confounder%20condition%20ex1-1.png" width="672" /></p>
<p>Once you learn C, also learning E will give you no additional information about O.</p>
<p>Example: Suppose for example that C is the average wealth in a region. Regions with high wealth have better schools, resulting in more education (exposure E), as well as better paying jobs, resulting in higher wages (outcome O). If you don’t know the region a person lives in, learning the person’s education E will provide information about their wages O, because E and O are correlated across regions. But after you learn which region a person lives in, assuming there is no other path between E and O, then learning E tells you nothing more about O. This is the sense in which conditioning on C blocks the path — it makes E and O independent, conditional on C.</p>
<ul>
<li><strong>multivariate adjustment</strong>: using regression, ANOVA, etc.. It can handle multiple covariates at the same time.</li>
</ul>
<p>Limitations: unless background knowledge is included in the variable selection, confounding can persist.</p>
<ul>
<li><strong>stratification</strong>: the data is stratified by a confounder and the weighted averages of the effect measure (RR or OR) across strata is calculated and then compared to the crude estimate and to each other using the Cochran-Maentel-Haenszel estimate. <span class="math inline">\(OR_{EO}\)</span> vs <span class="math inline">\(OR_{EO|C}\)</span></li>
</ul>
<p>Limitations: can only be performed for few variables at a time</p>
<ul>
<li><strong>standarization</strong>: re-weight the stratum-specific effect measures (RR, OR) so that the categories are comparable using a reference population from the data set r an external source.</li>
</ul>
<p>Limitations: can only be performed for few variables at a time</p>
<ul>
<li><strong>inverse probability treatment</strong>: creates a pseudo-population without confounding by re-weighting, yet the true exposure is not altered. It can be used for time-dependent confounding, when earlier exposure can influence later exposure.</li>
</ul>
<div class="figure">
<img src="notes%20screenshots/EPI%20207%20notes%20irva%20inverse.jpg" alt="" />
<p class="caption">Modern Epidemiology</p>
</div>
</div>
<div id="confounding-example-from-mcelreath2020" class="section level3">
<h3>confounding example from <span class="citation">@mcelreath2020</span></h3>
<p>We look into causal inference using a working example from Statistical Rethinking: A Bayesian Course with Examples in R and Stan. Second edition by Richard McElreath: Correlation between marriage rate (the exposure) and divorce rate (the outcome).</p>
<pre class="r"><code># load data and copy 
library(rethinking) 
data(WaffleDivorce) 
d &lt;- WaffleDivorce
# standardize variables
d$D &lt;- standardize( d$Divorce )
d$M &lt;- standardize( d$Marriage )
d$A &lt;- standardize( d$MedianAgeMarriage )</code></pre>
<p><strong>EXAMPLE 1</strong></p>
<p>There are three observed variables in play: divorce rate (D), marriage rate (M), and the median age at marriage (A) in each State of the U.S. Both marriage rates and median age at marriage are great predictors of the divorce rate in a given State, but are these relationships causal?</p>
<p>The rate at which adults marry (M) is a great predictor of divorce rate. But does marriage cause divorce? In a trivial sense it obviously does: One cannot get a divorce without first getting married. But there’s no reason high marriage rate must cause more divorce. It’s easy to imagine high marriage rate indicating high cultural valuation of marriage and therefore being associated with low divorce rate.</p>
<p>Age at marriage (A) is also a good predictor of divorce rate— higher age at marriage predicts less divorce. But there is no reason this has to be causal, either, unless age at marriage is very late and the spouses do not live long enough to get a divorce.</p>
<p>Age of marriage influences divorce in two ways:</p>
<p><img src="index_files/figure-html/dag1.3%20ex-1.png" width="672" /></p>
<ul>
<li>direct effect: a direct effect would arise because younger people change faster than older people and are therefore more likely to grow incompatible with a partner.</li>
</ul>
<p><img src="index_files/figure-html/dag1.1%20ex-1.png" width="672" /></p>
<ul>
<li>indirect effect: age of marriage has an indirect effect by influencing the marriage rate, which then influences divorce. If people get married earlier, then the marriage rate may rise, because there are more young people. Consider for example if an evil dictator forced everyone to marry at age 65. Since a smaller fraction of the population lives to 65 than to 25, forcing delayed marriage will also reduce the marriage rate. If marriage rate itself has any direct effect on divorce, maybe by making marriage more or less normative, then some of that direct effect could be the indirect effect of age at marriage.</li>
</ul>
<p><img src="index_files/figure-html/dag1.2%20ex-1.png" width="672" /></p>
<p>To infer the strength of these different arrows, we need more than one statistical model.</p>
<p>To obtain the <strong>total effect</strong> of of age at marriage on divorce rate we condition on age at marriage.</p>
<p>The total causal effect is the sum of the direct and indirect effects</p>
<p><img src="index_files/figure-html/dag%20ex1-1.png" width="672" /></p>
<p>We assume that these variables are associated. If we look in the data and find that any pair of variables are not associated, then something is wrong with the DAG (assuming the data are correct). In these data, all three pairs are in fact strongly associated. We can use cor to measure simple correlations. Correlations are sometimes terrible measures of association—many different patterns of association with different implications can produce the same correlation. But they do honest work in this case.</p>
<pre class="r"><code>cor(d$D, d$M)</code></pre>
<pre><code>## [1] 0.3737314</code></pre>
<pre class="r"><code>cor(d$D, d$A)</code></pre>
<pre><code>## [1] -0.5972392</code></pre>
<pre class="r"><code>cor(d$M, d$A)</code></pre>
<pre><code>## [1] -0.721096</code></pre>
<ul>
<li><strong>Model conditioning on A</strong></li>
</ul>
<p><span class="math inline">\(D_{i} ∼ Normal(\mu_{i}, \sigma)\)</span></p>
<p><span class="math inline">\(\mu_{i} = \alpha + \beta_{A}A_{i}\)</span></p>
<pre class="r"><code>m5.1 &lt;- quap(
    alist(
        D ~ dnorm( mu , sigma ) ,
        mu &lt;- a + bA * A ,
        a ~ dnorm( 0 , 0.2 ) ,
        #when βA = 1, a change of 1.2 years in median age at marriage is associated with a full standard deviation change in the outcome variable (divorce)
        #only 5% of plausible slopes more extreme than 1.
        bA ~ dnorm( 0 , 0.5 ) ,
        sigma ~ dexp( 1 )
) , data = d )

precis(m5.1)</code></pre>
<pre><code>##                mean         sd       5.5%      94.5%
## a     -2.631398e-07 0.09737876 -0.1556303  0.1556298
## bA    -5.684035e-01 0.10999980 -0.7442044 -0.3926025
## sigma  7.883257e-01 0.07801133  0.6636485  0.9130028</code></pre>
<p>The outcome and the predictor are both standardized, the intercept α should end up very close to zero.</p>
<p>What does the prior slope <span class="math inline">\(\beta_{A}\)</span> imply? If <span class="math inline">\(\beta_{A}\)</span> = 1, that would imply that a change of one standard deviation in age at marriage is associated likewise with a change of one standard deviation in divorce. To know whether or not that is a strong relationship, you need to know how big a standard deviation of age at marriage is:</p>
<pre class="r"><code> sd( d$MedianAgeMarriage )</code></pre>
<pre><code>## [1] 1.24363</code></pre>
<p>So when <span class="math inline">\(\beta_{A}\)</span> = 1, a change of 1.2 years in median age at marriage is associated with a full standard deviation change in the outcome variable. That seems like an insanely strong relationship.</p>
<p>posterior for <span class="math inline">\(\beta_{A}\)</span> is reliably negative, as seen:</p>
<pre class="r"><code># compute percentile interval of mean
A_seq &lt;- seq( from=-3 , to=3.2 , length.out=30 )
mu &lt;- link( m5.1 , data=list(A=A_seq) )
mu.mean &lt;- apply( mu , 2, mean )
mu.PI &lt;- apply( mu , 2 , PI )
# plot it all
plot( D ~ A , data=d , col=rangi2 )
lines( A_seq , mu.mean , lwd=2 )
shade( mu.PI , A_seq )</code></pre>
<p><img src="index_files/figure-html/5.5%20ex-1.png" width="672" /></p>
<p>Model m5.1, the regression of D on A, tells us only that the total influence of age at marriage is strongly negative with divorce rate. The “total” here means we have to account for every path from A to D. There are two such paths in this graph: A → D, a direct path,and A → M → D, an indirect path.</p>
<p><img src="index_files/figure-html/total%20effect%20dag%20ex-1.png" width="672" /></p>
<p>In general, it is possible that a variable like A has no direct effect at all on an outcome like D. It could still be associated with D entirely through the indirect path. That type of relationship is known as <strong>mediation</strong>.</p>
<p>As you’ll see however, the indirect path does almost no work in this case. How can we show that?</p>
<ul>
<li><strong>Model conditioning on M</strong></li>
</ul>
<p><span class="math inline">\(D_{i} ∼ Normal(\mu_{i}, \sigma)\)</span></p>
<p><span class="math inline">\(\mu_{i} = \alpha + \beta_{M}M_{i}\)</span></p>
<pre class="r"><code>m5.2 &lt;- quap(
    alist(
        D ~ dnorm( mu , sigma ) ,
        mu &lt;- a + bM * M ,
        a ~ dnorm( 0 , 0.2 ) ,
        bM ~ dnorm( 0 , 0.5 ) ,
        sigma ~ dexp( 1 )
) , data = d )

precis(m5.2)</code></pre>
<pre><code>##               mean         sd       5.5%     94.5%
## a     3.302324e-05 0.10824680 -0.1729663 0.1730323
## bM    3.500236e-01 0.12592822  0.1487660 0.5512812
## sigma 9.102698e-01 0.08986353  0.7666506 1.0538891</code></pre>
<pre class="r"><code># compute percentile interval of mean
M_seq &lt;- seq( from=-3 , to=3.2 , length.out=30 )
mu &lt;- link( m5.2 , data=list(M=M_seq) )
mu.mean &lt;- apply( mu , 2, mean )
mu.PI &lt;- apply( mu , 2 , PI )
# plot it all
plot( D ~ M , data=d , col=rangi2 )
lines( M_seq , mu.mean , lwd=2 )
shade( mu.PI , M_seq )</code></pre>
<p><img src="index_files/figure-html/5.6%20ex-1.png" width="672" /></p>
<p>This relationship isn’t as strong as the one between A and D.</p>
<p>The pattern we see in the previous two models is symptomatic of a situation in which only one of the predictor variables, A in this case, has a causal impact on the outcome, D, even though both predictor variables are strongly associated with the outcome.</p>
<p>We know from the model conditioning on M (m5.2) that marriage rate is positively associated with divorce rate. But that isn’t enough to tell us that the path M → D is positive. It could be that the association between M and D arises entirely from A’s influence on both M and D. Like this:</p>
<p><img src="index_files/figure-html/dag%20mediation-1.png" width="672" /></p>
<p>This DAG is also consistent with the posterior distributions of models m5.1 and m5.2. Why? Because both M and D “listen” to A. They have information from A. So when you inspect the association between D and M, you pick up that common information that they both got from listening to A.</p>
<p>So which is it? Is there a direct effect of marriage rate, or rather is age at marriage just driving both, creating a spurious correlation between marriage rate and divorce rate? To find out, we need to consider carefully what each DAG implies.</p>
<ol style="list-style-type: decimal">
<li><strong>M has influence on D</strong></li>
</ol>
<p><img src="index_files/figure-html/dag1-1.png" width="672" /></p>
<p>This DAG says:</p>
<ol style="list-style-type: decimal">
<li>A directly influences D</li>
<li>M directly influences D</li>
<li>A directly influences M</li>
</ol>
<p>There are 3 causal assumptions that can be tested (one for every arrow).</p>
<p>Before we condition on anything, we assume everything is associated with everything else.</p>
<p>The testable implications are:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(D \not\!\perp\!\!\!\perp A\)</span> A not independent of D</li>
<li><span class="math inline">\(D \not\!\perp\!\!\!\perp M\)</span> M not independent of D</li>
<li><span class="math inline">\(A \not\!\perp\!\!\!\perp M\)</span> D not independent of A</li>
</ol>
<p>implied conditional independencies = none</p>
<pre class="r"><code>DMA_dag1 &lt;- dagitty(&#39;dag{ D &lt;- A -&gt; M -&gt; D }&#39;)

impliedConditionalIndependencies( DMA_dag1  )</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><strong>M has no influence on D</strong></li>
</ol>
<p><img src="index_files/figure-html/dag%20no%20DM-1.png" width="672" /></p>
<p>In this DAG, it is still true that all three variable are associated with one another. A is associated with D and M because it influences them both. And D and M are associated with one another, because A influences them both. They share a cause, and this leads them to be correlated with one another through that cause.</p>
<p>There are 2 causal assumptions that can be tested (one for every arrow).</p>
<ol style="list-style-type: decimal">
<li>A causes D</li>
</ol>
<p><del>(2) M causes D</del></p>
<ol start="3" style="list-style-type: decimal">
<li>A causes M</li>
</ol>
<p>But suppose we condition on A. All of the information in M that is relevant to predicting D is in A. So once we’ve conditioned on A, M tells us nothing more about D. So in the second DAG, a testable implication is that D is independent of M, conditional on A. In other words, <span class="math inline">\(D \!\perp\!\!\!\perp M|A\)</span></p>
<p>The testable implications are:</p>
<p>All 3 variables should be associated, before conditioning on anything:</p>
<ol style="list-style-type: decimal">
<li><p><span class="math inline">\(D \not\!\perp\!\!\!\perp A\)</span> A not independent of D</p></li>
<li><p><span class="math inline">\(D \not\!\perp\!\!\!\perp M\)</span> M not independent of D</p></li>
<li><p><span class="math inline">\(A \not\!\perp\!\!\!\perp M\)</span> D not independent of A</p></li>
<li><p><span class="math inline">\(D \!\perp\!\!\!\perp M|A\)</span> D and M should be independent after conditioning on A.</p></li>
</ol>
<p>implied conditional independencies = D <em>||</em> M | A</p>
<pre class="r"><code>DMA_dag2 &lt;- dagitty(&#39;dag{ D &lt;- A -&gt; M }&#39;) 
impliedConditionalIndependencies( DMA_dag2  )</code></pre>
<pre><code>## D _||_ M | A</code></pre>
<p><strong>Test the difference between the two DAGs</strong></p>
<p>The only implication that differs between these DAGs is the last one:<span class="math inline">\(D \!\perp\!\!\!\perp M|A\)</span> D and M should be independent after conditioning on A.</p>
<p>To test this implication, we need a statistical model that conditions on A, so we can see whether that renders D independent of M. And that is what multiple regression helps with. It can address a useful descriptive question: <em>Is there any additional value in knowing a variable, once I already know all of the other predictor variables?</em></p>
<p>So for example once you fit a multiple regression to predict divorce using both marriage rate and age at marriage, the model addresses the questions: (1) After I already know marriage rate, what additional value is there in also knowing age at marriage? (2) After I already know age at marriage, what additional value is there in also knowing marriage rate?</p>
<p>The parameter estimates corresponding to each predictor are the (often opaque) answers to these questions. The questions above are descriptive, and the answers are also descriptive. It is only the derivation of the testable implications above that give these descriptive results a causal meaning. But that meaning is still dependent upon believing the DAG.</p>
<p>For each predictor, the parameter measures its conditional association with the outcome.</p>
<ul>
<li><strong>Model conditioning on A and M</strong></li>
</ul>
<p><span class="math inline">\(D_{i} ∼ Normal(\mu_{i}, \sigma)\)</span></p>
<p><span class="math inline">\(\mu_{i} = \alpha + \beta_{M}M_{i} + \beta_{A}A_{i}\)</span></p>
<pre class="r"><code>m5.3 &lt;- quap(
    alist(
        D ~ dnorm( mu , sigma ) ,
        mu &lt;- a + bM*M + bA*A ,
        a ~ dnorm( 0 , 0.2 ) ,
        bM ~ dnorm( 0 , 0.5 ) ,
        bA ~ dnorm( 0 , 0.5 ) ,
        sigma ~ dexp( 1 )
    ) , data = d )
precis( m5.3 )</code></pre>
<pre><code>##                mean         sd       5.5%      94.5%
## a     -2.645879e-07 0.09707598 -0.1551464  0.1551459
## bM    -6.538020e-02 0.15077298 -0.3063445  0.1755841
## bA    -6.135132e-01 0.15098352 -0.8548140 -0.3722124
## sigma  7.851175e-01 0.07784327  0.6607089  0.9095261</code></pre>
<p>The posterior mean for marriage rate, bM, is now close to zero, with plenty of probability of both sides of zero. The posterior mean for age at marriage, bA, is essentially unchanged. It will help to visualize the posterior distributions for all three models, focusing just on the slope parameters βA and βM:</p>
<pre class="r"><code>plot(coeftab(m5.1,m5.2,m5.3), par=c(&quot;bA&quot;,&quot;bM&quot;))</code></pre>
<p><img src="index_files/figure-html/compare%20coefficients-1.png" width="672" /></p>
<p>bA doesn’t move, only grows a bit more uncertain, while bM is only associated with divorce when age at marriage is missing from the model. You can interpret these distributions as saying: <em>Once we know median age at marriage for a State, there is little or no additional predictive power in also knowing the rate of marriage in that State</em>, which means <span class="math inline">\(D \!\perp\!\!\!\perp M|A\)</span>. D and M are independent after conditioning on A, which corresponds to the second DAG.</p>
<p><img src="index_files/figure-html/dag%205.3-1.png" width="672" /></p>
<p>Note that this does not mean that there is no value in knowing marriage rate. Consistent with the earlier DAG, if you didn’t have access to age-at-marriage data, then you’d definitely find value in knowing the marriage rate. M is predictive but not causal. Assuming there are no other causal variables missing from the model, this implies there is no important direct causal path from marriage rate to divorce rate. The association between marriage rate and divorce rate is spurious, caused by the influence of age of marriage on both marriage rate and divorce rate.</p>
<p><strong>EXAMPLE 2</strong></p>
<p>We’re interested in the total causal effect of the number of Waffle Houses on divorce rate in each State. Presumably, the naive correlation between these two variables is spurious. What is the minimal adjustment set that will block backdoor paths from Waffle House to divorce?</p>
<p>Let’s make a graph:</p>
<p><img src="index_files/figure-html/waffle%20dag-1.png" width="672" /></p>
<pre><code>## { A, M }
## { S }</code></pre>
<p><img src="index_files/figure-html/waffle%20dag-2.png" width="672" /></p>
<p>We could control for either A and M or for S alone. This DAG is obviously not satisfactory—it assumes there are no unobserved confounds, which is very unlikely for this sort of data. But we can still learn something by analyzing it. While the data cannot tell us whether a graph is correct, it can sometimes suggest how a graph is wrong.</p>
<p>Inspecting implied conditional independencies, we can at least test some of the features of a graph.</p>
<pre class="r"><code> impliedConditionalIndependencies( dag6 )</code></pre>
<pre><code>## A _||_ W | S
## D _||_ S | A, M, W
## M _||_ W | S</code></pre>
<ol style="list-style-type: decimal">
<li><p>The median age of marriage should be independent of (<em>||</em>) Waffle Houses, conditioning on (|) a State being in the south.</p></li>
<li><p>Divorce and being in the south should be independent when we simultaneously condition on all of median age of marriage, marriage rate, and Waffle Houses.</p></li>
<li><p>Marriage rate and Waffle Houses should be independent, conditioning on being in the south.</p></li>
</ol>
</div>
</div>
<div id="interaction-and-effect-measure-modification" class="section level2">
<h2>INTERACTION and EFFECT MEASURE MODIFICATION</h2>
<p>An interaction occurs when the measure of association between a risk factor and outcome depends on the level of another factor.</p>
<div id="difference-between-interaction-and-confounding" class="section level3">
<h3>difference between interaction and confounding</h3>
<table>
<colgroup>
<col width="25%" />
<col width="45%" />
<col width="28%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">confounding</th>
<th align="left">interaction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">origin</td>
<td align="left">property of distribution in source popuation</td>
<td align="left">biologic, sociologic…</td>
</tr>
<tr class="even">
<td align="left">distribution of the 3d variable</td>
<td align="left">differs by exposure status</td>
<td align="left">can be statistically independent of exposure</td>
</tr>
<tr class="odd">
<td align="left">does the 3d variable predic the outcome?</td>
<td align="left">yes</td>
<td align="left">not necessarily</td>
</tr>
<tr class="even">
<td align="left">stratum-specific measures</td>
<td align="left">similar across strata</td>
<td align="left">differ across strata</td>
</tr>
<tr class="odd">
<td align="left">crude overall measure</td>
<td align="left">differ from stratum-specific measures</td>
<td align="left">falls between stratum-specific measures</td>
</tr>
<tr class="even">
<td align="left">summary adjusted measure</td>
<td align="left">makes sense</td>
<td align="left">not meaningful</td>
</tr>
<tr class="odd">
<td align="left">testing</td>
<td align="left">cannot test</td>
<td align="left">can test</td>
</tr>
<tr class="even">
<td align="left">relationship to the other</td>
<td align="left">if a strong interaction exists, it makes no sense to discuss confounding</td>
<td align="left">both may occur</td>
</tr>
</tbody>
</table>
</div>
<div id="difference-between-interaction-and-effect-measure-modification" class="section level3">
<h3>difference between interaction and effect measure modification</h3>
<p>Interaction, effect modification and effect heterogeneity sometimes are used to mean the same thing.</p>
<p>Interaction Tables</p>
<ul>
<li>Risk of disease</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">A no</th>
<th align="left">A yes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">B no</td>
<td align="left">Rab</td>
<td align="left">RAb</td>
</tr>
<tr class="even">
<td align="left">B yes</td>
<td align="left">RaB</td>
<td align="left">RAB</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>INTERACTION</strong>: we are equally interested in the change in RR in the presence of A and B and the combination of A and B.</li>
</ul>
<p>Relative Risk in Interaction</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">A no</th>
<th align="left">A yes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">B no</td>
<td align="left">1</td>
<td align="left">RAb/Rab</td>
</tr>
<tr class="even">
<td align="left">B yes</td>
<td align="left">RaB/Rab</td>
<td align="left">RAB/Rab</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>EFFECT MODIFICATION</strong>: we are interested in the change in RR of one of the variables in the presence of the other variable. Example: how does B change on different levels of A?</li>
</ul>
<p>To obtain the relative risk measure, we divide the risk measures in the presence of A by the referent within each level of B, thus we have 2 groups, one for each strata.</p>
<p>Relative Risk in effect modification</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">A no</th>
<th align="left">A yes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">B no</td>
<td align="left">1</td>
<td align="left">RaB/Rab</td>
</tr>
<tr class="even">
<td align="left">B yes</td>
<td align="left">1</td>
<td align="left">RAB/RAb</td>
</tr>
</tbody>
</table>
</div>
<div id="types-of-interaction" class="section level3">
<h3>types of interaction</h3>
<ul>
<li><p><strong>synergism</strong>: the additive measure of joint exposure is MORE THAN the sum of the measures of association between exposure and outcome for each exposure alone.</p></li>
<li><p><strong>antagonism</strong>: the additive measure of joint exposure is LESS THAN the sum of the measures of association between the exposure and outcome for each exposure alone.</p></li>
</ul>
</div>
<div id="types-of-interaction-effect" class="section level3">
<h3>types of interaction effect</h3>
<ul>
<li><p><strong>additive</strong>: Excess risk and linear regression are on the additive scale.</p></li>
<li><p><strong>multiplicative</strong>: Relative risk, logistic, Poisson and porportional hazards models all assume factors act multiplicatively unless an interaction effect is included.</p></li>
</ul>
<div class="figure">
<img src="notes%20screenshots/EPI%20205%20notes%20Sep%2028,%202018%20multadd.jpg" alt="" />
<p class="caption">Gordis</p>
</div>
<p>Example:</p>
<p>A logistic regression is on the additive scale when it’s transformed:</p>
<p><span class="math inline">\(logit(\hat{p_i}) = log(p_i/(1-p_i)) = log(ODDS) =\beta_0 +\beta_A x_A + \beta_B x_B + +\beta_{AB} x_A x_B\)</span></p>
<p>But a logistic regression is on the multiplicative scale when it’s on the original probability scale:</p>
<p><span class="math inline">\(p_i/(1-p_i) = ODDS =e^{\beta_0 +\beta_A x_A + \beta_B x_B + +\beta_{AB} x_A x_B}\)</span></p>
<p>Is A and effect modifier of B? What is the effect of B versus no B?</p>
<ul>
<li><p>In the presence of A: <span class="math inline">\(x_A = 1\)</span></p>
<ul>
<li>In the presence of B: <span class="math inline">\(x_B = 1\)</span></li>
</ul>
<p><span class="math inline">\(log(ODDS) =\beta_0 +\beta_A x_A + \beta_B x_B + \beta_{AB} x_A x_B\)</span></p>
<ul>
<li>Not in the presence of B: <span class="math inline">\(x_B = 0\)</span></li>
</ul>
<p><span class="math inline">\(log(ODDS) =\beta_0 +\beta_A x_A\)</span></p></li>
</ul>
<p>The difference in effect between B yes and B no is <span class="math inline">\(\beta_B + \beta_{AB}\)</span></p>
<p><span class="math inline">\((\beta_0 +\beta_A x_A + \beta_B x_B + \beta_{AB} x_A x_B) - (\beta_0 +\beta_A x_A ) = \beta_B + \beta_{AB}\)</span></p>
<ul>
<li><p>Not in the presence of A: <span class="math inline">\(x_A = 0\)</span></p>
<ul>
<li>In the presence of B: <span class="math inline">\(x_B = 1\)</span></li>
</ul>
<p><span class="math inline">\(log(ODDS) =\beta_0 + \beta_B x_B\)</span></p>
<ul>
<li>Not in the presence of B: <span class="math inline">\(x_B = 0\)</span></li>
</ul>
<p><span class="math inline">\(log(ODDS) =\beta_0\)</span></p></li>
</ul>
<p>The difference in effect between B yes and B no is <span class="math inline">\(\beta_B\)</span></p>
<p><span class="math inline">\((\beta_0 + \beta_B x_B) - (\beta_0) = \beta_B\)</span></p>
<p>There is effect modification if <span class="math inline">\(\beta_B \ne \beta_B+ \beta_{AB}\)</span>, that is, if the presence of B has a different effect on the different levels of A.</p>
</div>
<div id="methods-for-identifying-interactions" class="section level3">
<h3>methods for identifying interactions</h3>
<ol style="list-style-type: decimal">
<li><p><strong>automatic variable selection procedures</strong>: i.e stepwise regression. It’s based on including variables with “significant” p-values. An interaction exists if an interaction coefficient has a “significant p-value”.</p></li>
<li><p><strong>change in effect estimate</strong>: comparison of the effect estimates between adjusted and unadjusted effect estimates.</p></li>
</ol>
<p>We evaluate the crude effect measure and the effect measure stratified by the possible confounder or effect modifier. If the stratum-specific effect measures are different from each other and the relative change greater than 10%, the variable is selected as a interaction.</p>
<p>If <span class="math inline">\(\beta_B\)</span> in the presence of B but not A <span class="math inline">\(\ne\)</span> <span class="math inline">\(\beta_B+ \beta_{AB}\)</span> in the presence of B and A, that is, if the presence of B has a different effect on the different levels of A.</p>
<div class="figure">
<img src="notes%20screenshots/EPI%20205%20notes%20Sep%2028,%202018%20ex%20interaction.jpg" alt="" />
<p class="caption">Gordis</p>
</div>
</div>
<div id="interaction-example-1" class="section level3">
<h3>interaction example 1</h3>
<p>Age adjusted rate ratios for lung cancer due to arsenic exposure.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Unexposed area</th>
<th align="left">Residentially exposed</th>
<th align="left">Smelter worker</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Non smokers</td>
<td align="left">1</td>
<td align="left">2.3</td>
<td align="left">8.4</td>
</tr>
<tr class="even">
<td align="left">Smokers-</td>
<td align="left">8.3</td>
<td align="left">17.5</td>
<td align="left">26.2</td>
</tr>
</tbody>
</table>
<ol style="list-style-type: decimal">
<li><em>Relative risk : multiplicative</em></li>
</ol>
<p><strong>Does smoking interact multiplicatively with arsenic?</strong></p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Unexposed area</th>
<th align="left">Residentially exposed</th>
<th align="left">Smelter worker</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Non smokers</td>
<td align="left">1</td>
<td align="left">2.3 * 8.3 = 19</td>
<td align="left">8.4 * 8.3 = 69</td>
</tr>
<tr class="even">
<td align="left">Smokers-</td>
<td align="left">8.3</td>
<td align="left">17.5</td>
<td align="left">26.2</td>
</tr>
</tbody>
</table>
<p>There is no multiplicative interaction between smoking and residential arsenic exposure on lung cancer risk: <span class="math inline">\(2.3 * 8.3 = 19 \approx 17.5\)</span></p>
<p>There is an antagonistic multiplicative interaction between smoking and smelter worker arsenic exposure on lung cancer risk: <span class="math inline">\(8.4 * 8.3 = 69 \ne 26.2\)</span></p>
<p><strong>Is smoking an effect modifier of the arsenic relative risk?</strong></p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Unexposed area</th>
<th align="left">Residentially exposed</th>
<th align="left">Smelter worker</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Non smokers</td>
<td align="left">1</td>
<td align="left">2.3/1</td>
<td align="left">8.4/1</td>
</tr>
<tr class="even">
<td align="left">Smokers-</td>
<td align="left">8.3/8.3</td>
<td align="left">17.5/8.3</td>
<td align="left">26.2/8.3</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Unexposed area</th>
<th align="left">Residentially exposed</th>
<th align="left">Smelter worker</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Non smokers</td>
<td align="left">1</td>
<td align="left">2.3</td>
<td align="left">8.4</td>
</tr>
<tr class="even">
<td align="left">Smokers-</td>
<td align="left">1</td>
<td align="left">2.1</td>
<td align="left">3.2</td>
</tr>
</tbody>
</table>
<p>Smoking does not modify the effect of residential arsenic exposure on lung cancer risk: <span class="math inline">\(2.3 \approx 2.1\)</span></p>
<p>Smoking does modify the effect of smelter workers’ arsenic exposure on lung cancer risk: this exposure has a much larger effect on non-smokers that smokers: <span class="math inline">\(8.4 &gt; 3.2\)</span></p>
<ol start="2" style="list-style-type: decimal">
<li><em>Excess risk : additive</em></li>
</ol>
<p>If we were looking at excess risk instead of relative risk, we would look at the additive effect.</p>
<p><strong>Is smoking an effect modifier of the arsenic excess risk?</strong></p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Unexposed area</th>
<th align="left">Residentially exposed</th>
<th align="left">Smelter worker</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Non smokers</td>
<td align="left">1</td>
<td align="left">2.3-1</td>
<td align="left">8.4-1</td>
</tr>
<tr class="even">
<td align="left">Smokers-</td>
<td align="left">8.3</td>
<td align="left">17.5-8.3</td>
<td align="left">26.2-8.3</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Unexposed area</th>
<th align="left">Residentially exposed</th>
<th align="left">Smelter worker</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Non smokers</td>
<td align="left">1</td>
<td align="left">1.3</td>
<td align="left">7.4</td>
</tr>
<tr class="even">
<td align="left">Smokers-</td>
<td align="left">8.3</td>
<td align="left">9.2</td>
<td align="left">17.9</td>
</tr>
</tbody>
</table>
<p>Smoking does modify the effect of residential arsenic exposure on lung cancer excess risk synergistically: <span class="math inline">\(1.3 &lt; 9.2\)</span></p>
<p>Smoking does modify the effect of smelter workers’ arsenic exposure on lung cancer excess risk synergistically: <span class="math inline">\(7.4 &lt; 17.9\)</span></p>
<p><strong>Does smoking interact additively with arsenic?</strong></p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Unexposed area</th>
<th align="left">Residentially exposed</th>
<th align="left">Smelter worker</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Non smokers</td>
<td align="left">1</td>
<td align="left">2.3-1</td>
<td align="left">8.4-1</td>
</tr>
<tr class="even">
<td align="left">Smokers-</td>
<td align="left">8.3-1</td>
<td align="left">17.5-1</td>
<td align="left">26.2-1</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Unexposed area</th>
<th align="left">Residentially exposed</th>
<th align="left">Smelter worker</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Non smokers</td>
<td align="left">1</td>
<td align="left">1.3</td>
<td align="left">7.4</td>
</tr>
<tr class="even">
<td align="left">Smokers-</td>
<td align="left">7.3</td>
<td align="left">16.5</td>
<td align="left">25.2</td>
</tr>
</tbody>
</table>
<p>There is additive interaction between smoking and residential arsenic exposure on lung cancer risk: <span class="math inline">\(1.3 + 7.3 = 8.6 \ne 16.5\)</span></p>
<p>There is no additive interaction between smoking and smelter worker arsenic exposure on lung cancer risk: <span class="math inline">\(7.4 + 16.5 = 23.9 \approx 25.2\)</span></p>
</div>
<div id="interaction-example-from-mcelreath2020-chapter-8" class="section level3">
<h3>interaction example from <span class="citation">@mcelreath2020</span> Chapter 8</h3>
<p>Africa is geographically special, in a puzzling way: Bad geography tends to be related to bad economies outside of Africa, but African economies may actually benefit from bad geography. To appreciate the puzzle, look at regressions of terrain ruggedness—a particular kind of bad geography—against economic performance (log GDP136 per capita in the year 2000), both inside and outside of Africa. The variable rugged is a Terrain Ruggedness Index137 that quantifies the topographic heterogeneity of a landscape. The outcome variable here is the logarithm of real gross domestic product per capita, from the year 2000, rgdppc_2000. We use the logarithm of it, because the logarithm of GDP is the magnitude of GDP.</p>
<pre class="r"><code>library(rethinking) 
data(rugged)
d &lt;- rugged

# make the log version of criterion
d &lt;- 
  d %&gt;%
  mutate(log_gdp = log(rgdppc_2000))

# extract countries with GDP data
dd &lt;-
  d %&gt;%
  filter(complete.cases(rgdppc_2000)) %&gt;% 
  # re-scale variables
  mutate(log_gdp_std = log_gdp / mean(log_gdp), 
         rugged_std  = rugged / max(rugged))</code></pre>
<p><img src="index_files/figure-html/africa%20plot-1.png" width="672" /></p>
<p>If this relationship is at all causal, it may be because rugged regions of Africa were pro- tected against the Atlantic and Indian Ocean slave trades. Slavers preferred to raid easily accessed settlements, with easy routes to the sea. Those regions that suffered under the slave trade understandably continue to suffer economically, long after the decline of slave-trading markets. However, an outcome like GDP has many influences, and is furthermore a strange measure of economic activity. And ruggedness is correlated with other geographic features, like coastlines, that also influence the economy. So it is hard to be sure what’s going on here.</p>
<p>The causal hypothesis, in DAG form, might be (where R is terrain ruggedness, G is GDP, C is continent): <img src="index_files/figure-html/dag2%20africa-1.png" width="672" /> R and C both influence G. This could mean that they are independent influences or rather that they interact (one moderates the influence of the other). The DAG does not display an interaction. That’s because DAGs do not specify how variables combine to influence other variables. The DAG above implies only that there is some function that uses R and C to generate G. In typical notation, G = f(R, C).</p>
<p>So we need a statistical approach to judge different propositions for f(R, C).</p>
<p>So we need a statistical approach to judge different propositions for f(R, C). How do we make a model that produces the conditionality in Figure 8.2? We could cheat by splitting the data into two data frames, one for Africa and one for all the other continents. But it’s not a good idea to split the data in this way. Here are four reasons:</p>
<ol style="list-style-type: decimal">
<li><p>First, there are usually some parameters, such as σ, that the model says do not depend in any way upon continent. By splitting the data table, you are hurting the accuracy of the es- timates for these parameters, because you are essentially making two less-accurate estimates instead of pooling all of the evidence into one estimate. In effect, you have accidentally as- sumed that variance differs between African and non-African nations. Now, there’s nothing wrong with that sort of assumption. But you want to avoid accidental assumptions.</p></li>
<li><p>Second, in order to acquire probability statements about the variable you used to split the data, cont_africa in this case, you need to include it in the model. Otherwise, you have a weak statistical argument. Isn’t there uncertainty about the predictive value of distinguishing between African and non-African nations? Of course there is. Unless you analyze all of the data in a single model, you can’t easily quantify that uncertainty. If you just let the posterior distribution do the work for you, you’ll have a useful measure of that uncertainty.</p></li>
<li><p>Third, we may want to use information criteria or another method to compare models. In order to compare a model that treats all continents the same way to a model that allows different slopes in different continents, we need models that use all of the same data (as explained in Chapter 7). This means we can’t split the data for two separate models. We have to let a single model internally split the data.</p></li>
<li><p>Fourth, once you begin using multilevel models (Chapter 13), you’ll see that there are advantages to borrowing information across categories like “Africa” and “not Africa.” This is especially true when sample sizes vary across categories, such that overfitting risk is higher within some categories. In other words, what we learn about ruggedness outside of Africa should have some effect on our estimate within Africa, and visa versa. Multilevel models (Chapter 13) borrow information in this way, in order to improve estimates in all categories. When we split the data, this borrowing is impossible.</p></li>
</ol>
<p>We look at the different possibilities to model the association between log(GDP) and ruggedness</p>
<ol style="list-style-type: decimal">
<li>m8.1 <strong>ignoring continent</strong>.</li>
</ol>
<p>Fit a single model to all the data, ignoring continent.</p>
<p><span class="math inline">\(log(y_i) \sim N(\mu_i, \sigma)\)</span></p>
<p><span class="math inline">\(\mu_i = \alpha_0 + \beta (r_i - \bar{r})\)</span></p>
<pre class="r"><code>m8.1 &lt;- quap(
    alist(
        log_gdp_std ~ dnorm( mu , sigma ) ,
        mu &lt;- a + b*( rugged_std - 0.215 ) ,
        a ~ dnorm( 1 , 0.1 ) ,
        b ~ dnorm( 0 , 0.3 ) ,
        sigma ~ dexp(1)
    ) , data=dd )

 precis( m8.1 )</code></pre>
<pre><code>##              mean          sd        5.5%      94.5%
## a     1.000000079 0.010412512  0.98335887 1.01664128
## b     0.002001904 0.054796238 -0.08557307 0.08957688
## sigma 0.136504552 0.007397121  0.12468252 0.14832658</code></pre>
<p><img src="index_files/figure-html/m8.1%20plot-1.png" width="672" /></p>
<p>Really no overall association between terrain ruggedness and log GDP.</p>
<p>Next we’ll see how to split apart the continents.</p>
<ol start="2" style="list-style-type: decimal">
<li>m8.2 <strong>adding indicator variable for African nations</strong></li>
</ol>
<p>The first thing to realize is that just in- cluding an indicator variable for African nations, cont_africa here, won’t reveal the re- versed slope. It’s worth fitting this model to prove it to yourself, though.</p>
<p><span class="math inline">\(log(y_i) \sim N(\mu_i, \sigma)\)</span></p>
<p><span class="math inline">\(\mu_i = \alpha_0 + \beta (r_i - \bar{r}) + \gamma A_i\)</span></p>
<p>where <span class="math inline">\(A_i\)</span> is cont_africa, a 0/1 indicator variable.</p>
<p>The problem here, and in general, is that we need a prior for <span class="math inline">\(\gamma\)</span>. Okay, we can do priors. But what that prior will necessarily do is tell the model that <span class="math inline">\(\mu_i\)</span> for a nation in Africa is more uncertain, before seeing the data, than <span class="math inline">\(\mu_i\)</span> outside Africa. And that makes no sense.</p>
<p>There is a simple solution: Nations in Africa will get one intercept and those outside Africa another.</p>
<p><span class="math inline">\(log(y_i) \sim N(\mu_i, \sigma)\)</span></p>
<p><span class="math inline">\(\mu_i = \alpha_{CID[i]} + \beta (r_i - \bar{r})\)</span></p>
<p>where cid is an index variable, continent ID. It takes the value 1 for African nations and 2 for all other nations. This means there are two parameters, <span class="math inline">\(\alpha_{1}\)</span> and <span class="math inline">\(\alpha_{2}\)</span> one for each unique index value. The notation cid[i] just means the value of cid on row i. Using this approach, instead of the conventional approach of adding another term with the 0/1 indicator variable, doesn’t force us to say that the mean for Africa is inherently less certain than the mean for all other continents.</p>
<pre class="r"><code>#make variable to index Africa (1) or not (2)
dd$cid &lt;- ifelse( dd$cont_africa==1 , 1 , 2 )

m8.2 &lt;- quap( alist(
log_gdp_std ~ dnorm( mu , sigma ) ,
mu &lt;- a[cid] + b*( rugged_std - 0.215 ) , a[cid] ~ dnorm( 1 , 0.1 ) ,
b ~ dnorm( 0 , 0.3 ) ,
sigma ~ dexp( 1 )
) , data=dd )

precis( m8.2 , depth=2 )</code></pre>
<pre><code>##              mean          sd       5.5%      94.5%
## a[1]   0.88041284 0.015937003  0.8549424 0.90588325
## a[2]   1.04916425 0.010185554  1.0328858 1.06544274
## b     -0.04651347 0.045686725 -0.1195297 0.02650274
## sigma  0.11238738 0.006091077  0.1026527 0.12212209</code></pre>
<p>The parameter a[1] is the intercept for African nations. It seems reliably lower than a[2].</p>
<p>Now to compare these models, using WAIC:</p>
<pre><code>##           WAIC       SE    dWAIC      dSE    pWAIC       weight
## m8.2 -252.2687 15.30518  0.00000       NA 4.258517 1.000000e+00
## m8.1 -188.7544 13.29153 63.51424 15.14616 2.690177 1.614571e-14</code></pre>
<p>m8.2 gets all the model weight. And while the standard error of the difference in WAIC is 15, the difference itself is 64. So the continent variable seems to be picking up some important association in the sample.</p>
<p>Let’s plot the posterior predictions for m8.2, so you can see how, despite it’s predictive superiority to m8.1, it still doesn’t manage different slopes inside and outside of Africa. African nations are shown in blue, while nations outside Africa are shown in gray. What you’ve ended up with here is a rather weak negative relationship between economic development and ruggedness. The African nations do have lower overall economic development, and so the blue regression line is below, but parallel to, the black line. All including a dummy variable for African nations has done is allow the model to predict a lower mean for African nations. It can’t do anything to the slope of the line. The fact that WAIC tells you that the model with the dummy variable is hugely better only indicates that African nations on average do have lower GDP.</p>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-08%20at%2016.27.33.png" /></p>
<ol start="3" style="list-style-type: decimal">
<li>m8.3 <strong>adding interaction variable for African nations</strong></li>
</ol>
<p>How can you recover the change in slope you saw at the start of this section? You need a proper interaction effect. This just means we also make the slope conditional on continent.</p>
<p>And again, there is a conventional approach to specifying an interaction that uses an indica- tor variable and a new interaction parameter. It would look like this:</p>
<p><span class="math inline">\(log(y_i) \sim N(\mu_i, \sigma)\)</span></p>
<p><span class="math inline">\(\mu_i = \alpha_{CID[i]} + (\beta + \gamma A_i) (r_i - \bar{r})= \alpha_{CID[i]} +\beta(r_i - \bar{r})+ \gamma A_i(r_i - \bar{r})\)</span></p>
<p>where Ai is a 0/1 indicator for African nations. This is equivalent to our index approach, but it is much harder to state sensible priors. Any prior we put on γ makes the slope inside Africa more uncertain than the slope outside Africa. And again that makes no sense. But in the indexing approach, we can easily assign the same prior to the slope, no matter which continent.</p>
<p><span class="math inline">\(log(y_i) \sim N(\mu_i, \sigma)\)</span></p>
<p><span class="math inline">\(\mu_i = \alpha_{CID[i]} + \beta_{CID[i]}(r_i - \bar{r})\)</span></p>
<pre class="r"><code>m8.3 &lt;- quap(
    alist(
        log_gdp_std ~ dnorm( mu , sigma ) ,
        mu &lt;- a[cid] + b[cid]*( rugged_std - 0.215 ) ,
        a[cid] ~ dnorm( 1 , 0.1 ) ,
        b[cid] ~ dnorm( 0 , 0.3 ) ,
        sigma ~ dexp( 1 )
) , data=dd )

precis( m8.3 , depth=2 )</code></pre>
<pre><code>##             mean          sd       5.5%       94.5%
## a[1]   0.8865639 0.015675695  0.8615111  0.91161667
## a[2]   1.0505698 0.009936606  1.0346892  1.06645039
## b[1]   0.1325054 0.074204443  0.0139124  0.25109846
## b[2]  -0.1425767 0.054749403 -0.2300768 -0.05507653
## sigma  0.1094941 0.005935299  0.1000084  0.11897987</code></pre>
<p>The slope is essentially reversed inside Africa, 0.13 instead of −0.14.</p>
<p>How much does allowing the slope to vary improve expected prediction? Let’s use PSIS to compare this new model to the previous two. You could use WAIC here as well. It’ll give almost identical results.</p>
<pre><code>##           PSIS       SE    dPSIS       dSE    pPSIS       weight
## m8.3 -258.9122 15.26994  0.00000        NA 5.248904 9.731544e-01
## m8.2 -251.7313 15.27774  7.18088  6.563466 4.462810 2.684562e-02
## m8.1 -188.7363 13.28687 70.17592 15.393216 2.681052 5.619209e-16</code></pre>
<p>Model family m8.3 has more than 95% of the weight. That’s very strong support for including the interaction effect, if prediction is our goal. But the modicum of weight given to m8.2 suggests that the posterior means for the slopes in m8.3 are a little overfit. And the standard error of the difference in PSIS between the top two models is almost the same as the difference itself.</p>
<pre class="r"><code># plot Africa - cid=1
d.A1 &lt;- dd[ dd$cid==1 , ]
plot( d.A1$rugged_std , d.A1$log_gdp_std , pch=16 , col=rangi2 ,
    xlab=&quot;ruggedness (standardized)&quot; , ylab=&quot;log GDP (as proportion of mean)&quot; ,
    xlim=c(0,1) )
mu &lt;- link( m8.3 , data=data.frame( cid=1 , rugged_std=rugged_seq ) )
mu_mean &lt;- apply( mu , 2 , mean )
mu_ci &lt;- apply( mu , 2 , PI , prob=0.97 )
lines( rugged_seq , mu_mean , lwd=2 )
shade( mu_ci , rugged_seq , col=col.alpha(rangi2,0.3) )


mtext(&quot;African nations&quot;)</code></pre>
<p><img src="index_files/figure-html/plot%208.14-1.png" width="672" /></p>
<pre class="r"><code># plot non-Africa - cid=2
d.A0 &lt;- dd[ dd$cid==2 , ]
plot( d.A0$rugged_std , d.A0$log_gdp_std , pch=1 , col=&quot;black&quot; ,
    xlab=&quot;ruggedness (standardized)&quot; , ylab=&quot;log GDP (as proportion of mean)&quot; ,
    xlim=c(0,1) )
mu &lt;- link( m8.3 , data=data.frame( cid=2 , rugged_std=rugged_seq ) )
mu_mean &lt;- apply( mu , 2 , mean )
mu_ci &lt;- apply( mu , 2 , PI , prob=0.97 )
lines( rugged_seq , mu_mean , lwd=2 )
shade( mu_ci , rugged_seq )
mtext(&quot;Non-African nations&quot;)</code></pre>
<p><img src="index_files/figure-html/plot%208.14-2.png" width="672" /></p>
</div>
</div>
<div id="collider" class="section level2">
<h2>COLLIDER</h2>
<p><img src="index_files/figure-html/collider-1.png" width="672" /></p>
<p>The core concept is easy to understand: When you condition on a collider, it creates statistical—but not necessarily causal— associations among its causes.</p>
<p>Collider bias arises from conditioning on a common consequence. If we can just get our graph sorted, we can avoid it. But it isn’t always so easy to see a potential collider, because there may be unmeasured causes. Unmeasured causes can still induce collider bias. So I’m sorry to say that we also have to consider the possibility that our DAG may be haunted.</p>
<div id="children-and-education-example-from-mcelreath2020" class="section level3">
<h3>children and education example from <span class="citation">@mcelreath2020</span></h3>
<p>We want to infer the direct influence of both parents (P) and grandparents (G) on the educational achievement of children (C). Since grandparents also presumably influence their own children’s education, there is an arrow G → P. This sounds pretty easy, so far. It’s similar in structure to our divorce rate example from last chapter:</p>
<p><img src="index_files/figure-html/collider%202-1.png" width="672" /></p>
<p>But suppose there are unmeasured, common influences on parents and their children, such as neighborhoods, that are not shared by grandparents (who live on the south coast of Spain now). Then our DAG becomes haunted by the unobserved U:</p>
<p><img src="index_files/figure-html/collider%203-1.png" width="672" /></p>
<p>Now P is a common consequence of G and U, so if we condition on P, it will bias inference about G → C, even if we never get to measure U. I don’t expect that fact to be immediately obvious. So let’s crawl through a quantitative example.</p>
<p><img src="index_files/figure-html/dag%20collider%20control-1.png" width="672" /></p>
<p>First, let’s simulate 200 triads of grandparents, parents, and children. This simulation will be simple. We’ll just project our DAG as a series of implied functional relationships. The DAG above implies that:</p>
<ol style="list-style-type: decimal">
<li><p>P is some function of G and U</p></li>
<li><p>C is some function of G, P, and U</p></li>
<li><p>G and U are not functions of any other known variables</p></li>
</ol>
<p>We can make these implications into a simple simulation, using rnorm to generate simulated observations. But to do this, we need to be a bit more precise than “some function of.” So I’ll invent some strength of association:</p>
<pre class="r"><code>N &lt;- 200 # number of grandparent-parent-child triads 
b_GP &lt;- 1 # direct effect of G on P
b_GC &lt;- 0 # direct effect of G on C
b_PC &lt;- 1 # direct effect of P on C
b_U&lt;-2 #direct effect of U on P and C</code></pre>
<p>These parameters are like slopes in a regression model. Notice that I’ve assumed that grand- parents G have zero effect on their grandkids C. The example doesn’t depend upon that effect being exactly zero, but it will make the lesson clearer. Now we use these slopes to draw random observations:</p>
<pre class="r"><code>set.seed(1)
U &lt;- 2*rbern( N , 0.5 ) - 1
G &lt;- rnorm( N )
P &lt;- rnorm( N , b_GP*G + b_U*U )
C &lt;- rnorm( N , b_PC*P + b_GC*G + b_U*U ) 
d &lt;- data.frame( C=C , P=P , G=G , U=U )</code></pre>
<p>I’ve made the neighborhood effect, U, binary. This will make the example easier to under- stand. But the example doesn’t depend upon that assumption. The other lines are just linear models embedded in rnorm.</p>
<p>Now what happens when we try to infer the influence of grandparents? Since some of the total effect of grandparents passes through parents, we realize we need to control for parents.</p>
<p>Here is a simple regression of C on P and G. Normally I would advise standardizing the variables, because it makes establishing sensible priors a lot easier. But I’m going to keep the simulated data on its original scale, so you can see what happens to inference about the slopes above. If we changed the scale, we shouldn’t expect to get those values back. But if we leave the scale alone, we should be able to recover something close to those values. So I apologize for using vague priors here, just to push forward in the example.</p>
<pre class="r"><code>m6.11 &lt;- quap( alist(
C ~ dnorm( mu , sigma ),
mu &lt;- a + b_PC*P + b_GC*G,
a ~ dnorm( 0 , 1 ), 
c(b_PC,b_GC) ~ dnorm( 0 , 1 ), 
sigma ~ dexp( 1 )
), data=d ) 
precis(m6.11)</code></pre>
<pre><code>##             mean         sd       5.5%       94.5%
## a     -0.1174752 0.09919574 -0.2760091  0.04105877
## b_PC   1.7868915 0.04455355  1.7156863  1.85809664
## b_GC  -0.8389537 0.10614045 -1.0085867 -0.66932077
## sigma  1.4094891 0.07011139  1.2974375  1.52154063</code></pre>
<p>The inferred effect of parents looks too big, almost twice as large as it should be. That isn’t surprising. Some of the correlation between P and C is due to U, and the model doesn’t know about U. That’s a simple confound. More surprising is that the model is confident that the direct effect of grandparents is to hurt their grandkids. The regression is not wrong. But a causal interpretation of that association would be.</p>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-08%20at%2017.56.05.png" /> Note that I did standardize the variables to make this plot. So the units on the axes are standard deviations. The horizontal axis is grandparent education. The vertical is grandchild education. There are two clouds of points. The blue cloud comprises children who live in good neighborhoods (U = 1). The black cloud comprises children who live in bad neighborhoods (U = −1). No- tice that both clouds of points show positive associations between G and C. More educated grandparents have more educated grandkids, but this effect arises entirely through parents. Why? Because we assumed it is so. The direct effect of G in the simulation is zero.</p>
<p>So how does the negative association arise, when we condition on parents? Conditioning on parents is like looking within sub-populations of parents with similar education. So let’s try that. In the Figure, I’ve highlighted in filled points those parents between the 45th and 60th centiles of education. There is nothing special of this range. It just makes the phenomenon easier to see. Now if we draw a regression line through only these points, regressing C on G, the slope is negative. There is the negative association that our multiple regression finds. But why does it exist?</p>
<p>It exists because, once we know P, learning G invisibly tells us about the neighborhood U, and U is associated with the outcome C. I know this is confusing. As I keep saying, if you are confused, it is only because you are paying attention.</p>
<p>So consider two different parents with the same education level, say for example at the median 50th centile. One of these parents has a highly educated grandparent. The other has a poorly educated grandparent. The only probable way, in this example, for these parents to have the same education is if they live in different types of neighborhoods. We can’t see these neighborhood effects—we haven’t measured them, recall—but the influence of neighborhood is still transmitted to the children C. So for our mythical two parents with the same education, the one with the highly educated grandparent ends up with a less well educated child. The one with the less educated grandparent ends up with the better educated child. G predicts lower C.</p>
<p>The unmeasured U makes P a collider, and conditioning on P produces collider bias. So what can we do about this? You have to measure U. Here’s the regression that conditions also on U:</p>
<pre class="r"><code>m6.12 &lt;- quap( alist(
C ~ dnorm( mu , sigma ),
mu &lt;- a + b_PC*P + b_GC*G + b_U*U,
a ~ dnorm( 0 , 1 ),
c(b_PC,b_GC,b_U) ~ dnorm( 0 , 1 ),
sigma ~ dexp( 1 ) ), data=d )
precis(m6.12)</code></pre>
<pre><code>##              mean         sd       5.5%        94.5%
## a     -0.12197510 0.07192588 -0.2369265 -0.007023655
## b_PC   1.01161103 0.06597258  0.9061741  1.117047948
## b_GC  -0.04081373 0.09728716 -0.1962974  0.114669941
## b_U    1.99648992 0.14770462  1.7604294  2.232550439
## sigma  1.01959911 0.05080176  0.9384081  1.100790130</code></pre>
<p>And those are the slopes we simulated with.</p>
<p>Rethinking: Statistical paradoxes and causal explanations. The grandparents example serves as an example of Simpson’s paradox: Including another predictor (P in this case) can reverse the direction of association between some other predictor (G) and the outcome (C). Usually, Simpson’s paradox is presented in cases where adding the new predictor helps us. But in this case, it misleads us. Simpson’s paradox is a statistical phenomenon. To know whether the reversal of the association correctly reflects causation, we need something more than just a statistical model.</p>
</div>
</div>
<div id="multicollinearity" class="section level2">
<h2>MULTICOLLINEARITY</h2>
<p>From <span class="citation">@mcelreath2020</span>:</p>
<p>Multicollinearity means a very strong association between two or more predictor variables. The raw correlation isn’t what matters. Rather what matters is the association, conditional on the other variables in the model. The consequence of multicollinearity is that the posterior distribution will seem to suggest that none of the variables is reliably associated with the outcome, even if all of the variables are in reality strongly associated with the outcome.</p>
<p>The problem of multicollinearity is a member of a family of problems with fitting models, a family sometimes known as non-identifiability.</p>
<div id="non-identifiability" class="section level3">
<h3><strong>non-identifiability</strong></h3>
<p>When a parameter is non-identifiable, it means that the structure of the data and model do not make it possible to estimate the parameter’s value. Sometimes this problem arises from mistakes in coding a model, but many important types of models present non-identifiable or weakly identifiable parameters, even when coded completely correctly. Nature does not owe us easy inference, even when the model is correct.</p>
</div>
<div id="leg-example" class="section level3">
<h3>leg example</h3>
<p><span class="math inline">\(height \sim N(\mu_i, \sigma)\)</span></p>
<p><span class="math inline">\(\mu_i = \alpha_{0} + \beta_{l} x_{leg\:left}+ \beta_{r} x_{leg\:right}\)</span></p>
<p>Imagine trying to predict an individual’s height using the length of his or her legs as predictor variables. Surely height is positively associated with leg length, or at least our simulation will assume it is. Nevertheless, once you put both legs (right and left) into the model, something vexing will happen.</p>
<p>The code below will simulate the heights and leg lengths of 100 individuals. For each, first a height is simulated from a Gaussian distribution. Then each individual gets a simulated proportion of height for their legs, ranging from 0.4 to 0.5. Finally, each leg is salted with a little measurement or developmental error, so the left and right legs are not exactly the same length, as is typical in real populations. At the end, the code puts height and the two leg lengths into a common data frame.</p>
<p>Now let’s analyze these data, predicting the outcome height with both predictors, leg_left and leg_right. Before approximating the posterior, however, consider what we expect. On average, an individual’s legs are 45% of their height (in these simulated data). So we should expect the beta coefficient that measures the association of a leg with height to end up around the average height (10) divided by 45% of the average height (4.5). This is 10/4.5 ≈ 2.2. Now let’s see what happens instead. I’ll use very vague, bad priors here, just so we can be sure that the priors aren’t responsible for what is about to happen.</p>
<pre class="r"><code>N &lt;- 100
set.seed(909)
height &lt;- rnorm(N,10,2)
leg_prop &lt;- runif(N,0.4,0.5)
leg_left &lt;- leg_prop*height +
    rnorm( N , 0 , 0.02 )
leg_right &lt;- leg_prop*height +
    rnorm( N , 0 , 0.02 )
d &lt;- data.frame(height,leg_left,leg_right)


m6.1 &lt;- quap(
    alist(
        height ~ dnorm( mu , sigma ) ,
        mu &lt;- a + bl*leg_left + br*leg_right ,
        a ~ dnorm( 10 , 100 ) ,
        bl ~ dnorm( 2 , 10 ) ,
        br ~ dnorm( 2 , 10 ) ,
        sigma ~ dexp( 1 )
),
    data=d )
precis(m6.1)</code></pre>
<pre><code>##            mean         sd       5.5%     94.5%
## a     0.9812791 0.28395540  0.5274635 1.4350947
## bl    0.2118585 2.52703706 -3.8268348 4.2505518
## br    1.7836774 2.53125061 -2.2617500 5.8291047
## sigma 0.6171026 0.04343427  0.5476862 0.6865189</code></pre>
<pre class="r"><code>plot(precis(m6.1))</code></pre>
<p><img src="index_files/figure-html/6.2-1.png" width="672" /></p>
<p>Those posterior means and standard deviations look crazy. Both legs have almost identical lengths, and height is so strongly associated with leg length, then why is this posterior distribution so weird? Did the posterior approximation work correctly?</p>
<p>The posterior distribution here is the right answer to the question we asked. The problem is the question. Recall that a multiple linear regression answers the question: What is the value of knowing each predictor, after already knowing all of the other predictors? So in this case, the question becomes: What is the value of knowing each leg’s length, after already knowing the other leg’s length?</p>
<p>The answer to this weird question is equally weird, but perfectly logical. The posterior distribution is the answer to this question, considering every possible combination of the parameters and assigning relative plausibilities to every combination, conditional on this model and these data. It might help to look at the joint posterior distribution for bl and br. The posterior distribution for these two parameters is very highly correlated, with all of the plausible values of bl and br lying along a narrow ridge. When bl is large, then br must be small. What has happened here is that since both leg variables contain almost exactly the same information, if you insist on including both in a model, then there will be a practically infinite number of combinations of bl and br that produce the same predictions.</p>
<pre class="r"><code>post &lt;- extract.samples(m6.1)
plot( bl ~ br , post , col=col.alpha(rangi2,0.1) , pch=16 )</code></pre>
<p><img src="index_files/figure-html/leg%20post-1.png" width="672" /></p>
<p>One way to think of this phenomenon is that you have approximated this model:</p>
<p><span class="math inline">\(height \sim N(\mu_i, \sigma)\)</span></p>
<p><span class="math inline">\(\mu_i = \alpha_{0} + \beta_{1} x_{i}+ \beta_{2} x_{i}\)</span></p>
<p>The variable y is the outcome, like height in the example, and x is a single predictor, like the leg lengths in the example. Because the left and right legs are so correlated, it’s like using x twice. From the golem’s perspective, the model for μi is:</p>
<p><span class="math inline">\(\mu_i = \alpha_{0} + (\beta_{l} + \beta_{r}) x\)</span></p>
<p>The parameters β1 and β2 cannot be pulled apart, because they never separately influence the mean μ. Only their sum, β1+β2, influences μ. So this means the posterior distribution ends up reporting the very large range of combinations of β1 and β2 that make their sum close to the actual association of x with y.</p>
<p>And the posterior distribution in this simulated example has done exactly that: It has produced a good estimate of the sum of bl and br. Here’s how you can compute the posterior distribution of their sum, and then plot it:</p>
<pre class="r"><code>sum_blbr &lt;- post$bl + post$br
dens( sum_blbr , col=rangi2 , lwd=2 , xlab=&quot;sum of bl and br&quot; )</code></pre>
<p><img src="index_files/figure-html/leg%20sum-1.png" width="672" /></p>
<p>The posterior mean is in the right neighborhood, a little over 2, and the standard deviation is much smaller than it is for either component of the sum, bl or br. If you fit a regression with only one of the leg length variables, you’ll get approximately the same posterior mean:</p>
<pre class="r"><code>m6.2 &lt;- quap( alist(
height ~ dnorm( mu , sigma ) , mu &lt;- a + bl*leg_left,
a ~ dnorm( 10 , 100 ) ,
bl ~ dnorm( 2 , 10 ) ,
sigma ~ dexp( 1 ) ) , data=d )
precis(m6.2)</code></pre>
<pre><code>##            mean         sd      5.5%    94.5%
## a     0.9979326 0.28364620 0.5446112 1.451254
## bl    1.9920676 0.06115704 1.8943269 2.089808
## sigma 0.6186038 0.04353998 0.5490185 0.688189</code></pre>
<p>That 1.99 is almost identical to the mean value of sum_blbr.</p>
<p>The basic lesson is only this: When two predictor variables are very strongly correlated (conditional on other variables in the model), including both in a model may lead to confu- sion. The posterior distribution isn’t wrong, in such cases. It’s telling you that the question you asked cannot be answered with these data. And that’s a great thing for a model to say, that it cannot answer your question. And if you are just interested in prediction, you’ll find that this leg model makes fine predictions. It just doesn’t make any claims about which leg is more important.</p>
</div>
<div id="milk-example" class="section level3">
<h3>milk example</h3>
<p>In this example, we are concerned with the perc.fat (percent fat) and perc.lactose (per- cent lactose) variables. We’ll use these to model the total energy content, kcal.per.g. The code above has already standardized these three variables. You’re going to use these three variables to explore a natural case of multicollinearity.</p>
<pre class="r"><code>library(rethinking)
data(milk)
d &lt;- milk
d$K &lt;- scale( d$kcal.per.g )
d$F &lt;- scale( d$perc.fat )
d$L &lt;- scale( d$perc.lactose )</code></pre>
<ul>
<li><ol style="list-style-type: decimal">
<li>kcal.per.g regressed on perc.fat</li>
</ol></li>
</ul>
<p>Start by modeling kcal.per.g as a function of perc.fat and perc.lactose, but in two bivariate regressions.</p>
<pre class="r"><code># kcal.per.g regressed on perc.fat
m6.3 &lt;- quap(
    alist(
        K ~ dnorm( mu , sigma ) ,
        mu &lt;- a + bF*F ,
        a ~ dnorm( 0 , 0.2 ) ,
        bF ~ dnorm( 0 , 0.5 ) ,
        sigma ~ dexp( 1 )
) , data=d )
# kcal.per.g regressed on perc.lactose
m6.4 &lt;- quap(
    alist(
        K ~ dnorm( mu , sigma ) ,
        mu &lt;- a + bL*L ,
        a ~ dnorm( 0 , 0.2 ) ,
        bL ~ dnorm( 0 , 0.5 ) ,
        sigma ~ dexp( 1 )
) , data=d )
precis( m6.3 )</code></pre>
<pre><code>##               mean         sd       5.5%     94.5%
## a     1.535526e-07 0.07725195 -0.1234634 0.1234637
## bF    8.618970e-01 0.08426088  0.7272318 0.9965621
## sigma 4.510179e-01 0.05870756  0.3571919 0.5448440</code></pre>
<pre class="r"><code>precis( m6.4 )</code></pre>
<pre><code>##                mean         sd       5.5%      94.5%
## a      7.438895e-07 0.06661633 -0.1064650  0.1064665
## bL    -9.024550e-01 0.07132848 -1.0164517 -0.7884583
## sigma  3.804653e-01 0.04958259  0.3012227  0.4597078</code></pre>
<p>The posterior distributions for bF and bL are essentially mirror images of one another. The posterior mean of bF is as positive as the mean of bL is negative. Both are narrow posterior distributions that lie almost entirely on one side or the other of zero. Given the strong association of each predictor with the outcome, we might conclude that both variables are reliable predictors of total energy in milk, across species. The more fat, the more kilocalories in the milk. The more lactose, the fewer kilocalories in milk. But watch what happens when we place both predictor variables in the same regression model:</p>
<pre class="r"><code>m6.5 &lt;- quap(
    alist(
        K ~ dnorm( mu , sigma ) ,
        mu &lt;- a + bF*F + bL*L ,
        a ~ dnorm( 0 , 0.2 ) ,
        bF ~ dnorm( 0 , 0.5 ) ,
        bL ~ dnorm( 0 , 0.5 ) ,
        sigma ~ dexp( 1 )
),
    data=d )
precis( m6.5 )</code></pre>
<pre><code>##                mean         sd        5.5%      94.5%
## a     -3.172136e-07 0.06603577 -0.10553823  0.1055376
## bF     2.434983e-01 0.18357865 -0.04989579  0.5368925
## bL    -6.780825e-01 0.18377670 -0.97179320 -0.3843719
## sigma  3.767418e-01 0.04918394  0.29813637  0.4553472</code></pre>
<p>Now the posterior means of both bF and bL are closer to zero. And the standard deviations for both parameters are twice as large as in the bivariate models (m6.3 and m6.4).</p>
<p>This is the same statistical phenomenon as in the leg length example. What has happened is that the variables perc.fat and perc.lactose contain much of the same information. They are almost substitutes for one another. As a result, when you include both in a regression, the posterior distribution ends up describing a long ridge of combinations of bF and bL that are equally plausible. In the case of the fat and lactose, these two variables form essentially a single axis of variation. The easiest way to see this is to use a pairs plot:</p>
<pre class="r"><code> pairs( ~ kcal.per.g + perc.fat + perc.lactose , data=d , col=rangi2 )</code></pre>
<p><img src="index_files/figure-html/milk%20pairs-1.png" width="672" /></p>
<p>Percent fat is positively correlated with the outcome, while percent lactose is negatively correlated with it.</p>
<p>Now look at the right-most scatterplot in the middle row. This plot is the scatter of percent fat (vertical) against percent lactose (horizontal). Notice that the points line up almost entirely along a straight line. These two variables are negatively correlated, and so strongly so that they are nearly redundant. Either helps in predicting kcal.per.g, but neither helps as much <em>once you already know the other</em>.</p>
</div>
<div id="how-to-detect-multicollinearity" class="section level3">
<h3>how to detect multicollinearity</h3>
<p>In the scientific literature, you might encounter a variety of dodgy ways of coping with multicollinearity. Few of them take a causal perspective. Some fields actually teach students to inspect pairwise correlations before fitting a model, to identify and drop highly correlated predictors. This is a mistake. Pairwise correlations are not the problem. It is the conditional associations—not correlations—that matter. And even then, the right thing to do will depend upon what is causing the collinearity. The associations within the data alone are not enough to decide what to do.</p>
<ul>
<li><p>look at bivariate associations:</p>
<ul>
<li><p>quantitative variables:</p>
<ul>
<li>if the variable is normally distributed: pearson correlation coefficient</li>
<li>correlation matrix</li>
</ul></li>
<li><p>ordinal variables: spearman rank correlation coefficient.</p></li>
<li><p>between nominal (binomial or multinomial) variables: chi-square test</p></li>
<li><p>between categorical and continuous variables:</p>
<ul>
<li>2 categories: t-test</li>
<li><span class="math inline">\(&gt;\)</span> 2 categories: ANOVA</li>
</ul></li>
</ul></li>
<li><p>use VIF = variance inflation. If it’s &gt;10 it’s a sign of collinearity.</p></li>
</ul>
<p>What is likely going on in the milk example is that there is a core tradeoff in milk composition that mammal mothers must obey. If a species nurses often, then the milk tends to be watery and low in energy. Such milk is high in sugar (lactose). If instead a species nurses rarely, in short bouts, then the milk needs to be higher in energy. Such milk is very high in fat. This implies a causal model something like this:</p>
<p><img src="index_files/figure-html/milk%20dag-1.png" width="672" /></p>
<p>The central tradeoff decides how dense, D, the milk needs to be. We haven’t observed this variable, so it’s shown circled. Then fat, F, and lactose, L, are determined. Finally, the com- position of F and L determines the kilocalories, K. If we could <strong>measure D</strong>, or had an evolutionary and economic model to predict it based upon other aspects of a species, that would be better than stumbling through regressions.</p>
<p>In general, there’s no guarantee that the available data contain much information about a parameter of interest. When that’s true, your Bayesian machine will return a posterior distribution very similar to the prior. <strong>Comparing the posterior to the prior can therefore be a good idea</strong>, a way of seeing how much information the model extracted from the data. When the posterior and prior are similar, it doesn’t mean the calculations are wrong—you got the right answer to the question you asked. But it might lead you to ask a better question.</p>
</div>
</div>
</div>
<div id="study-design" class="section level1">
<h1><strong>STUDY DESIGN</strong></h1>
<div id="sample-size" class="section level2">
<h2>SAMPLE SIZE</h2>
<p>A <strong>sample</strong> is a subset of the subjects in the population that could have been included in the study = a subset of the experiences the study subjects could have had</p>
<p><strong>ASSUMPTIONS OF SAMPLING</strong></p>
<ul>
<li><p><strong>Randomness assumption</strong>: the sample is a random selection of the subjects in the population that could have been included in the study</p></li>
<li><p><strong>Representativeness assumption</strong>: the sample is representative of the subjects in the population that could have been included in the study</p></li>
</ul>
<p><strong>SAMPLING DISTRIBUTION</strong></p>
<p>Different samples result in different measures of occurrence.</p>
<p>Sample size will determine:</p>
<ul>
<li><p>the magnitude of the effect = the proximity of the measure of occurrence to the true value</p></li>
<li><p>the precision of the estimation method = <strong>statistical precision</strong>: the inverse of the variance.</p></li>
</ul>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-03%20at%2015.55.00.png" /></p>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-15%20at%2010.10.18.png" /></p>
<p><strong>SAMPLE SIZE ESTIMATION</strong></p>
<ul>
<li>PROPORTION</li>
</ul>
<p><span class="math display">\[n= \frac{z^2_{\alpha/2}\hat{p}(1-\hat{p})}{\epsilon^2}\]</span></p>
<p>to determine <span class="math inline">\(\hat{p}(1-\hat{p})\)</span> we can use: * prior knowledge</p>
<ul>
<li>set <span class="math inline">\(\hat{p}=1/2= 0.5 \to \hat{p}(1-\hat{p}) = 1/4 = 0.25\)</span> because that is the maximum for <span class="math inline">\(maximum\:f(\hat{p})=\hat{p}(1-\hat{p}) \to \frac{d[\hat{p}(1-\hat{p})]}{d\hat{p}}= \frac{d[\hat{p}-\hat{p}^2]}{d\hat{p}} = 1-2\hat{p}= 0 \to \hat{p}= 1/2 \to f(\hat{p}= 1/2)=1/2(1-1/2)= 1/4\)</span></li>
</ul>
<p><strong>POWER</strong></p>
<p>is a probability that the null hypothesis (H0) will be rejected when it is false, that is, the probability that we will find a true association between exposure and outcome.</p>
<p>it depends on :</p>
<ul>
<li>the effective sample size</li>
<li>the true association in the population</li>
<li>biases and errors in the data</li>
</ul>
</div>
<div id="observational-studies" class="section level2">
<h2>OBSERVATIONAL STUDIES</h2>
<div id="ecological" class="section level3">
<h3>ecological</h3>
<ul>
<li><p>unit of study: group</p></li>
<li><p>measure: rate of disease, rate of exposure.</p></li>
</ul>
</div>
<div id="cross--sectional" class="section level3">
<h3>cross -sectional</h3>
<p>SImultaneously collect data on disease and exposure status = snapshot of the population</p>
<ul>
<li><p>unit of study: individual</p></li>
<li><p>measure:</p>
<ul>
<li>prevalence ratio of disease: in exposed vs non-exposed</li>
</ul>
<p><span class="math display">\[\frac{P(D^+|E^+)}{P(D^+|E^-)}\]</span></p>
<ul>
<li><p>prevalence ratio of exposure: in diseased vs not diseased</p>
<p><span class="math display">\[\frac{P(E^+|D^+)}{P(E^+|D^-)}\]</span></p></li>
<li><p>OR of disease in exposed vs non-exposed: odds D+ in E+ group/ odds D+ in E- group</p></li>
</ul></li>
</ul>
<p><span class="math display">\[\frac{\frac{P(D^+|E^+)}{P(D^-|E^+)}}{\frac{P(D^+|E^-)}{P(D^-|E^-)}}=\frac{\frac{a}{b}}{\frac{c}{d}}=\frac{ad}{bc}=\frac{odds\:D^+\:in\:exposed\:population}{odds\:D^+\:in\:unexposed\:population}\]</span> + OR of exposure in diseased vs not diseased= odds E+ in D+ group/ odds E+ in D- group</p>
<p><span class="math display">\[\frac{\frac{P(E^+|D^+)}{P(E^-|D^+)}}{\frac{P(E^+|D^-)}{P(E^-|D^-)}}=\frac{\frac{a}{c}}{\frac{b}{d}}=\frac{ad}{bc}=\frac{odds\:E^+\:in\:diseased\:population}{odds\:E^+\:in\:not\:diseased\:population}\]</span></p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-10%20at%2011.05.22.png" alt="" />
<p class="caption">Grodis</p>
</div>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-10%20at%2011.07.34.png" alt="" />
<p class="caption">Grodis</p>
</div>
<p><strong>cons</strong>: not good for diseases or exposures that are rare, or diseases with long incubation periods (the duration of disease alters the perception of prevalence).</p>
<p>The validity of these studies are greatly affected by the sensitivity and specificity of the tests used to determine the disease and exposure status.</p>
</div>
<div id="case-control" class="section level3">
<h3>case-control</h3>
<p>define population by disease status and determine past exposure</p>
<p>the compared populations must be defined with care to make sure they are comparable so the results are not confounded</p>
<ul>
<li><p>unit of study: individual</p></li>
<li><p>measure:</p>
<ul>
<li>Odds ratio (OR) of disease: in exposed vs non-exposed</li>
</ul>
<p><span class="math display">\[\frac{\frac{P(D^+|E^+)}{P(D^-|E^+)}}{\frac{P(D^+|E^-)}{P(D^-|E^-)}}=\frac{\frac{a}{b}}{\frac{c}{d}}=\frac{ad}{bc}=\frac{odds\:D^+\:in\:exposed\:population}{odds\:D^+\:in\:unexposed\:population}\]</span></p>
<ul>
<li>Odds ratio (OR) of exposure: in diseased vs not diseased</li>
</ul>
<p><span class="math display">\[\frac{\frac{P(E^+|D^+)}{P(E^-|D^+)}}{\frac{P(E^+|D^-)}{P(E^-|D^-)}}=\frac{\frac{a}{c}}{\frac{b}{d}}=\frac{ad}{bc}=\frac{odds\:E^+\:in\:diseased\:population}{odds\:E^+\:in\:not\:diseased\:population}\]</span></p></li>
</ul>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-10%20at%2011.20.04.png" alt="Grodis" /> <strong>SELECTION OF CONTROLS</strong></p>
<p>Minimize bias by selecting using the study base principle: the distribution of the exposure in the control group should be representative of the exposure in the study base, that is the population that produced the cases.</p>
<p><strong>Matching</strong>: selecting cases that are matched to controls by levels of a certain factor can improve efficiency of the analysis and reduce confounding.</p>
<p><strong>Overmatching</strong>: matching that harms 1. statistical efficiency 2. cost efficiency 3. validity</p>
<ul>
<li><p><strong>matching on non-confounder associated with exposure but not with the outcome</strong>: This causes selection bias. The factor must be included in the analysis. This is the worst candidate for matching.</p></li>
<li><p><strong>matching on a factor on the causal pathway between exposure and outcome</strong>:</p>
<ul>
<li>the factor is not associated with the outcome: This causes bias, and the factor must be included in the analysis (in the stratification, regression, etc…)</li>
<li>the factor is associated with the outcome: This causes selection bias and cannot be fixed by including the factor in the analysis.</li>
</ul></li>
<li><p><strong>matching on a factor with some association to exposure</strong>: example: neighborhood, friends, family….</p></li>
</ul>
</div>
<div id="cohort-longitudinal" class="section level3">
<h3>cohort = longitudinal</h3>
<p>the compared populations must be defined with care to make sure they are comparable so the results are not confounded</p>
<ul>
<li><p>unit of study: individual</p></li>
<li><p>measure:</p>
<ul>
<li><p>relative risk (RR) of disease: in exposed vs non-exposed</p>
<ul>
<li><p>cumulative incidence ratio: if the population is static</p></li>
<li><p>incidence density ratio: if the population is dynamic</p></li>
</ul></li>
</ul>
<p><span class="math display">\[\frac{P(D^+|E^+)}{P(D^+|E^-)}\]</span></p>
<ul>
<li>time to event: survival analysis.</li>
</ul></li>
</ul>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-10%20at%2011.27.56.png" alt="" />
<p class="caption">Gordis</p>
</div>
<p>define population:</p>
<ul>
<li><p>by not randomly assigned exposure status <span class="math inline">\(\to\)</span> determine the development of disease: allows the study of 1 exposure and multiple outcomes</p></li>
<li><p>randomly assigned individuals in the defined population <span class="math inline">\(\to\)</span> determine the development of disease and exposure status: : allows the study ofmultiple exposures and outcomes</p></li>
</ul>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-10%20at%2011.36.18.png" alt="" />
<p class="caption">Gordis</p>
</div>
<ul>
<li><p><strong>prospective</strong>: enroll participants based on exposure status and follow up over time</p></li>
<li><p><strong>retrospective</strong>: enroll participants based on disease status and look at historic records to obtain exposure status.</p>
<ul>
<li><strong>cons</strong>: recall bias.</li>
</ul></li>
</ul>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-10%20at%2011.34.46.png" alt="" />
<p class="caption">Gordis</p>
</div>
<p><strong>assumptions</strong></p>
<ul>
<li>Lost to follow up (LTF) are independent</li>
</ul>
</div>
<div id="cohort-based-case-control-studies" class="section level3">
<h3><strong>cohort-based case-control studies</strong></h3>
<p><strong>pros</strong>:</p>
<ul>
<li><p>exposure are have a temporal sequence and therefore are likely to be risk factors</p></li>
<li><p>cheaper as there are fewer lab costs ( you only test those who develop disease for exposure)</p></li>
<li><p>cases and controls are from the same population and therefore comparable</p></li>
</ul>
<p><strong>cons</strong>:</p>
</div>
<div id="nested-case-control" class="section level3">
<h3>nested case-control</h3>
<p>Controls selected by time of case development, that is the controls are matched with the cases on calendar time and follow-up time (time is considered a confounder).</p>
<p>Disadvantage: the control could turn into a case.</p>
<ul>
<li><p>measure:</p>
<ul>
<li>Odds ratio (OR)</li>
</ul></li>
</ul>
<p>By selecting the controls matching on time, we can interpret the odds ratio as a rate or risk measure, without making the rare disease assumption, by assuming only that the incidence is constant over time (see odds ratio section).</p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-10%20at%2011.47.56.png" alt="" />
<p class="caption">Gordis</p>
</div>
</div>
<div id="case-cohort" class="section level3">
<h3>case-cohort</h3>
<p>Controls selected by random allocation at the end of the study from non-cases in the defined cohort, that is the controls are NOT matched with the cases on calendar time and follow-up time.</p>
<ul>
<li><p>measure:</p>
<ul>
<li>Odds ratio (OR)</li>
</ul></li>
</ul>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-10%20at%2011.48.30.png" alt="" />
<p class="caption">Gordis</p>
</div>
</div>
<div id="comparison-case-control-and-cohort" class="section level3">
<h3><strong>comparison case-control and cohort</strong></h3>
<div class="figure">
<img src="notes%20screenshots/Gordis%20Epidemiology%205th_comparison.jpg" alt="" />
<p class="caption">Gordis</p>
</div>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-10%20at%2011.03.54.png" alt="" />
<p class="caption">Gordis: comparison case-control and cohort</p>
</div>
</div>
</div>
<div id="relationship-between-study-design-and-effect-measure" class="section level2">
<h2><strong>relationship between study design and effect measure</strong></h2>
<p>You CAN compute P(random event|fixed event)= probability of a random event conditioned on a fixed event.</p>
<p>You CAN’T compute P(fixed event|random event)= probability of a fixed event conditioned on a random event.</p>
<ol style="list-style-type: decimal">
<li>COHORT study: define participants by exposure status and follow up to observe occurrence of cases.</li>
</ol>
<p>random event = disease</p>
<p>fixed event = exposure.</p>
<p>Risk Ratio = P(D+|E+) and P(D+|E-) <span class="math inline">\(\to\)</span> <strong>CAN</strong> compute</p>
<p><span class="math display">\[RR= \frac{P(D^+|E^+)}{P(D^+|E^-)}=\frac{\frac{a}{a+b}}{\frac{c}{c+d}}=\frac{D^+\:in\:exposed\:population}{D^-\:in\:unexposed\:population}\]</span></p>
<ol start="2" style="list-style-type: decimal">
<li>CASE-CONTROL study: define participants by disease status and investigate occurrence of past exposure.</li>
</ol>
<p>random event = exposure</p>
<p>fixed event = disease</p>
<p>Risk Ratio = P(D+|E+) and P(D+|E-) <span class="math inline">\(\to\)</span> can’t compute!!!</p>
<p><span class="math display">\[RR= \frac{P(D^+|E^+)}{P(D^+|E^-)}=\frac{\frac{a}{a+b}}{\frac{c}{c+d}}=\frac{D^+\:in\:exposed\:population}{D^-\:in\:unexposed\:population}\]</span></p>
<p>OR= odds D+ in E+ group/ odds D+ in E- group <span class="math inline">\(\to\)</span> can’t compute</p>
<p><span class="math display">\[\frac{\frac{P(D^+|E^+)}{P(D^-|E^+)}}{\frac{P(D^+|E^-)}{P(D^-|E^-)}}=\frac{\frac{a}{b}}{\frac{c}{d}}=\frac{ad}{bc}=\frac{odds\:D^+\:in\:exposed\:population}{odds\:D^+\:in\:unexposed\:population}\]</span></p>
<p>OR= odds E+ in D+ group/ odds E+ in D- group <span class="math inline">\(\to\)</span> <strong>CAN</strong> compute because exposure can be treated as a random event.</p>
<p><span class="math display">\[\frac{\frac{P(E^+|D^+)}{P(E^-|D^+)}}{\frac{P(E^+|D^-)}{P(E^-|D^-)}}=\frac{\frac{a}{c}}{\frac{b}{d}}=\frac{ad}{bc}=\frac{odds\:E^+\:in\:diseased\:population}{odds\:E^+\:in\:not\:diseased\:population}\]</span></p>
<p><strong>OR are symmetric from the perspective of exposure and outcome, so it doesn’t matter! :) </strong></p>
<ol start="3" style="list-style-type: decimal">
<li>CROSS-SECTIONAL STUDY:</li>
</ol>
<p>Risk Ratio: can be estimated only if the cross-sectional study is a probability sample (each person has the same probability of being included in the study)</p>
<p>OR: can always be estimated</p>
<p>Logistic regression validly estimates odds ratios but does not necessarily validly estimate risk ratios.</p>
</div>
<div id="experimental-studies" class="section level2">
<h2>EXPERIMENTAL STUDIES</h2>
<div id="randomized-clinical-trial-rct" class="section level3">
<h3>randomized clinical trial = RCT</h3>
<p>Th goal is to test a hypothesis or answer a medical question</p>
<p>The population is defined and the exposure/treatment is randomly allocated in the defined population.</p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-10%20at%2012.21.14.png" alt="" />
<p class="caption">Gordis</p>
</div>
<p><strong>random allocation</strong></p>
<p>Why is random allocation important? Because it decreases bias, and therefore it is easier to obtain an unbiased effect and to extrapolate the results to the general population:</p>
<ul>
<li><p>selection bias: participants are not included in either exposure group based on a given factor (investigator bias, etc)</p></li>
<li><p>confounding and internal validity: the 2 groups are more likely to be comparable to one another in terms of unmeasured factors that may influence the outcome (age, sex, etc)</p></li>
<li><p><strong>stratified randomization</strong></p></li>
</ul>
<p>Using data collected prior to the randomization, the participants are:</p>
<ol style="list-style-type: decimal">
<li>stratified into groups</li>
<li>the exposure/treatment is randomly allocated in each group</li>
</ol>
<p>Goal: decrease the variation in an outcome due to a given factor: members of each stratum will be ore comparable to each other.</p>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-10%20at%2012.35.26.png" alt="" />
<p class="caption">Gordis Figure 7-4</p>
</div>
<p><strong>limitations</strong>: there is a limit to the amount of variables you can stratify by, as you want at least 20 individuals in each group.</p>
<p><strong>cons</strong>: it coplicates and delays randomization.</p>
<p><img src="notes%20screenshots/EPI%20205%20notes%20Sep%2028,%202018%20factorial.jpg" /></p>
<ul>
<li><p><strong>intent to treat analysis</strong> : even if the subject doesn’t comply with treatment, it is included in the orginial treatment group</p></li>
<li><p><strong>early stop point</strong> : and interim analysis can be performed midway throught the trial if there is sufficient sample size, and can lead to the discontinuation of the trial if there is sufficient evidence that the treat treatment works well or not.</p></li>
</ul>
<p>Experimental Clinical Trials Intervention Trials Prevention Trials Field Trials</p>
</div>
</div>
</div>
<div id="models" class="section level1">
<h1><strong>MODELS</strong></h1>
<p><strong>FREQUENTIST APPROACH</strong></p>
<p>The frequentist approach requires that all probabilities be defined by connection to the frequencies of events in very large samples. <strong>Frequentist uncertainty</strong> is premised on the imaginary resampling of data—if we were to repeat the measurement many many times, we would end up collecting a list of values that will have some pattern to it. It means also that parameters and models cannot have probability distributions, only measurements can. This resampling is never done, and in general it doesn’t even make sense—it is absurd to consider repeat sampling of the diversification of song birds in the Andes.But in many contexts, like controlled greenhouse experiments, it’s a useful device for describing uncertainty. Whatever the context, it’s just part of the model, an assumption about what the data would look like under resampling.</p>
<p><strong>Sampling distribution</strong> is the distribution of these measurements.</p>
<p>Example: Bayesian vs frequentist Galileo turned a primitive telescope to the night sky and became the first human to see Saturn’s rings. Well, he probably saw a blob, with some smaller blobs attached to it. Since the telescope was primitive, it couldn’t really focus the image very well. Saturn always appeared blurred. This is a statistical problem, of a sort. There’s uncertainty about the planet’s shape, but notice that none of the uncertainty is a result of variation in repeat measurements. We could look through the telescope a thousand times, and it will always give the same blurred image (for any given position of the Earth and Saturn). So the sampling distribution of any measurement is constant, because the measurement is deterministic—there’s nothing “random” about it. Frequentist statistical inference has a lot of trouble getting started here. In contrast, Bayesian inference proceeds as usual, because the deterministic “noise” can still be modeled using probability, as long as we don’t identify probability with frequency.</p>
<p>resampling of data—if we were to repeat the measurement many many times, we would end up collecting a list of values that will have some pattern to it. It means also that parameters and models cannot have probability distributions, only measurements can. The distribution of these measurements is called a sampling distribution. This resampling is never done, and in general it doesn’t even make sense—it is absurd to consider repeat sampling of the diversification of song birds in the Andes.</p>
<p><strong>BAYESIAN APPROACH</strong> In modest terms, Bayesian data analysis is no more than counting the numbers of ways the data could happen, according to our assumptions. Things that can happen more ways are more plausible.</p>
<div id="linear-regression" class="section level2">
<h2>LINEAR REGRESSION</h2>
<div id="outcome" class="section level3">
<h3>outcome</h3>
<p>continuous</p>
</div>
<div id="distribution" class="section level3">
<h3>distribution</h3>
<p>normal <span class="math inline">\(y_i \to Normal(\mu_i, \sigma)\)</span></p>
</div>
<div id="model" class="section level3">
<h3>model</h3>
<p><span class="math inline">\(\hat{y_i}=\beta_0 +\beta_1x_1...+\beta_n x_n\)</span> or <span class="math inline">\(\hat{y_i}=\alpha +\beta(x_i-\bar{x}) + \epsilon_i\)</span></p>
<p>linear predictor: <span class="math inline">\(\mu_i\)</span> = E(y)</p>
<p>dispersion parameter: <span class="math inline">\(\sigma^2\)</span> = Variance ( <span class="math inline">\(y | \mu\)</span> )</p>
</div>
<div id="link" class="section level3">
<h3>link</h3>
<p>identity: <span class="math inline">\(\mu = X \beta\)</span></p>
</div>
<div id="assumptions" class="section level3">
<h3>assumptions</h3>
<p>Gelman and Hill 2005:</p>
<p>Decreasing importance</p>
<p>1.<strong>validity</strong>: the outcome measure should accurately reflect the phenomenon of interest, the model should include all relevant predictors, and the model should generalize to the cases to which it will be applied.</p>
<p>2.<strong>additivity and linearity</strong>: its deterministic component is a linear function of the separate predictors: <span class="math inline">\(\hat{y_i}=\beta_0 +\beta_1x_1...+\beta_n x_n\)</span></p>
<p>In other words, for every given value of x, the spread of positive residuals is the same as of negative residuals.</p>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-09%20at%2013.42.06.png" /></p>
<ul>
<li><p>If additivity is violated, it might make sense to transform the data (for example, if y = abc,then logy = loga + logb + logc )or to add interactions</p></li>
<li><p>If linearity is violated:</p>
<ul>
<li>the dependent variable (y) can be transformed: usually to log</li>
<li>a predictor (x) can be transformed:
<ul>
<li>1/x or log(x) instead of simply linearly</li>
<li>as a categorical variable</li>
</ul></li>
<li>a more complicated relationship could be expressed:
<ul>
<li>by polynomials: including both x and x2 and/or x3 as predictors.</li>
<li>by using a nonlinear function such as a spline or other generalized additive model.</li>
</ul></li>
</ul></li>
</ul>
<p>3.<strong>independence of errors</strong>: the errors from the prediction line are independent. In other words, for every given value of x, the values of y are statistically independent from each other.</p>
<p>This is violated when observations are correlated, such as vision from each eye in one person, or height measured in the same person over time.</p>
<p>4.<strong>equal variance of errors</strong>: If the variance of the regression errors are unequal, estimation is more efficiently performed using weighted least squares. In other words, for every given value of x, the values of y are have the same variance.</p>
<p><img src="notes%20screenshots/LinearReg+05252019%20homo.jpg" /></p>
<p>5.<strong>normality of errors</strong>: the regression assumption that is generally least important is that the errors are normally distributed. In fact, for the purpose of estimating the regression line (as compared to predicting individual data points), the assumption of normality is barely important at all. Thus, in contrast to many regression textbooks, we do not recommend diagnostics of the normality of regression residuals. In other words, for every given value of x, the values of y have a normal distribution.</p>
<p>Example: height ~ age. For any given age, for example 25, the values of height will follow a normal distribution. This will usually happen as long as the sample size is large enough thanks to the Central Limit Theorem.</p>
<p>Example of residuals with equal variance and linearity assumptions met: <img src="notes%20screenshots/Screen%20Shot%202020-12-09%20at%2013.50.52.png" /></p>
</div>
<div id="parameter-estimation" class="section level3">
<h3>parameter estimation</h3>
<p>estimate the parameters by minimizing the sum of the prediction errors = deviance = least square estimates <span class="math inline">\((\hat{y_i}- \hat{y_i})^{2}\)</span></p>
<p><img src="notes%20screenshots/EPI%20203%20NOTES%20Jan%2012,%202019%20linreg.jpg" alt="Stats book" /> <img src="notes%20screenshots/EPI%20203%20NOTES%20Jan%2012,%202019line.jpg" alt="Satats book" /></p>
</div>
<div id="interpretation-of-coefficients" class="section level3">
<h3>interpretation of coefficients</h3>
<p>EXAMPLE child test score from maternal education and maternal IQ. The fitted model is: kid.score = 26 + 6 · mom.hs + 0.6 · mom.iq + error</p>
<p>In this model the slope of the regression of child’s test score on mother’s IQ is forced to be equal across subgroups defined by mother’s high school completion,</p>
<p><span class="math inline">\(\beta_0\)</span> The <em>intercept</em>. If a child had a mother with an IQ of 0 and who did not complete high school (thus, mom.hs = 0), then we would predict this child’s test score to be 26. This is not a useful prediction, since no mothers have IQs of 0.</p>
<p><span class="math inline">\(\beta_{momhs}\)</span> The coefficient of maternal high school completion. Comparing children whose mothers have the same IQ, but who differed in whether they completed high school, the model predicts an expected difference of 6 in their test scores.</p>
<p><span class="math inline">\(\beta_{momiq}\)</span> The coeðcient of maternal IQ. Comparing children with the same value of mom.hs, but whose mothers differ by 1 point in IQ, we would expect to see a difference of 0.6 points in the child’s test score (equivalently, a difference of 10 in mothers’ IQs corresponds to a difference of 6 points for their children).</p>
<p><span class="math inline">\(\beta_{momiq:momhs}\)</span> <strong>interaction</strong> allows the slope to vary across subgroups.</p>
<p>EXAMPLE kid.score = -11 + 51 · mom.hs + 1.1 · mom.iq - 0.5 · mom.hs · mom.iq + error</p>
<ol style="list-style-type: decimal">
<li><p>The intercept represents the predicted test scores for children whose mothers did not complete high school and had IQs of 0—not a meaningful scenario.</p></li>
<li><p>The coefficient of mom.hs can be conceived as the difference between the predicted test scores for children whose mothers did not complete high school and had IQs of 0, and children whose mothers did complete high school and had IQs of 0. You can see this by just plugging in the appropriate numbers and comparing the equations. Since it is implausible to imagine mothers with IQs of zero, this coefficient is not easily interpretable.</p></li>
<li><p>The coefficient of mom.iq can be thought of as the comparison of mean test scores across children whose mothers did not complete high school, but whose mothers differ by 1 point in IQ.</p></li>
<li><p>The coefficient on the interaction term represents the difference in the slope for mom.iq, comparing children with mothers who did and did not complete high school.</p></li>
</ol>
<p>Another way of looking at this is modeling different slopes for moms that did complete high school and moms that didn’t</p>
<p>no hs: kid.score = -11+51·0+1.1·mom.iq-0.5·0·mom.iq = -11 + 1.1 · mom.iq</p>
<p>hs: kid.score = -11+51·1+1.1·mom.iq-0.5·1·mom.iq = 40 + 0.6 · mom.iq.</p>
<p>The estimated slopes of 1.1 for children whose mothers did not complete high school and 0.6 for children of mothers who did are directly interpretable. The intercepts still suffer from the problem of only being interpretable at mothers’ IQs of 0.</p>
<p><strong>CENTERING VARIABLES</strong></p>
<p>Models with interactions can often be more easily interpreted if we first pre-process the data by centering each input variable about its mean or some other convenient reference point.</p>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-09%20at%2013.31.28.png" /> examples: kid.score = 26 + 6 · mom.hs + 0.6 · (mom.iq- avg.mom.iq) + error</p>
<p><span class="math inline">\(\beta_0\)</span> The <em>intercept</em>. If a child had a mother with an IQ at the average IQ ( thus mom.iq= avg.mom.iq) and who did not complete high school (thus, mom.hs = 0), then we would predict this child’s test score to be 26. This is an interpretable prediction.</p>
</div>
<div id="inference" class="section level3">
<h3>inference</h3>
<p>The least squares estimate is the maximum likelihood estimate if the errors <span class="math inline">\(\epsilon_i\)</span> are independent with equal variance and normally distributed, and for the model <span class="math inline">\(y=X\beta+\epsilon\)</span> it is the <span class="math inline">\(\hat{\beta}\)</span> that minimizes the sum of squares <span class="math inline">\((y_i- X_i\hat{\beta})^{2}\)</span>. If we are trying to predict an outcome using other variables, we want to do so in such a way as to minimize the error of our prediction.</p>
<p><em>Residuals</em>: <span class="math inline">\(r_i= y_i- X_i\hat{\beta}\)</span> are the differences between the data and the fitted values. As a byproduct of the least squares estimation of <span class="math inline">\(\beta\)</span>, the residuals ri will be uncorrelated with all the predictors in the model.</p>
<p><em>Residual standard deviation</em>: <span class="math inline">\(\hat{\sigma}\)</span> summarizes the scale of the residuals. For example, in the test scores example, <span class="math inline">\(\hat{\sigma}\)</span> = 18, which tells us that the linear model can predict children’s test scores to about an accuracy of 18 points. It’s like a measure of the average distance each observation falls from its prediction from the model. We are typically interested in it for its own sake—as a measure of the unexplained variation in the data—or because of its relevance to the precision of inferences about the regression coefficients <span class="math inline">\(\beta\)</span>.</p>
</div>
<div id="example" class="section level3">
<h3>example</h3>
</div>
</div>
<div id="generalized-linear-models" class="section level2">
<h2><strong>GENERALIZED LINEAR MODELS</strong></h2>
<p>generalize the linear regression strategy—replace a parameter describing the shape of the likelihood with a linear model—to probability distributions other than the Gaussian.</p>
<p>Steps:</p>
<p>1.We need a linear predictor of the same form as in linear regression <span class="math inline">\(\beta X\)</span>. Such a linear predictor can generate any type of number as a prediction: positive, negative, or zero</p>
<p>2.We choose a suitable distribution for the type of data we are predicting (normal for any number, gamma for positive numbers, binomial for binary responses, Poisson for counts)</p>
<p>3.We create a link function which maps the mean of the distribution onto the set of all possible linear prediction results, which is the whole real line (-∞, ∞)</p>
<p>4.The inverse of the link function takes the linear predictor to the actual prediction</p>
</div>
<div id="logistic-regression" class="section level2">
<h2>LOGISTIC REGRESSION</h2>
<div id="outcome-1" class="section level3">
<h3>outcome</h3>
<p>binary (0,1)</p>
</div>
<div id="distribution-1" class="section level3">
<h3>distribution</h3>
<p>binomial: <span class="math inline">\(y_i \to Binomial(n, p_i)\)</span></p>
<p>we want to know the number of successes (x) out of (n) Bernoulli trials.</p>
<p><strong>pmf</strong> <span class="math display">\[f(x)= \begin{pmatrix} n\\x \end{pmatrix} p^x (1-p)^{n-x}\]</span></p>
</div>
<div id="model-1" class="section level3">
<h3>model</h3>
<p><span class="math inline">\(f(\hat{p_i})=\alpha +\beta(x_i-\bar{x})\)</span></p>
<p>linear predictor: <span class="math inline">\(\eta_i\)</span> = <span class="math inline">\(logit(\hat{p_i}) = log(p_i/(1-p_i)) = log(ODDS) =\alpha +\beta x_i\)</span></p>
</div>
<div id="link-1" class="section level3">
<h3>link</h3>
<p><strong>LOGIT LINK</strong>: The logit link maps a parameter that is defined as a probability mass, and therefore constrained to lie between zero and one, onto a linear model that can take on any real value ( possible means (probabilities) (0,1) to the scale of linear predictors (-∞, ∞)). This link is extremely common when working with binomial GLMs. In the context of a model definition, it looks like this:</p>
<p><span class="math inline">\(logit(\hat{p_i}) = log(p_i/(1-p_i)) = log(ODDS) =\alpha +\beta x_i\)</span></p>
<p>if p→0 then logit(p) → −∞</p>
<p>if p→1 then logit(p) → ∞</p>
<p><strong>log-odds</strong>: the logit function <span class="math inline">\(logit(\hat{p_i}) = log(p_i/(1-p_i))\)</span></p>
<p>The “odds” of an event are just the probability it happens divided by the probability it does not happen. So really all that is being stated here is: <span class="math inline">\(log(p_i/(1-p_i))= \alpha +\beta x_i\)</span></p>
<p><strong>inverse-logit</strong>: it inverts the logit transform to figure out the definition of pi implied here: <span class="math inline">\(p_i = e^{(\alpha +\beta x_i)} / 1 + e^{(\alpha +\beta x_i)}\)</span></p>
<p>x → −∞ then inverse logit (x) → 0</p>
<p>x → + ∞ then inverse logit (x) → 1</p>
<p><img src="index_files/figure-html/logit%20lik-1.png" width="672" /> "What all of this means is that when you use a logit link for a parameter, you are defining the parameter’s value to be the logistic transform of the linear model. On the left, the geometry of the linear model is shown, with horizontal lines indicating unit changes in the value of the linear model as the value of a predictor x changes. This is the log-odds space, which extends continuously in both positive and negative directions. On the right, the linear space is trans- formed and is now constrained entirely between zero and one. The horizontal lines have been compressed near the boundaries, in order to make the linear space fit within the probability space. This compression produces the characteristic logistic shape of the transformed linear model shown in the right-hand plot.</p>
<p>No longer does a unit change in a predictor variable produce a constant change in the mean of the outcome variable. Instead, a unit change in xi may produce a larger or smaller change in the probability pi, depending upon how far from zero the log-odds are. For example, in the figure, when x = 0 the linear model has a value of zero on the log-odds scale. A half- unit increase in x results in about a 0.25 increase in probability. But each addition half-unit will produce less and less of an increase in probability, until any increase is vanishingly small. The key lesson for now is just that no regression coefficient, such as β, from a GLM ever produces a constant change on the outcome scale." <span class="citation">@mcelreath2020</span></p>
</div>
<div id="assumptions-1" class="section level3">
<h3>assumptions</h3>
<ul>
<li><p>binary outcome: the outcome is a binary or dichotomous variable like yes vs no, positive vs negative, 1 vs 0.</p></li>
<li><p>linearity: <span class="math inline">\(logit(\hat{p_i})\)</span> is a linear function of the predictors = it is linear in the coefficients. There is a linear relationship between the logit of the outcome and each predictor variables.</p></li>
<li><p>independence: the different observations are statistically independent</p></li>
<li><p>absence of multicollinearity: there is no high intercorrelations (i.e. multicollinearity) among the predictors.</p></li>
<li><p>lack of strongly influential outliers: there is no influential values (extreme values or outliers) in the continuous predictors</p></li>
<li><p>variance function: <span class="math inline">\(\sigma^2 = np(1-p)\)</span></p></li>
<li><p>expectation: <span class="math inline">\(E(X)= \mu= np\)</span></p></li>
<li><p>binomial: the error distribution is binomial</p></li>
</ul>
</div>
<div id="parameter-estimation-1" class="section level3">
<h3>parameter estimation</h3>
<p><strong>MAXIMUM LIKELIHOOD ESTIMATION</strong></p>
<p>The likelihood is the pdf of the data thought of as a function of the parameters for data already observed (the data is fixed, the values of the parameters vary accordingly).</p>
<p>Maximum likelihood (ML) is an established method of estimating the parameters in a data analysis problem.</p>
<p><strong>Binomial distribution</strong> pmf: function of x, given a certain n and p :<span class="math inline">\(f ( x | n , p ) = \begin{pmatrix} n \\ x \end{pmatrix} p^x (1-p)^{n-x}\)</span></p>
<p><strong>Likelihood function</strong>: function of p, given a certain n and x (given by the data) <span class="math inline">\(f ( p | n , x ) =\begin{pmatrix} n \\x \end{pmatrix} p^x (1-p)^{n-x}\)</span></p>
<p>Log of the Likelihood function (omitting the first term because it doesn’t depend on p): <span class="math inline">\(g(p)= x ln(p) + (n-x) ln(1-p)\)</span></p>
<p>Derivative of the Log of the Likelihood function <span class="math inline">\(g&#39;(p)= (x/p) - (n-x)/(1-p) = 0\)</span></p>
<p>The <em>Maximum likelihood estimator</em> is: <span class="math inline">\(\hat{p} = x/n\)</span></p>
<p>The likelihood is a graph of the value of the different values of p for a given value of n and x</p>
<p><em>Likelihood of the ith observation</em></p>
<p><span class="math inline">\(p_{i}^{x_{i}}(1-p_{i})^{1-x_{i}}\)</span></p>
<p>So for <span class="math inline">\(y_1, y_2 ... y_n \to b(m, p_i)\)</span></p>
<p>The <strong>Maximum likelihood estimator</strong> is: <span class="math inline">\(\hat{p} = y_i/m\)</span></p>
<p><strong>Likelihood</strong> = product of the likelihoods of the m individual i observations and n parameterns</p>
<p><span class="math inline">\(f ( p_i | m , y_i ) = \begin{pmatrix} m \\ y_i \end{pmatrix} (y_i/m)^{y_i} (1-y_i/m)^{m-y_i}\)</span></p>
<p>Log of the Likelihood function: <span class="math inline">\(g(p_i)= y_i ln(y_i/m) + \sum(m-y_i) ln(1-y_i/m)\)</span></p>
<p>The Log likelihood is maximized with respect to <span class="math inline">\(\beta_{0}\)</span> and <span class="math inline">\(\beta_{1}\)</span> that are chosen so that:</p>
<p><span class="math inline">\(p_{i}\)</span> is large when <span class="math inline">\(x_{i} = 1\)</span> because we want <span class="math inline">\(\sum_{x_{i} = 1} ln (p_{i})\)</span> to be big</p>
<p><span class="math inline">\(p_{i}\)</span> is small when <span class="math inline">\(x_{i} = 0\)</span> because we want <span class="math inline">\(\sum_{x_{i} = 0}ln(1-p_{i})\)</span> to be big</p>
<p>Because <span class="math inline">\(p_{i}^{x_{i}}(1-p_{i})^{1-x_{i}}\)</span> then</p>
<p><span class="math inline">\(x_{i} = 0 \rightarrow (1-p_{i})\)</span></p>
<p><span class="math inline">\(x_{i} = 1 \rightarrow p_{i}\)</span></p>
</div>
<div id="interpretation-of-coefficients-1" class="section level3">
<h3>interpretation of coefficients</h3>
<p><strong>interpretation of coefficients as probabilities</strong></p>
<p>The curve of the logistic function requires us to choose where to evaluate changes, if we want to interpret on the probability scale. The mean of the input variables in the data is often a useful starting point.</p>
<p>EXAMPLE: Pr(Bush support) = invlogit (-1.40 + 0.33 · income)</p>
<p><span class="math inline">\(\beta_0\)</span>:</p>
<p>For this dataset, income is on a 1–5 scale. We can evaluate Pr(Bush support) at the central income category (3) and get inverse logit(-1.40 + 0.33 · 3) = 0.40.</p>
<p><span class="math inline">\(\beta_{income}\)</span>: A difference of 1 in income (on this 1–5 scale) corresponds to a positive difference of 0.33 in the logit probability of supporting Bush.</p>
<ul>
<li><em>evaluate how the probability differs with a unit difference in x near the central value</em>:</li>
</ul>
<p>In this example: <span class="math inline">\(\bar{x}= 3.1\)</span>, so we can evaluate the logistic regression function at x = 3 and x = 2 ( 3 - 2 = 1 unit difference in x).</p>
<p>inverse logit(-1.40 + 0.33 · 3) - inverse logit(-1.40 + 0.33 · 2) = 0.08</p>
<p>A difference of 1 in income category corresponds to a positive difference of 8% in the probability of supporting Bush.</p>
<ul>
<li><em>compute the derivative of the logistic curve at the central value</em>:</li>
</ul>
<p>derivative of the inverse logit (<span class="math inline">\(\alpha +\beta x_i\)</span>) = <span class="math inline">\(\frac{df}{dx} e^{(\alpha +\beta x_i)} / 1 + e^{(\alpha +\beta x_i)} = \beta e^{(\alpha +\beta x_i)}/(1 + e^{(\alpha +\beta x_i)})^2\)</span></p>
<p>In this example:</p>
<p>The mean of x= <span class="math inline">\(\bar{x}= 3.1\)</span>.</p>
<p>The value of the linear predictor at the central value: -1.40 + 0.33 · 3.1 = -0.39.</p>
<p>The slope of the curve—the “change” in Pr(y = 1) per small unit of “change” in x is the derivative of the inverse logit at the central value: <span class="math inline">\(\frac{df}{dx} e^{(-1.40 + 0.33 · 3.1)} / 1 + e^{(-1.40 + 0.33 · 3.1)}= 0.33 e^{(-0.39)} / (1 + e^{(-0.39)})^2= 0.13\)</span></p>
<ul>
<li><em>divide by 4 rule</em>:</li>
</ul>
<p>The logistic curve is steepest at its center, at which point <span class="math inline">\(\alpha +\beta x_i = 0\)</span> so that inverse logit (<span class="math inline">\(\alpha +\beta x_i\)</span>) = 0.5</p>
<p>The slope of the curve—the derivative of the logistic function—is maximized at this point and attains the value <span class="math inline">\(\beta e^{(0)} / (1 + e^{(0)})^2= \beta/4\)</span>.</p>
<p><span class="math inline">\(\beta/4\)</span> is the maximum difference in Pr(y = 1) corresponding to a unit difference in x. As a rule of convenience, we can take logistic regression coefficients (other than the constant term) and divide them by 4 to get an upper bound of the predictive difference corresponding to a unit difference in x. This upper bound is a reasonable approximation near the midpoint of the logistic curve, where probabilities are close to 0.5.</p>
<p>In this example: 0.33/4 = 0.08. A difference of 1 in income category corresponds to no more than an 8% positive difference in the probability of supporting Bush.</p>
<p>The results from these 3 methods 0.08, 0.13 and 0.08 are close to each other. In some cases where a unit difference is large, the differencing and the derivative can give slightly different answers. They will always be the same sign, however.</p>
<p><strong>interpretation of coefficients as odds ratios</strong></p>
<p>The “odds” of an event are just the probability it happens divided by the probability it does not happen: <span class="math inline">\((p_i/(1-p_i))\)</span></p>
<p>The ratio of two odds is an <strong>odds ratio</strong>: <span class="math inline">\((p_1/(1-p_1))/(p_2/(1-p_2))\)</span></p>
<p>An advantage of working with odds ratios (instead of probabilities) is that it is possible to keep scaling up odds ratios indefinitely without running into the boundary points of 0 and 1.</p>
<p><span class="math inline">\(log(P(y=1|x)/P(y=0|x))= log ODDS= \alpha +\beta x_i\)</span></p>
<p>Adding 1 to x (that is, changing x to x+1) has the effect of adding <span class="math inline">\(\beta\)</span> to both sides of the equation. <span class="math inline">\(log(P(y=1|x)/P(y=0|x)) + \beta = log ODDS + \beta= \alpha +\beta x + \beta = \alpha +\beta (x+1)\)</span></p>
<p>Exponentiating both sides, the odds are then multiplied by <span class="math inline">\(e^{\beta}\)</span>.</p>
<p><span class="math inline">\(e^{log ODDS + \beta}= e^{\alpha +\beta (x + 1)}\)</span></p>
<p><span class="math inline">\(ODDS e^{\beta}= e^{\alpha +\beta (x + 1)}\)</span></p>
<p>Exponentiated logistic regression coefficients can be interpreted as odds ratios.</p>
<p>EXAMPLE: if <span class="math inline">\(\beta= 0.2\)</span>, then a unit difference in x corresponds to a multiplicative change of <span class="math inline">\(e^{0.2} = 1.22\)</span> in the odds (for example, changing the odds from 1 to 1.22, or changing p from 0.5 to 0.55).</p>
<p><span class="math inline">\(\beta_0\)</span> = intercept: baseline log odds. This is meaningful only for the specific population at hand (mainly in cohort studies). EXAMPLE: If we have a case control study with 50% cases and 50% controls, and the population has 4% cases, then clearly the baseline risk for the case control study has no relevance to the population.</p>
<p><span class="math inline">\(\beta_i\)</span>: holding all other factors constant:</p>
<ul>
<li><p>continuous variable: log of the odds ratio for a unit change in the variable (because a difference of logs is the log of the ratio)</p></li>
<li><p>categorical variable: change in the log odds ratio from the baseline level</p></li>
</ul>
<p><span class="math inline">\(\beta_{A:B}\)</span> = interaction: holding all other factors constant:</p>
<p>the effect of A depends on the level of B</p>
<p><span class="math inline">\(\eta_i\)</span> = <span class="math inline">\(logit(\hat{p_i}) = log(p_i/(1-p_i)) = log(ODDS) =\alpha +\beta_A x_A + \beta_B x_B + \beta_{A:B} x_{A:B}\)</span></p>
<p>when <span class="math inline">\(x_B= 0\)</span> the effect of A is <span class="math inline">\(\beta_A\)</span></p>
<p>when <span class="math inline">\(x_B= 1\)</span> the effect of A is <span class="math inline">\(\beta_A + \beta_{A:B}\)</span></p>
<p>EXAMPLE: in study about distribution of insulin-like growth factor (IGF-1). menarche ~ age + tanner</p>
<pre class="r"><code>library(&quot;ISwR&quot;)

data(juul)

juul1 &lt;- subset(juul,age &gt; 8 &amp; age &lt; 20 &amp; complete.cases(menarche))

juul1$menarche &lt;- factor(juul1$menarche,labels=c(&quot;No&quot;,&quot;Yes&quot;)) 
juul1$tanner &lt;- factor(juul1$tanner) 

attach(juul1)

juul1.glm &lt;- glm(menarche~age+tanner,binomial,data=juul1) 
summary(juul1.glm)</code></pre>
<pre><code>## 
## Call:
## glm(formula = menarche ~ age + tanner, family = binomial, data = juul1)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.56180  -0.12461   0.02475   0.08055   2.86120  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -13.7758     2.7630  -4.986 6.17e-07 ***
## age           0.8603     0.2311   3.723 0.000197 ***
## tanner2      -0.5211     1.4846  -0.351 0.725609    
## tanner3       0.8264     1.2377   0.668 0.504313    
## tanner4       2.5645     1.2172   2.107 0.035132 *  
## tanner5       5.1897     1.4140   3.670 0.000242 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 604.19  on 435  degrees of freedom
## Residual deviance: 106.60  on 430  degrees of freedom
##   (83 observations deleted due to missingness)
## AIC: 118.6
## 
## Number of Fisher Scoring iterations: 8</code></pre>
<p><span class="math inline">\(\beta age\)</span></p>
<p>Log odds ratio for one year increase in age is 0.8603, holding tanner constant <span class="math inline">\(\to\)</span> Odds ratio is exp(0.8603) = 2.364</p>
<p>Log odds ratio for a two year increase in age is (2)(0.8603) = 1.7206 <span class="math inline">\(\to\)</span> Odds ratio is exp(1.7206) = 5.588</p>
<p><span class="math inline">\(\beta tanner4\)</span></p>
<ul>
<li>Log odds ratio for tanner 4 vs. tanner 1 is 2.5645, holding age constant</li>
</ul>
<p>Odds ratio is exp(2.5645) = 12.994</p>
<p>This means the odds of having menarche are 13 times higher for girls with tanner4 than with tanner1.</p>
<ul>
<li>Log odds ratio for tanner 4 vs. tanner 3 is 2.5645 – 0.8264 = 1.7381</li>
</ul>
<p>Odds ratio is exp(1.7381) = 5.687</p>
</div>
<div id="inference-1" class="section level3">
<h3>inference</h3>
<p><strong>confidence intervals</strong>: to calculate a confidence interval you need to know the standard deviation. To know the standard deviation you need to know the variance, which we can obtain from the variance-covariance matrix.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">A</th>
<th align="left">B</th>
<th align="left">C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="left">VAR(A)</td>
<td align="left">COV(A,B)</td>
<td align="left">COV(C,A)</td>
</tr>
<tr class="even">
<td align="left">B</td>
<td align="left">COV(B,A)</td>
<td align="left">VAR(B)</td>
<td align="left">COV(C,B)</td>
</tr>
<tr class="odd">
<td align="left">C</td>
<td align="left">COV(A,C)</td>
<td align="left">COV(B,C)</td>
<td align="left">VAR(C)</td>
</tr>
</tbody>
</table>
<ul>
<li><em>confidence interval for one variable</em> :</li>
</ul>
<p>log odds confidence interval:<span class="math inline">\(\beta_i \pm z_{0.025} \sqrt{Var(\beta_i)}\)</span></p>
<p>odds ratio confidence interval:<span class="math inline">\(e^{\beta_i \pm z_{0.025} \sqrt{Var(\beta_i)}}\)</span></p>
<ul>
<li><em>confidence interval between two levels of the same variable</em> :</li>
</ul>
<p>log odds confidence interval: <span class="math inline">\((\beta_C - \beta_B) \pm 1.96 \sqrt{Var(B) + Var(C) - 2COV(B,C)}\)</span></p>
<p>odds ratio confidence interval: <span class="math inline">\(e^{(\beta_C - \beta_B) \pm 1.96 \sqrt{Var(B) + Var(C) - 2COV(B,C)}}\)</span></p>
<p>Because: If X and Y are random variables then <span class="math inline">\(V(X-Y) = V(X) + V(Y)- 2Cov(X,Y)\)</span></p>
<p>EXAMPLE: Confidence interval of the estimated log odds between tanner4 and tanner5</p>
<p><em>coefficient matrix</em></p>
<pre class="r"><code>c1 &lt;- coef(juul1.glm)
c1</code></pre>
<pre><code>## (Intercept)         age     tanner2     tanner3     tanner4     tanner5 
## -13.7758129   0.8603095  -0.5210667   0.8264390   2.5645049   5.1896586</code></pre>
<p><em>variance_covariance matrix</em></p>
<pre class="r"><code>v1 &lt;- vcov(juul1.glm)
v1</code></pre>
<pre><code>##             (Intercept)         age     tanner2    tanner3    tanner4
## (Intercept)  7.63420854 -0.59398971 -0.08627975  0.2184034  0.4414426
## age         -0.59398971  0.05338584 -0.08439333 -0.1117773 -0.1318233
## tanner2     -0.08627975 -0.08439333  2.20415172  1.2019693  1.2336584
## tanner3      0.21840340 -0.11177725  1.20196929  1.5319140  1.3012763
## tanner4      0.44144258 -0.13182328  1.23365842  1.3012763  1.4816528
## tanner5      0.69730303 -0.15481918  1.27001076  1.3494243  1.4075578
##                tanner5
## (Intercept)  0.6973030
## age         -0.1548192
## tanner2      1.2700108
## tanner3      1.3494243
## tanner4      1.4075578
## tanner5      1.9993267</code></pre>
<p>We want to compare tanner4 to tanner5, so we only care about the last 2 columns.</p>
<pre class="r"><code>#We set the other 4 columns to 0. We want to substract tanner4 from tanner5, so we multiply tanner4 by -1 and tanner5 by 1.

#in vector form this will multiply the rows of the vcv matrix 

b1 &lt;- c(0,0,0,0,-1,1)
b1</code></pre>
<pre><code>## [1]  0  0  0  0 -1  1</code></pre>
<pre class="r"><code>#in transposed vector form this will multiply the columns of the vcv matrix 
t(b1) </code></pre>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,]    0    0    0    0   -1    1</code></pre>
<p>multiplying t(b1) * c1 is the same as doing 5.1897 − 2.5645 = 2.6252</p>
<p>this is the difference in the log odds between tanner4 and tanner5</p>
<pre class="r"><code>t(b1) %*% c1</code></pre>
<pre><code>##          [,1]
## [1,] 2.625154</code></pre>
<p>to calculate the ci we need the variance, which we extract like so:</p>
<p>we multiply the cols and rows by (0,0,0,-1,1) in order to end up with the bottom right corner of 4 numbers</p>
<p>1.4816528 1.4075578</p>
<p>1.4075578 1.9993267</p>
<p>var of the difference= var(x) + var (y) - 2 cov(x,y) = 1.4816528 +1.9993267 -2 *( 1.4075578)</p>
<pre class="r"><code> t(b1)%*% v1 %*% b1</code></pre>
<pre><code>##           [,1]
## [1,] 0.6658638</code></pre>
<p>0.6658638 is the variance. to calculate the ci we need the se, so sqrt(0.6658638)</p>
<p>ci for the log odds ratio 2.625154 ± (1.960)√0.6658638 = (1.025, 4.224)</p>
<p>ci for the odds ratio (2.787, 68.33)</p>
<ul>
<li><em>confidence interval of an interaction</em></li>
</ul>
<p>log odds confidence interval: <span class="math inline">\((\beta_A + \beta_{A:B}) \pm 1.96 \sqrt{Var(A) + Var(A:B) - 2COV(A,A:B)}\)</span></p>
<p>odds ratio confidence interval: <span class="math inline">\(e^{(\beta_A + \beta_{A:B}) \pm 1.96 \sqrt{Var(A) + Var(A:B) - 2COV(A,A:B)}}\)</span></p>
</div>
<div id="model-selection" class="section level3">
<h3>model selection</h3>
<p><strong>deviance</strong> : twice the difference between the best possible log likelihood and the log likelihood under the model.</p>
<p>The differences in deviance are assessed using the chi‐squared distribution with degrees of freedom equal to the number of parameters omitted between the larger and smaller model. This test is asymptotic, that is, it gets more accurate as n increases.</p>
<p>smaller values are better.</p>
<p>EXAMPLE: <span class="math inline">\(y_{i} = y_{1}, y_{2}...y_{n}\)</span> ~ bin(m, <span class="math inline">\(p_{i}\)</span>)</p>
<p>The best fit possible is to set <span class="math inline">\(\hat{p_{i}} = y_{i}/m\)</span></p>
<p><em>Best likelihood</em>: has the highest possible value for the likelihood and uses n parameters (all n of the <span class="math inline">\(y_{i}\)</span>s): <span class="math inline">\(\prod\begin{pmatrix} m \\y_{i} \end{pmatrix} (y_{i}/m)^{y_{i}} (1-y_{i}/m)^{m-y_{i}}\)</span></p>
<p><em>Best log likelihood</em>: <span class="math inline">\(y_{i} ln(y_{i}/m) +(m-y_{i})ln (1-y_{i}/m)\)</span></p>
<p>If instead we use a a statistical model using fewer parameters that predicts <span class="math inline">\(\hat{p_{i}}\)</span> , where <span class="math inline">\(\hat{\mu_{i}}=m \hat{p_{i}}\)</span></p>
<p><em>Model likelihood</em>: maximized by choosing the coefficients: <span class="math inline">\(\prod\begin{pmatrix} m \\y_{i} \end{pmatrix} (\hat{\mu_{i}}/m)^{y_{i}} (1-\hat{\mu_{i}}/m)^{m-y_{i}}\)</span></p>
<p><em>Model log likelihood</em>: <span class="math inline">\(y_{i} ln(\hat{\mu_{i}}/m) +(m-y_{i})ln (1-\hat{\mu_{i}}/m)\)</span></p>
<p><em>Deviance</em>= <span class="math inline">\(2(y_{i} ln(y_{i}/m) +(m-y_{i})ln (1-y_{i}/m) - (y_{i} ln(\hat{\mu_{i}}/m) +(m-y_{i})ln (1-\hat{\mu_{i}}/m)) ) = 2\sum[(y_{i} ln(y_{i}/\hat{\mu_{i}}) + (m-y_{i})ln((m- y_{i})/(m- \hat{\mu_{i}}))]\)</span></p>
<p>the farther <span class="math inline">\(y_{i}\)</span> is from <span class="math inline">\(\hat{\mu_{i}}\)</span>, the deviance is farther from 0 <span class="math inline">\(\rightarrow y_{i}/\hat{\mu_{i}}\)</span> becomes farther from 1 and because ln(1)= 0</p>
<p>Null Model:</p>
<p>all the <span class="math inline">\(\hat{p_{i}}\)</span> are the same and can the maximum likelihood estimator is</p>
<p><span class="math inline">\(\hat{p}= \sum y_{i}/mn\)</span> and <span class="math inline">\(\hat{\mu}= m\hat{p}\)</span></p>
</div>
<div id="predictive-simulation" class="section level3">
<h3>predictive simulation</h3>
<p>Example: probability of switching wells given the distance from the nearest safe well.</p>
<pre class="r"><code>## Read in the data
# Data are at http://www.stat.columbia.edu/~gelman/arm/examples/arsenic

library(&quot;arm&quot;)
wells &lt;- read.table(&quot;/Users/annakawiecki/Google\ Drive/epi/papers/Bayesian/gelman\ r\ code/ARM_Data/arsenic/wells.dat&quot;)

## Logistic regression 

fit.1 &lt;- glm (switch ~ dist, family=binomial(link=&quot;logit&quot;), data = wells)
display (fit.1)</code></pre>
<pre><code>## glm(formula = switch ~ dist, family = binomial(link = &quot;logit&quot;), 
##     data = wells)
##             coef.est coef.se
## (Intercept)  0.61     0.06  
## dist        -0.01     0.00  
## ---
##   n = 3020, k = 2
##   residual deviance = 4076.2, null deviance = 4118.1 (difference = 41.9)</code></pre>
<p><strong>simulating the uncertainty in the estimated coefficients</strong></p>
<div class="figure">
<img src="/Users/annakawiecki/Google%20Drive/epi/papers/Bayesian/gelman_hill%20figures/Screen%20Shot%202020-12-14%20at%2019.30.01.png" alt="" />
<p class="caption">Gelman and Hill Figure 7.6 and 7.7</p>
</div>
</div>
<div id="model-diagnostics" class="section level3">
<h3>model diagnostics</h3>
<p>example: diabetes data + model</p>
<pre class="r"><code>library(tidyverse)
library(broom)
library(&quot;mlbench&quot;)
theme_set(theme_classic())

# Load the data
data(&quot;PimaIndiansDiabetes2&quot;, package = &quot;mlbench&quot;)
PimaIndiansDiabetes2 &lt;- na.omit(PimaIndiansDiabetes2)
# Fit the logistic regression model
model &lt;- glm(diabetes ~., data = PimaIndiansDiabetes2, 
               family = binomial)
# Predict the probability (p) of diabete positivity
probabilities &lt;- predict(model, type = &quot;response&quot;)
predicted.classes &lt;- ifelse(probabilities &gt; 0.5, &quot;pos&quot;, &quot;neg&quot;)
head(predicted.classes)</code></pre>
<pre><code>##     4     5     7     9    14    15 
## &quot;neg&quot; &quot;pos&quot; &quot;neg&quot; &quot;pos&quot; &quot;pos&quot; &quot;pos&quot;</code></pre>
<p>example evans data + models</p>
<pre class="r"><code>vars &lt;- c(&quot;ID&quot;,&quot;CHD&quot;,&quot;CAT&quot;,&quot;AGE&quot;,&quot;CHL&quot;,&quot;SMK&quot;, &quot;ECG&quot;,&quot;DBP&quot;,&quot;SBP&quot;,&quot;HPT&quot;,&quot;CH&quot;,&quot;CC&quot;)

evans &lt;- read.table(&quot;/Users/annakawiecki/Documents/epi/workshops/akawiecki_pubs/pubs/DAG/notes\ screenshots/evans.dat.txt&quot;,header=F, col.names=vars)

#summary(evans)

main.model &lt;- glm(CHD ~ CAT+SMK+HPT,family=binomial,evans) 

full.model &lt;- glm(CHD ~ CAT*SMK*HPT,family=binomial,evans)

anova(main.model,full.model,test=&quot;Chisq&quot;)</code></pre>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: CHD ~ CAT + SMK + HPT
## Model 2: CHD ~ CAT * SMK * HPT
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)  
## 1       605     414.05                       
## 2       601     404.92  4   9.1367  0.05777 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<ul>
<li><strong>LINEARITY</strong></li>
</ul>
<p><a href="http://www.sthda.com/english/articles/36-classification-methods-essentials/148-logistic-regression-assumptions-and-diagnostics-in-r/" class="uri">http://www.sthda.com/english/articles/36-classification-methods-essentials/148-logistic-regression-assumptions-and-diagnostics-in-r/</a></p>
<p>Check the linear relationship between continuous predictor variables and the logit of the outcome. This can be done by visually inspecting the scatter plot between each predictor and the logit values.</p>
<p>example diabetes data:</p>
<pre class="r"><code># Select only numeric predictors
mydata &lt;- PimaIndiansDiabetes2 %&gt;%
  dplyr::select_if(is.numeric) 
predictors &lt;- colnames(mydata)
# Bind the logit and tidying the data for plot
mydata &lt;- mydata %&gt;%
  mutate(logit = log(probabilities/(1-probabilities))) %&gt;%
  gather(key = &quot;predictors&quot;, value = &quot;predictor.value&quot;, -logit)

ggplot(mydata, aes(logit, predictor.value))+
  geom_point(size = 0.5, alpha = 0.5) +
  geom_smooth(method = &quot;loess&quot;) + 
  theme_bw() + 
  facet_wrap(~predictors, scales = &quot;free_y&quot;)</code></pre>
<p><img src="index_files/figure-html/diabetes%20linearity-1.png" width="672" /> The smoothed scatter plots show that variables glucose, mass, pregnant, pressure and triceps are all quite linearly associated with the diabetes outcome in logit scale.</p>
<p>The variable age and pedigree is not linear and might need some transformations. If the scatter plot shows non-linearity, you need other methods to build the model such as including 2 or 3-power terms, fractional polynomials and spline function (Chapter <span class="citation">@ref</span>(polynomial-and-spline-regression)).</p>
<ul>
<li><strong>INFLUENTIAL VALUES</strong></li>
</ul>
<p><strong>RESIDUALS</strong></p>
<p>if <span class="math inline">\(y &gt; \hat{y}\)</span> observed value &gt; expected value <span class="math inline">\(\to\)</span> positive deviance residual</p>
<p>if <span class="math inline">\(y &lt; \hat{y}\)</span> observed value &lt; expected value <span class="math inline">\(\to\)</span> negative deviance residual</p>
<p>When y = 1, all the residuals are positive and when y = 0 they are all negative.</p>
<p><strong>r</strong></p>
<p><span class="math display">\[r=\frac{p-\hat{p}}{\sqrt{\hat{p}(1-p)/n}} \sim N(0,1) \: when\: n\to \infty\]</span></p>
<p><strong>response residual</strong></p>
<p><span class="math display">\[r_{re}= y- \hat{y}\]</span></p>
<p><strong>pearson’s residual</strong></p>
<p><span class="math display">\[r_{pe}=\frac{y-\hat{y}}{\sqrt{\hat{y}(1-y)/n}}\]</span></p>
<p><strong>partial residual</strong></p>
<p><strong>DFITTS</strong>: change in <span class="math inline">\(\hat{y_i}\)</span> when a point is removed. as many as observations</p>
<p><strong>DBETA</strong>: change in the coefficient of variable j (<span class="math inline">\(x_j\)</span>) when point i is removed. as many as coefficients.</p>
<ul>
<li><strong>Hosmer-Lemeshow test = HL test</strong></li>
</ul>
<p>Order the data by the predicted values and cut into classes of equal size, say 10.</p>
<p>Calculate observed and expected cases in each group. Use chisq test as usual from (O - E )^2/E This can be done using hoslem.test() from the ResourceSelection package in R.</p>
<p>This is very commonly used, but has low power, and interpretation in case of rejection can be diffcult.</p>
<p>example data: HL evans data</p>
<pre class="r"><code>library(&quot;ResourceSelection&quot;)
## ResourceSelection 0.3-4 2019-01-08
mod2.glm &lt;- glm(CHD~CAT+CHL+SMK+HPT,family=binomial,evans)


#mod2.glm$y = observed 

#fitted(mod2.glm) = expected 

#X-squared = 1.4748

hoslem.test(mod2.glm$y,fitted(mod2.glm))</code></pre>
<pre><code>## 
##  Hosmer and Lemeshow goodness of fit (GOF) test
## 
## data:  mod2.glm$y, fitted(mod2.glm)
## X-squared = 1.4748, df = 8, p-value = 0.9931</code></pre>
<pre class="r"><code>pchisq(1.4748, df=8, lower.tail = FALSE)</code></pre>
<pre><code>## [1] 0.9931185</code></pre>
<p>p-value = 0.9931. This p-value is very big.</p>
<p>Small p-values (usually under 5%) mean that your model is not a good fit. But large p-values mean that there isn’t enough evidence to say it’s a good fit.</p>
<ul>
<li><strong>plot dfitts vs. fitted values</strong></li>
</ul>
<pre class="r"><code>plot(dffits(mod2.glm))</code></pre>
<p><img src="index_files/figure-html/dfitts%20vs%20fit-1.png" width="672" /></p>
<pre class="r"><code>which(dffits(mod2.glm)&gt;0.3)</code></pre>
<pre><code>##  16  22  65 117 200 266 276 293 349 378 544 548 587 
##  16  22  65 117 200 266 276 293 349 378 544 548 587</code></pre>
<pre class="r"><code>plot(predict(mod2.glm), dffits(mod2.glm))</code></pre>
<p><img src="index_files/figure-html/dfitts%20vs%20fit-2.png" width="672" /></p>
<ul>
<li><strong>plot dfbetas vs. fitted values</strong> for each quantitative variable</li>
</ul>
<p><em>intercept</em></p>
<p>there are 6 points of high influence for the intercept. Omission will increase the intercept.</p>
<pre class="r"><code>plot(dfbeta(mod2.glm)[,1])</code></pre>
<p><img src="index_files/figure-html/dfbeta%20%20intercept-1.png" width="672" /></p>
<pre class="r"><code>evans[order(dfbeta(mod2.glm)[,1])[1:6],]</code></pre>
<pre><code>##        ID CHD CAT AGE CHL SMK ECG DBP SBP HPT CH  CC
## 117  2891   1   1  56 331   1   0 110 190   1  1 331
## 200  5131   1   1  52 306   1   0 108 178   1  1 306
## 378 12051   1   0  67 357   0   0  90 129   0  0   0
## 266  7051   1   1  67 319   0   0 104 182   1  1 319
## 576 18131   1   1  56 283   1   0 100 188   1  1 283
## 351 11361   1   1  76 279   1   0  96 136   1  1 279</code></pre>
<p><em>CAT</em></p>
<pre class="r"><code>plot(dfbeta(mod2.glm)[,2])</code></pre>
<p><img src="index_files/figure-html/dfbeta%20%20cat-1.png" width="672" /></p>
<pre class="r"><code>evans[order(dfbeta(mod2.glm)[,2])[1:6],]</code></pre>
<pre><code>##        ID CHD CAT AGE CHL SMK ECG DBP SBP HPT CH CC
## 196  5071   1   0  63 145   1   0  96 162   1  0  0
## 520 15851   1   0  72 174   1   1  78 192   1  0  0
## 290  9071   1   0  55 175   1   0 108 160   1  0  0
## 413 12911   1   0  66 180   1   1 104 162   1  0  0
## 331 10231   1   0  71 184   1   0  90 160   1  0  0
## 580 18171   1   0  43 189   1   0 106 154   1  0  0</code></pre>
<ul>
<li><strong>MULTICOLLINEARITY</strong></li>
</ul>
<p>Multicollinearity corresponds to a situation where the data contain highly correlated predictor variables.</p>
<p><strong>vif</strong></p>
<p>example diabetes</p>
<pre class="r"><code>car::vif(model)</code></pre>
<pre><code>## pregnant  glucose pressure  triceps  insulin     mass pedigree      age 
## 1.892387 1.378937 1.191287 1.638865 1.384038 1.832416 1.031715 1.974053</code></pre>
</div>
</div>
<div id="poisson-regression" class="section level2">
<h2>POISSON REGRESSION</h2>
<div id="outcome-2" class="section level3">
<h3>outcome</h3>
<p>count data (0,+∞). positive numbers.</p>
</div>
<div id="distribution-2" class="section level3">
<h3>distribution</h3>
<p>poisson <span class="math inline">\(y_i \to Poisson(\theta_i)\)</span></p>
<p>mean = variance = <span class="math inline">\(\theta\)</span></p>
<p><span class="math inline">\(\theta\)</span> is a rate</p>
<p>X: random variable: the number of occurrences of an event in an interval t</p>
<p>the interval t is subdivided into n subintervals of equal length 1/n. Each of these intervals is a Bernoulli trial where the event can occur or not (success or failure). Only one event can occur in a subinterval at a time, so the subiterval has to be sufficiently short. the subintervals are independent.</p>
<p><strong>pmf</strong> sequence of Bernoulli trials with <span class="math inline">\(p=\theta/n\)</span></p>
<p><span class="math display">\[P(X=x|\theta)= \frac{e^{-\theta}\theta^x}{x!}, x (0 \to \infty)\]</span></p>
<p><strong>Differences between the binomial and Poisson models</strong>:</p>
<p>The Poisson model is similar to the binomial model for count data but is applied in slightly different situations:</p>
<p>• If each data point yi can be interpreted as the number of “successes” out of ni trials, then it is standard to use the binomial/logistic model or its overdispersed generalization.</p>
<p>• If each data point yi does not have a natural limit—it is not based on a number of independent trials—then it is standard to use the Poisson/logarithmic regression model (as described here) or its overdispersed generalization.</p>
<p>Poisson approximates the binomial when n is large or p is small.</p>
<p><span class="math display">\[p=\theta/n \to \theta = pn\]</span></p>
<p><span class="math display">\[f(x)= \begin{pmatrix} n\\x \end{pmatrix} p^x (1-p)^{n-x} = \begin{pmatrix} n\\x \end{pmatrix} (\frac{\theta}{n})^x (1-\frac{\theta}{n})^{n-x} \to \theta = pn \to \frac{e^{-pn}pn^x}{x!} \approx \begin{pmatrix} n\\x \end{pmatrix} p^x (1-p)^{n-x}\]</span></p>
</div>
<div id="model-2" class="section level3">
<h3>model</h3>
<p><span class="math inline">\(\theta_i=e^{\beta_0 +\beta_ix_i}\)</span></p>
<p>In the general Poisson regression model, we think of yi as the number of cases in a process with rate <span class="math inline">\(\theta_i\)</span> and exposure <span class="math inline">\(u_i\)</span>.</p>
<p><span class="math inline">\(y_i \to Poisson(\theta_i, u_i)\)</span></p>
</div>
<div id="link-2" class="section level3">
<h3>link</h3>
<p><strong>LOG LINK</strong></p>
<p>This link function maps a parameter that is defined over only positive real values onto a linear model. What the log link effectively assumes is that the parameter’s value is the exponentiation of the linear model. <span class="math inline">\(log(\theta_i)= \beta_0 +\beta_ix_i\)</span></p>
<p><strong>inverse link</strong>: exponentiate to solve for <span class="math inline">\(\theta_i\)</span>: <span class="math inline">\(\theta_i=e^{\beta_0 +\beta_ix_i}\)</span></p>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_hline).</code></pre>
<pre><code>## Warning: Removed 6 row(s) containing missing values (geom_path).</code></pre>
<p><img src="index_files/figure-html/log%20link-1.png" width="672" /></p>
<p>Using a log link for a linear model (left) implies an exponential scaling of the outcome with the predictor variable (right). Another way to think of this relationship is to remember that logarithms are magnitudes. An increase of one unit on the log scale means an increase of an order of magnitude on the untransformed scale. And this fact is reflected in the widening intervals between the horizontal lines in the right-hand plot. While using a log link does solve the problem of constraining the parameter to be positive, it may also create a problem when the model is asked to predict well outside the range of data used to fit it. Exponential relationships grow, well, exponentially. Just like a linear model cannot be linear forever, an exponential model cannot be exponential forever. Human height cannot be linearly related to weight forever, because very heavy people stop getting taller and start getting wider. Likewise, the property damage caused by a hurricane may be approximately exponentially related to wind speed for smaller storms. But for very big storms, damage may be capped by the fact that everything gets destroyed.</p>
</div>
<div id="assumptions-2" class="section level3">
<h3>assumptions</h3>
<ul>
<li>linearity: <span class="math inline">\(log(\theta)\)</span> is a linear function of the predictors</li>
<li>independence: the different observations are statistically independent</li>
<li>variance function: mean = variance = <span class="math inline">\(\theta\)</span></li>
</ul>
</div>
<div id="parameter-estimation-2" class="section level3">
<h3>parameter estimation</h3>
<p>MLE = <span class="math inline">\(\hat{\theta}= y\)</span></p>
</div>
<div id="interpretation-of-coefficients-2" class="section level3">
<h3>interpretation of coefficients</h3>
<p>The coefficients <span class="math inline">\(\beta\)</span> can be exponentiated and treated as multiplicative effects.</p>
<p>The regression coefficients summarize the associations between the predictors and <span class="math inline">\(\theta\)</span></p>
<p>EXAMPLE <span class="math inline">\(y_i \to Poisson(e^{2.8+ 0.012X_{i1} - 0.20X_{i2}})\)</span></p>
<p>Traffic accident model of the rate of traffic accidents per vehicle = <span class="math inline">\(\theta\)</span> :Xi1 is average speed (in miles per hour, or mph) on the nearby streets and Xi2 = 1 if the intersection has a traffic signal or 0 otherwise</p>
<p><span class="math inline">\(\beta_0\)</span> The constant term gives the intercept of the regression, that is, the prediction if Xi1 = 0 and Xi2 = 0. Since this is not possible (no street will have an average speed of 0), we will not try to interpret the constant term.</p>
<p><span class="math inline">\(\beta_1\)</span> The coefficient of Xi1 is the expected difference in y (on the logarithmic scale) for each additional mph of traffic speed. Thus, the expected multiplicative increase is <span class="math inline">\(e^{0.012} = 1.012\)</span>, or a 1.2% positive difference in the rate of traffic accidents per mph. Since traffic speeds vary by tens of mph, it would actually make sense to define Xi1 as speed in tens of mph, in which case its coefficient would be 0.12, corresponding to a 12% increase (more precisely, e0.12 = 1.127: a 12.7% increase) in accident rate per ten mph.</p>
<p><span class="math inline">\(\beta_2\)</span> The coefficient of Xi2 tells us that the predictive difference of having a traffic signal can be found be multiplying the accident rate by <span class="math inline">\(e^{0.20} = 0.82\)</span> yielding a reduction of 18% (1-0.82= 18).</p>
<p>As with regression models in general, each coefficient is interpreted as a comparison in which one predictor differs by one unit while all the other predictors remain at the same level,</p>
<p><strong>offset</strong> In most applications of Poisson regression, the counts can be interpreted relative to some baseline or “exposure,” for example, the number of vehicles that travel through the intersection. <span class="math inline">\(y_i \to Poisson(\theta_i, u_i)\)</span> .Putting the logarithm of the exposure into the model as an offset is equivalent to including it as a regression predictor, but with its coefficient fixed to the value 1. In this way the rate is proportional to the exposure.</p>
<p><span class="math inline">\(y_i \to Poisson(\theta_i, u_i)\)</span></p>
<p><span class="math inline">\(log(\theta_i)= \beta_0 +\beta_ix_i + log(u_i)\)</span></p>
<p><span class="math inline">\(\theta_i=e^{\beta_0 +\beta_ix_i + log(u_i)} = e^{\beta_0 +\beta_ix_i}e^{log(u_i)}= e^{\beta_0 +\beta_ix_i}u_i\)</span></p>
</div>
<div id="model-diagnostics-1" class="section level3">
<h3>model diagnostics</h3>
<p>example warpbreaks</p>
<pre class="r"><code>library(&quot;datasets&quot;)

data &lt;- warpbreaks

hist(data$breaks)</code></pre>
<p><img src="index_files/figure-html/poisson%20example%20data-1.png" width="672" /></p>
<pre class="r"><code>poisson.model &lt;- glm(breaks ~ wool + tension, data, family = poisson(link = &quot;log&quot;))

summary(poisson.model)</code></pre>
<pre><code>## 
## Call:
## glm(formula = breaks ~ wool + tension, family = poisson(link = &quot;log&quot;), 
##     data = data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -3.6871  -1.6503  -0.4269   1.1902   4.2616  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  3.69196    0.04541  81.302  &lt; 2e-16 ***
## woolB       -0.20599    0.05157  -3.994 6.49e-05 ***
## tensionM    -0.32132    0.06027  -5.332 9.73e-08 ***
## tensionH    -0.51849    0.06396  -8.107 5.21e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 297.37  on 53  degrees of freedom
## Residual deviance: 210.39  on 50  degrees of freedom
## AIC: 493.06
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>example eba (lung cancer incidence in Danish cities)</p>
<pre class="r"><code>library(ISwR) 
data(eba1977)
eba.glm &lt;- glm(cases ~ city+age+offset(log(pop)),family=poisson,data=eba1977)
summary(eba.glm)</code></pre>
<pre><code>## 
## Call:
## glm(formula = cases ~ city + age + offset(log(pop)), family = poisson, 
##     data = eba1977)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.63573  -0.67296  -0.03436   0.37258   1.85267  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -5.6321     0.2003 -28.125  &lt; 2e-16 ***
## cityHorsens  -0.3301     0.1815  -1.818   0.0690 .  
## cityKolding  -0.3715     0.1878  -1.978   0.0479 *  
## cityVejle    -0.2723     0.1879  -1.450   0.1472    
## age55-59      1.1010     0.2483   4.434 9.23e-06 ***
## age60-64      1.5186     0.2316   6.556 5.53e-11 ***
## age65-69      1.7677     0.2294   7.704 1.31e-14 ***
## age70-74      1.8569     0.2353   7.891 3.00e-15 ***
## age75+        1.4197     0.2503   5.672 1.41e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 129.908  on 23  degrees of freedom
## Residual deviance:  23.447  on 15  degrees of freedom
## AIC: 137.84
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<ul>
<li><strong>LINEARITY</strong></li>
</ul>
<p><a href="http://www.sthda.com/english/articles/36-classification-methods-essentials/148-logistic-regression-assumptions-and-diagnostics-in-r/" class="uri">http://www.sthda.com/english/articles/36-classification-methods-essentials/148-logistic-regression-assumptions-and-diagnostics-in-r/</a></p>
<p>Check the linear relationship between continuous predictor variables and the logit of the outcome. This can be done by visually inspecting the scatter plot between each predictor and the logit values.</p>
<ul>
<li><strong>plot residuals</strong></li>
</ul>
<pre class="r"><code>plot(fitted(eba.glm),residuals(eba.glm,type=&quot;response&quot;),ylim=c(-7,7)) 
lines(fitted(eba.glm),2*sqrt(fitted(eba.glm))) 
lines(fitted(eba.glm),-2*sqrt(fitted(eba.glm)))</code></pre>
<p><img src="index_files/figure-html/poisson%20res%20plot-1.png" width="672" /></p>
<ul>
<li><strong>INFLUENTIAL VALUES</strong></li>
</ul>
<p><a href="https://online.stat.psu.edu/stat462/node/209/" class="uri">https://online.stat.psu.edu/stat462/node/209/</a></p>
<p><strong>RESIDUALS</strong></p>
<p><strong>raw residual</strong></p>
<p><span class="math display">\[r_{re}= y- \hat{y}\]</span></p>
<p><strong>pearson’s residual</strong></p>
<p><span class="math display">\[r_{pe}=\frac{y-\hat{y}}{\sqrt{\hat{y}\hat{\phi}}}\]</span></p>
<p>where <span class="math inline">\(\hat{\phi}\)</span></p>
<p><span class="math display">\[\hat{\phi}=\frac{1}{n-p}\sum_{i=1}^n\frac{(y-\hat{y})^2}{\hat{y}}\]</span></p>
<p><strong>deviance residuals</strong></p>
<p><strong>DFITTS</strong>: change in <span class="math inline">\(\hat{y_i}\)</span> when a point is removed. as many as observations</p>
<p><strong>DBETA</strong>: change in the coefficient of variable j (<span class="math inline">\(x_j\)</span>) when point i is removed. as many as coefficients.</p>
<ul>
<li><strong>plot dfitts vs. fitted values</strong></li>
</ul>
<p><span class="math inline">\(y_i- \hat{y_i}\)</span> &gt; 0 when y= 1 (cases)</p>
<p><span class="math inline">\(y_i- \hat{y_i}\)</span> &lt; 0 when y= 0 (controls)</p>
<p>outliers are values that make the estimate change most when they are removed. Example dfitts &gt; 0.3 causes a &gt;0.3 change in the etimated probablity.</p>
<pre class="r"><code>plot(dffits(eba.glm))</code></pre>
<p><img src="index_files/figure-html/dfitts%20vs%20fit%20eba%20poisson-1.png" width="672" /></p>
<pre class="r"><code>which(dffits(eba.glm)&lt; -0.2)</code></pre>
<pre><code>##  3  4  6 11 13 14 20 22 
##  3  4  6 11 13 14 20 22</code></pre>
<pre class="r"><code>eba1977[22,]</code></pre>
<pre><code>##       city age pop cases
## 22 Horsens 75+ 782     2</code></pre>
<pre class="r"><code>plot(predict(eba.glm), dffits(eba.glm))</code></pre>
<p><img src="index_files/figure-html/dfitts%20vs%20fit%20eba%20poisson-2.png" width="672" /></p>
<ul>
<li><strong>TEST GOODNESS OF FIT</strong></li>
</ul>
<p>the residual deviance should be in the neighborhood of the df of the residual deviance. ︎ 23.447 on 15 df ︎ Under the null hypothesis that the model fits, and if the smallest fitted value is &gt; 5, then the null distribution is approximately chi‐squared</p>
<pre class="r"><code>min(fitted(eba.glm))</code></pre>
<pre><code>## [1] 6.731286</code></pre>
<pre class="r"><code>pchisq(deviance(eba.glm),
df.residual(eba.glm),lower=F) </code></pre>
<pre><code>## [1] 0.07509017</code></pre>
<pre class="r"><code>drop1(eba.glm,test=&quot;Chisq&quot;)</code></pre>
<pre><code>## Single term deletions
## 
## Model:
## cases ~ city + age + offset(log(pop))
##        Df Deviance    AIC     LRT Pr(&gt;Chi)    
## &lt;none&gt;      23.447 137.84                     
## city    3   28.307 136.69   4.859   0.1824    
## age     5  126.515 230.90 103.068   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<ul>
<li><strong>TEST OVERDISPERSION</strong></li>
</ul>
<p>Under the Poisson distribution the variance equals the mean—that is, the standard deviation equals the square root of the mean.</p>
<p>standardized residuals: <span class="math inline">\(z_i= y_i-\hat{y_i}/sd(\hat{y_i})= y_i-u_i\hat{\theta_i} /sd(u_i\hat{\theta_i})\)</span></p>
<p>If the Poisson model is true, then the zi’s should be approximately independent, each with mean 0 and standard deviation 1. If there is overdispersion, however, we would expect the zi’s to be larger, in absolute value, reflecting the extra variation beyond what is predicted under the Poisson model.</p>
<p><strong>overdispersion test</strong>: compute the sums of squares of the standardized residuals <span class="math inline">\(\sum_{i=1}^n z_i^2\)</span> and compare to the Chi-square distribution with degrees of freedom n-k (using n-k rather than n degrees of freedom to account for the estimation of k regression coefficients)</p>
<p>estimated overdispersion: <span class="math inline">\(1/(n-k) \sum_{i=1}^n z_i^2\)</span></p>
<p>EXAMPLE: the classical Poisson regression for the police stops has n = 225 data points and k = 77 linear predictors. <span class="math inline">\(\sum_{i=1}^n z_i^2\)</span> = 2700 <span class="math inline">\((n-k)\)</span> = 148</p>
<p>The estimated overdispersion factor is 2700/148 = 18.2, and the p-value is 1. indicating that the probability is essentially zero that a random variable from a +2148 distribution would be as large as 2700. In summary, the police stops data are overdispersed by a factor of 18, which is huge—even an overdispersion factor of 2 would be considered large—and also statistically significant.</p>
<p><strong>adjust for overdispersion</strong>:</p>
<ul>
<li><p>multiply all regression standard errors by the sqrt(overdispersion factor) EXAMPLE: <span class="math inline">\(\sqrt{18.2}= 4.3\)</span></p></li>
<li><p>fit overdispersed model: quasipoisson or negative binomial</p></li>
</ul>
<p>example warpbreaks</p>
<pre class="r"><code>mean(data$breaks)</code></pre>
<pre><code>## [1] 28.14815</code></pre>
<pre class="r"><code>var(data$breaks)</code></pre>
<pre><code>## [1] 174.2041</code></pre>
<p>The variance is much greater than the mean, which suggests that we will have over-dispersion in the model.</p>
<p>If the Residual Deviance is greater than the degrees of freedom, then over-dispersion exists. This means that the estimates are correct, but the standard errors (standard deviation) are wrong and unaccounted for by the model.</p>
</div>
</div>
<div id="negative-binomial" class="section level2">
<h2>NEGATIVE BINOMIAL</h2>
<div id="outcome-3" class="section level3">
<h3>outcome</h3>
<p>overdispersed count data (0,+∞). positive numbers.</p>
<p>any count-data model for which the variance of the data is <span class="math inline">\(\omega\)</span> times the mean, reducing to the Poisson if <span class="math inline">\(\omega\)</span> = 1.</p>
</div>
<div id="distribution-3" class="section level3">
<h3>distribution</h3>
<p>negative binomial <span class="math inline">\(y_i \to negative binomial (\theta_i, \omega)\)</span></p>
<p>mean = <span class="math inline">\(u_i\theta= u_ie^{\beta X_i}\)</span> = a/b</p>
<p>overdispersion= <span class="math inline">\(\omega\)</span> = 1 + 1/b</p>
<p>the negative-binomial distribution is conventionally expressed not based on its mean and overdispersion but rather in terms of parameters a and b where the mean of the distribution is a/b and the overdispersion is 1 + 1/b. One must check the parameterization when fitting such models, and it can be helpful to double-check by simulating datasets from the fitted model and checking that they look like the actual data</p>
</div>
<div id="link-3" class="section level3">
<h3>link</h3>
<p><strong>LOG LINK</strong></p>
</div>
</div>
<div id="multilevel-models" class="section level2">
<h2><strong>MULTILEVEL MODELS</strong></h2>
</div>
<div id="pooling" class="section level2">
<h2>pooling</h2>
<p>EXAMPLE: estimating the distribution of radon levels of the houses within each of the 85 counties in Minnesota</p>
<div id="no-predictors" class="section level3">
<h3>no predictors</h3>
<ul>
<li><p><strong>complete pooling</strong> <span class="math inline">\(\bar{y}_{all}\)</span>: Average that completely pools data across all counties. This ignores variation between counties in radon levels.</p></li>
<li><p><strong>no pooling</strong> <span class="math inline">\(\bar{y}_{j}\)</span>: Average of the observations in each county. No-pooling analysis overfits the data within each county.</p></li>
<li><p><strong>partial pooling</strong> Average log radon level <span class="math inline">\(\alpha_j\)</span> among all the houses in county j, for which all we have available are a random sample of size <span class="math inline">\(n_j\)</span>. It’s like a weighted average of <span class="math inline">\(\bar{y}_{j}\)</span> and <span class="math inline">\(\bar{y}_{all}\)</span> which reflects the relative amount of information available about the individual county, on one hand, and the average of all the counties, on the other.</p></li>
<li><p>if <span class="math inline">\(n_j = 0\)</span> then <span class="math inline">\(\alpha_j = \bar{y}_{all}\)</span></p></li>
<li><p>if <span class="math inline">\(n_j \to \infty\)</span> then <span class="math inline">\(\alpha_j = \bar{y}_{j}\)</span></p></li>
</ul>
</div>
<div id="with-predictors" class="section level3">
<h3>with predictors</h3>
<p>EXAMPLE: logarithm of the home radon measurement versus floor of measurement3 for houses sampled from eight of the 85 counties in Minnesota.</p>
<ul>
<li><strong>complete pooling</strong></li>
</ul>
<p>Classical regression completely ignoring the group information, a single model fit to all the data.</p>
<p><span class="math inline">\(y_i= \alpha +\beta x_i + \epsilon_i\)</span> or y ~ x</p>
<p><span class="math inline">\(\alpha_{j}\)</span> is fixed at the average for the whole data set <span class="math inline">\(\alpha\)</span></p>
<p>This analysis ignores any variation in average radon levels between counties.</p>
<ul>
<li><strong>no pooling</strong></li>
</ul>
<p>Can refer to</p>
<ul>
<li><p>Separate models: a separate classical regression in each group: <span class="math inline">\(y_j= \alpha_{j} +\beta x_i + \epsilon_i\)</span></p></li>
<li><p>No-pooling model: a single classical regression that includes group indicators (but no group-level predictors) but with no model for the group coeðcients: <span class="math inline">\(y_i= \alpha_{j[i]} +\beta x_i + \epsilon_i\)</span> where j[i] is the county correspoinding to house i.</p></li>
</ul>
<p><span class="math inline">\(y_i= \alpha_{j[i]} +\beta x_i + \epsilon_i\)</span> is expressed in lmer as y ~ x + factor(county) - 1)</p>
<p>where we add -1 to the regression formula to remove the constant term, so that all 85 counties are included.</p>
<p>This version of “no pooling” does not pool the estimates for the intercepts <span class="math inline">\(\alpha_{j}\)</span> but it does completely pool estimates for any slope coefficients (they are forced to have the same value across all groups) and also assumes the residual variance is the same within each group.</p>
<p><span class="math inline">\(\alpha_{j}\)</span> is set to the classical least squares estimates, which correspond to the fitted intercepts in a model run separately in each county. The constraint is that the slope coeffcient equals <span class="math inline">\(\beta\)</span> in all models.</p>
<p>This analysis is very dependent on the number of observations per county.</p>
<ul>
<li><strong>partial pooling</strong> <span class="math inline">\(y_i \sim N(\alpha_{j[i]} +\beta x_i, \sigma_y^2)\)</span></li>
</ul>
<p><span class="math inline">\(\alpha_{j} \sim N(\mu_{\alpha}, \sigma_{\alpha}^2)\)</span></p>
<p><span class="math inline">\(\alpha_{j}\)</span> has a “soft-constraint” in the form of a probability distribution, that has the effect of pulling the estimates of <span class="math inline">\(\alpha_{j}\)</span> toward the mean level <span class="math inline">\(\mu_{\alpha}\)</span></p>
<ul>
<li><p>if <span class="math inline">\(\sigma_{\alpha} \to 0\)</span> then the soft-constraints pull the estimate to 0 <span class="math inline">\(\alpha_j = \alpha\)</span> = complete-pooling estimate.</p></li>
<li><p>if <span class="math inline">\(\sigma_{\alpha} \to \infty\)</span> then soft constraints do nothing <span class="math inline">\(\alpha_j = \alpha_j\)</span> = no pooling estimate.</p></li>
</ul>
<p>There is strong pooling in counties with small sample sizes, and only weak pooling in counties containing many measurements.</p>
</div>
</div>
<div id="when-to-use-multilevel-models" class="section level2">
<h2>when to use multilevel models</h2>
<p>Multilevel model is most important when it is close to complete pooling, when <span class="math inline">\(\sigma_{\alpha}\)</span> is small and the groups are similar to each other. When <span class="math inline">\(\sigma_{\alpha}\)</span> is large, so that groups vary greatly, multilevel modeling is not much better than simple no-pooling estimation.However the multilevel estimate can be close to complete pooling for groups with small sample size and close to no pooling for groups with large sample size, automatically performing well for both sorts of group.</p>
<div id="motivations-for-multilevel-modeling" class="section level3">
<h3>motivations for multilevel modeling</h3>
<p>From <span class="citation">@GelmanHill2005</span></p>
<p>There are various reasons why it might be worth moving to a multilevel model, whether for purposes of causal inference, the study of variation, or prediction of future outcomes:</p>
<p>• Accounting for individual- and group-level variation in estimating group-level regression coefficients. For example, in the child support study in Section 11.2, interest lies in a city-level predictor (child support enforcement), and in classical regression it is not possible to include city indicators along with city-level predictors.</p>
<p>• Modeling variation among individual-level regression coefficients. In classical regression, one can do this using indicator variables, but multilevel modeling is convenient when we want to model the variation of these coefficients across groups, make predictions for new groups, or account for group-level variation in the uncertainty for individual-level coefficients.</p>
<p>• Estimating regression coefficients for particular groups. For example, in the next chapter, we discuss the problem of estimating radon levels from measurements in several counties in Minnesota. With a multilevel model, we can get reasonable estimates even for counties with small sample sizes, which would be difficult using classical regression.</p>
<p>One or more of these reasons might apply in any particular study.</p>
</div>
<div id="multilevel-modelling-assumptions" class="section level3">
<h3>multilevel modelling assumptions</h3>
<p>From <span class="citation">@GelmanHill2005</span></p>
<p>A multilevel model requires additional assumptions beyond those of classical regression—basically, each level of the model corresponds to its own regression with its own set of assumptions such as additivity, linearity, independence, equal variance, and normality.</p>
<p>We usually don’t mind. First, it can be possible to check these assumptions. Perhaps more important, classical regressions can typically be identified with particular special cases of multilevel models with hierarchical variance parameters set to zero or infinity—these are the complete pooling and no pooling models. Our ultimate justification, which can be seen through examples, is that the assumptions pay off in practice in allowing more realistic models and inferences.</p>
</div>
<div id="how-many-groups" class="section level3">
<h3>how many groups?</h3>
<p>When the number of groups is small, it is difficult to estimate the between-group variation and, as a result, multilevel modeling often adds little in such situations, beyond classical no-pooling models. When <span class="math inline">\(\sigma_{\alpha}\)</span> cannot be estimated well, it tends to be overestimated, and so the partially pooled estimates are close to no pooling. For 1-2 groups multilevel modeling reduces to classical regression</p>
</div>
</div>
<div id="time-series" class="section level2">
<h2><strong>TIME SERIES</strong></h2>
<p>From <a href="https://otexts.com/fpp2/" class="uri">https://otexts.com/fpp2/</a></p>
<div id="patterns" class="section level3">
<h3>patterns</h3>
<p><strong>Trend</strong> A trend exists when there is a long-term increase or decrease in the data. It does not have to be linear. Sometimes we will refer to a trend as “changing direction,” when it might go from an increasing trend to a decreasing trend.</p>
<p><strong>Seasonal</strong> A seasonal pattern occurs when a time series is affected by seasonal factors such as the time of the year or the day of the week. Seasonality is always of a <em>fixed and known frequency</em>. The monthly sales of antidiabetic drugs above shows seasonality which is induced partly by the change in the cost of the drugs at the end of the calendar year.</p>
<p><img src="index_files/figure-html/seasonal%20plot-1.png" width="672" /></p>
<p><strong>Cyclic</strong><em> A cycle occurs when the data exhibit rises and falls that are </em>not of a fixed frequency*. These fluctuations are usually due to economic conditions, and are often related to the “business cycle.” The duration of these fluctuations is usually at least 2 years.</p>
</div>
</div>
<div id="model-comparison" class="section level2">
<h2><strong>MODEL COMPARISON</strong></h2>
<p>From <span class="citation">@mcelreath2020</span> and <a href="https://online.stat.psu.edu/stat462/node/95/" class="uri">https://online.stat.psu.edu/stat462/node/95/</a></p>
<p>Sometimes we don’t care about causal inference. Maybe we just want to make good predictions. That we don’t understand what is going on is irrelevant. So is just adding everything to the model okay?</p>
<p>The answer is “no.” There are two related problems with just adding variables.</p>
<ol style="list-style-type: decimal">
<li><p>Adding parameters—making the model more complex—nearly always improves the fit of a model to the data.</p></li>
<li><p>While more complex models fit the data better, they often predict new data worse.</p></li>
</ol>
<p>Models that have many parameters tend to <strong>overfit</strong> more than simpler models. This means that a complex model will be very sensitive to the exact sample used to fit it, leading to potentially large mistakes when future data is not exactly like the past data.</p>
<p>But simple models, with too few parameters, tend instead to <strong>underfit</strong>, systematically over-predicting or under-predicting the data, regardless of how well future data resemble past data. So we can’t always favor either simple models or complex models.</p>
<div id="coefficient-of-determination-r-squared-r2" class="section level3">
<h3>coefficient of determination = r-squared = R2</h3>
<p>Often described as “variance explained,” it’s the proportion of the variance in the dependent variable that is predictable from the independent variable(s). R2 is defined as:</p>
<p><span class="math display">\[R^2 = \frac{var(outcome)-var(residuals)}{var(outcome)}= 1- \frac{var(residuals)}{var(outcome)}\]</span></p>
<p>or</p>
<p><span class="math display">\[R^2 = \frac{SSR}{SSTO}= 1- \frac{SSE}{SSTO}= \frac{\sum(\hat{y_i}- \bar{y})^2}{\sum(y_i- \bar{y})^2}= 1- \frac{\sum(y_i- \hat{y_i})^2}{\sum(y_i- \bar{y})^2}\]</span> where</p>
<p>regression sum of squares: <span class="math inline">\(SSR = \sum(\hat{y_i}- \bar{y})^2\)</span> = how far the estimated sloped regression line, is from the horizontal “no relationship line,” or sample mean</p>
<p>error sum of squares: <span class="math inline">\(SSE = \sum(y_i- \hat{y_i})^2\)</span> = how much the observations vary around estimated the estimated regression line</p>
<p>total sum of squares: <span class="math inline">\(SSTO = SSR + SSE =\sum(y_i- \bar{y})^2\)</span> = how much the observations vary around the horizontal “no relationship line,” the sample mean</p>
<p>Interpretation: “r2 ×100 percent of the variation in y is reduced by taking into account predictor x”</p>
<p>Like other measures of fit to sample, R2 increases as more predictor variables are added. This is true even when the variables you add to a model are just random numbers, with no relation to the outcome. So it’s no good to choose among models using only fit to the data.</p>
</div>
<div id="information-theory" class="section level3">
<h3>INFORMATION THEORY</h3>
<p>From <span class="citation">@mcelreath2020</span></p>
<p><strong>information</strong>: “The reduction in uncertainty when we learn an outcome.”</p>
<p><strong>information entropy</strong>: If there are n different possible events and each event i has probability pi, and we call the list of probabilities p, then the unique measure of uncertainty we seek is:</p>
<p><span class="math display">\[H(p) = -E log(p_i) = -\sum_{i=1}^n p_i log(p_i)\]</span></p>
<p>The uncertainty contained in a probability distribution is the average log-probability of an event. The lower this measure the less uncertainty.</p>
<p><strong>divergence</strong>: : The additional uncertainty induced by using probabilities from one distribution to describe another distribution:</p>
<p><span class="math display">\[D_{KL} (p,q) = \sum_{i} p_i (log(p_i)-log(q_i)) = \sum_{i} p_i log(p_i/q_i)\]</span></p>
<p>The divergence is the average difference in log probability between the target (p) and model (q). This divergence is just the difference between two entropies: The entropy of the target distribution p and the cross entropy arising from using q to predict p. When p = q, we know the actual probabilities of the events and <span class="math inline">\(D_{KL} = 0\)</span>. As q grows more different from p, the divergence also grows.</p>
<p>What divergence can do for us now is help us contrast different approximations to p. As an approximating function q becomes more accurate, DKL(p, q) will shrink. So if we have a pair of candidate distributions, then the candidate that minimizes the divergence will be closest to the target. Since predictive models specify probabilities of events (observations), we can use divergence to compare the accuracy of models.</p>
<p>To use DKL to compare models, it seems like we would have to know p, the target probability distribution. In all of the examples so far, I’ve just assumed that p is known. But when we want to find a model q that is the best approximation to p, the “truth,” there is usually no way to access p directly. We wouldn’t be doing statistical inference, if we already knew p. Good thing is, we are only interested in comparing the divergences of different candidates, say q and r. In that case, most of p just subtracts out, because there is a E log(pi) term in the divergence of both q and r. This term has no effect on the distance of q and r from one another. So while we don’t know where p is, we can estimate how far apart q and r are, and which is closer to the truth. It’s as if we can’t tell how far any particular archer is from hitting the target, but we can tell which archer gets closer and by how much.</p>
<p>All of this also means that all we need to know is a model’s average log-probability: E log(qi) for q and E log(ri) for r. This also means that the absolute magnitude of these values will not be interpretable—neither E log(qi) nor E log(ri) by itself suggests a good or bad model. Only the difference E log(qi)−E log(ri) informs us about the divergence of each model from the target p.</p>
<p>A total score for a model q= it is a log-probability score, and it is the gold standard way to compare the predictive accuracy of different models. It is an estimate of E log(qi), just without the final step of dividing by the number of observations:</p>
<p><span class="math display">\[S(q) = \sum_{i} log(q_i))\]</span></p>
<p><strong>log-pointwise-predictive-density</strong>: “Bayesian deviance”. To compute this score for a Bayesian model, we have to use the entire posterior distribution. How can we use the entire distribution of predictions? We need to find the log of the average probability for each observation i, where the average is taken over the posterior distribution. Each of these values is the log-probability score for a specific observation. If you sum these values, you’ll have the total log-probability score for the model and data. What do these values mean? Larger values are better, because that indicates larger average accuracy. It also quite common to see something called the deviance, which is like a lppd score, but multiplied by −2 so that smaller values are better.</p>
<p><strong>deviance</strong>:</p>
<p>-2 * the total log-probability score for the model and data.</p>
<p><span class="math display">\[-2\sum_{i}log(q_i)\]</span> While deviance on training data always improves with additional predictor variables, deviance on future data may or may not, depending upon both the true data-generating process and how much data is available to precisely estimate the parameters. These facts form the basis for understanding both regularizing priors and information criteria.</p>
<p>From <span class="citation">@GelmanHill2005</span></p>
<p>In classical generalized linear models, adding a parameter to a model is expected to increase the fit—even if the new parameter represents pure noise. Adding a noise predictor is expected to reduce the deviance by 1, and adding k predictors that are pure noise is expected to reduce the deviance by k. More precisely, adding k noise predictors will reduce the deviance by an amount corresponding to a <span class="math inline">\(\chi^2_k\)</span> distribution with k degrees of freedom.</p>
<p>Thus, if k predictors are added and the deviance declines by significantly more than k, then we can conclude that the observed improvement in predictive power is statistically significant. Thus,</p>
<p>adjusted deviance = deviance + number of predictors. (Eq 24.7)</p>
<p>can be used as an adjusted measure that approximately accounts for the increase in fit attained simply by adding predictors to a model. (The analogy in simple linear regression is the adjusted R2.)</p>
<p>The next step, beyond checking whether an improvement in deviance is statistically significant, is to see if it is estimated to increase out-of-sample predictive power.</p>
<p><strong>TRAINING SAMPLE</strong></p>
<p>The log-probability score is a principled way to measure distance from the target. But the score as computed in the previous section has the same flaw as R2: It always improves as the model gets more complex, at least for the types of models we have considered so far. Just like R2, log-probability on training data is a measure of retrodictive accuracy, not predictive accuracy. We simply cannot score models by their performance on training data. That way lies the monster Scylla, devourer of naive data scientists.</p>
<p>It is really the score on new data that interests us. So before looking at tools for improving and measuring out-of-sample score, let’s bring the problem into sharper focus by simulating the score both in and out of sample. When we usually have data and use it to fit a statistical model, the data comprise a training sample. Parameters are estimated from it, and then we can imagine using those estimates to predict outcomes in a new sample, called the test sample. R is going to do all of this for you. But here’s the full procedure, in outline:</p>
<ol style="list-style-type: decimal">
<li>Suppose there’s a training sample of size N.</li>
<li>Compute the posterior distribution of a model for the training sample, and compute the score on the training sample. Call this score Dtrain.</li>
<li>Suppose another sample of size N from the same process. This is the test sample.</li>
<li>Compute the score on the test sample, using the posterior trained on the training sample. Call this new score Dtest.</li>
</ol>
</div>
<div id="predicting-predictive-accuracy" class="section level3">
<h3>PREDICTING PREDICTIVE ACCURACY</h3>
</div>
<div id="cross-validation" class="section level3">
<h3>cross-validation</h3>
<p>test the model’s predictive accuracy on another sample.</p>
<p>This is done leaving out a small chunk of observations from our sample and evaluating the model on the observations that were left out. Of course we don’t want to leave out data. So what is usually done is to divide the sample in a number of chunks, called “folds.” The model is asked to predict each fold, after training on all the others. We then average over the score for each fold to get an estimate of out-of-sample accuracy. The minimum number of folds is 2. At the other extreme, you could make each point observation a fold and fit as many models as you have individual observations.</p>
<ul>
<li><strong>leave-one-out cross-validation = LOOCV</strong> : use the maximum number of folds, resulting in leaving out one unique observation in each fold.</li>
</ul>
<p>The key trouble with leave-one-out cross-validation is that, if we have 1000 observations, that means computing 1000 posterior distributions. Luckily, there are clever ways to approximate the cross-validation score without actually running the model over and over again. One approach is to use the “importance” of each observation to the posterior distribution. What “importance” means here is that some observations have a larger impact on the posterior distribution—if we remove an important observation, the posterior changes more. Other observations have less impact. An observation that is relatively unlikely is more important than one that is relatively expected. When your expectations are violated, you should change your expectation more. Bayesian inference works the same way. This importance is often called a <em>weight</em>, and these weights can be used to estimate a model’s out-of-sample accuracy.</p>
<ul>
<li><strong>pareto-smoothed importance sampling cross-validation = PSIS</strong>: approximation of the cross-validation score using importance sampling or the importance weights approach.</li>
</ul>
<p>The best feature of PSIS is that it provides feedback about its own reliability. It does this by noting particular observations with very high weights that could make the PSIS score inaccurate.</p>
<p>Another nice feature of cross-validation and PSIS as an approximation is that it is com- puted point by point. This pointwise nature provides an approximate—sometimes very approximate—estimate of the standard error of our estimate of out-of-sample deviance. To compute this standard error, we calculate the CV or PSIS score for each observation and then exploit the central limit theorem to provide a measure of the standard error: <span class="math inline">\(\sqrt{Nvar(psis_i)}\)</span> where N= number of observations, and <span class="math inline">\(psis_i\)</span>= the PSIS estimate for observation i.</p>
<p>Cross-validation estimates the out-of-sample log-pointwise-predictive-density (lppd). If you have N observations and fit the model N times, dropping a single observation yi each time, then the out-of-sample lppd is the sum of the average accuracy for each omitted yi.</p>
<p>mportance sampling replaces the computation of N posterior distributions by using an estimate of the importance of each i to the posterior distribution. We draw samples from the full posterior dis- tribution p(θ|y), but we want samples from the reduced leave-one-out posterior distribution p(θ|y−i). So we re-weight each sample s (samples from a Markov chain) by the inverse of the probability of the omitted observation. The weights r(θs) can be unreliable. In particular, if any r(θs) is too relatively large, it can ruin the estimate of lppd by dominating it. One strategy is to truncate the weights so that none are larger than a theoretically derived limit. This helps, but it also biases the estimate. What PSIS does is more clever. It exploits the fact that the distribution of weights should have a particular shape, under some regular conditions. The largest weights should follow a generalized Pareto distribution.</p>
<p>The estimates of k provide information about the reliability of the approximation. There will be one k value for each yi. Larger k values indicate more influential points, and if k &gt; 0.5 then the Pareto distribution has infinite variance. Both theory and simulation suggest PSIS’s weights perform well as long as k &lt; 0.7. Large k values are useful for identifying influential observations.</p>
</div>
<div id="information-criteria" class="section level3">
<h3>information criteria</h3>
<p>Information criteria construct a theoretical estimate of the relative out-of-sample K-L Divergence</p>
<ul>
<li><strong>Akaike Information Criterion = AIC</strong>:</li>
</ul>
<p>On average, a predictor needs to reduce the deviance by 2 in order to improve the fit to new data. The Akaike information criterion is defined as:</p>
<p><strong>AIC</strong> = adjusted deviance + number of predictors = deviance + 2 · (number of predictors) (Eq 24.8) (Gelman and Hill 2005)</p>
<p><span class="math display">\[AIC= D_{train} + 2p = -2lppd + 2p\]</span> where p is the number of free parameters in the posterior distribution.</p>
<p>As the 2 is just there for scaling, what AIC tells us is that the dimensionality of the posterior distribution is a natural measure of the model’s overfitting tendency. More complex models tend to overfit more, directly in proportion to the number of parameters.</p>
<p>In classical regression or generalized linear modeling, a new model is estimated to reduce out-of-sample prediction error if the AIC decreases.</p>
<p>AIC is an approximation that is reliable only when: (1) The priors are flat or overwhelmed by the likelihood. (2) The posterior distribution is approximately multivariate Gaussian. (3) The sample size N is much greater than the number of parameters k.</p>
<ul>
<li><strong>Deviance Information Criterion = DIC</strong> in multilevel models.</li>
</ul>
<p>The ideas of deviance and AIC apply to multilevel models also, but with the difficulty that the “number of parameters” is not so clearly defined. Roughly speaking, the number of parameters in a multilevel model depends on the amount of pooling— a batch of J parameters corresponds to one parameter if there is complete pooling, J independent parameters if there is no pooling, and something in between with partial pooling. For example, with the varying-intercept radon models, the coeð- cients for the 85 county indicators represent something fewer than 85 independent parameters. Especially for the counties with small sample sizes, the group-level re- gression explains much of the variation in the intercepts, so that in the multilevel model they are not estimated independently. When the model is improved and the group-level variance decreases, the effective number of independent parameters also decreases.</p>
<p>In multilevel models:</p>
<ul>
<li><p>the mean deviance (that is, the deviance averaged over all the nsims simulated parameter vectors) plays the role of the adjusted deviance (24.7)</p></li>
<li><p>The effective number of parameters is called <span class="math inline">\(p_D\)</span></p></li>
<li><p>the measure of out-of- sample predictive error is the deviance information criterion:</p></li>
</ul>
<p>DIC = mean deviance + 2<span class="math inline">\(p_D\)</span>, (Eq 24.9)</p>
<p>which plays the role of the Akaike information criterion in (24.8). We shall not further discuss the computation of pD here, except to say that it is unstable to estimate and so we currently use it only in a provisional sense. We illustrate the use of deviance and DIC by comparing the fit of the models fit to the dog data in Section 24.2. Figure 24.6 shows the mean deviance, effective number of parameters, and DIC for each. As the models get more complicated, the mean deviance decreases, which makes sense—with more structure, we can fit the data better. However, the improvement in fit when moving to the multilevel models is counterbalanced by the increase in <span class="math inline">\(p_D\)</span>, the effective number of parameters. As a result, the estimated out-of-sample prediction error, DIC, actually increases slightly for these models. So we treat these <span class="math inline">\(p_D\)</span> and DIC results as suggestive rather than definitive.</p>
<p>DIC is assumes:</p>
<ol style="list-style-type: decimal">
<li>The posterior distribution is approximately multivariate Gaussian.</li>
<li>The sample size N is much greater than the number of parameters k.</li>
</ol>
<p>It does ok with informative priors.</p>
<ul>
<li><strong>Widely Applicable Information Criterion = WAIC</strong></li>
</ul>
<p>It approximates the out-of-sample deviance (K-L Divergence). This converges to the cross-validation approximation in a large sample. But in a finite sample, it can disagree.</p>
<p>WAIC is just the log-posterior-predictive- density (lppd) plus a penalty proportional to the variance in the posterior predictions. The penalty term is sometimes called the effective number of parameters, or the overfitting penalty, labeled pwaic.</p>
<p><span class="math display">\[WAIC= -2(lppd + penalty\:term) = -2(lppd - \sum_i var_{\theta}\:log\:p(y_i|\theta))\]</span></p>
<p>where y is the observations and Θ is the posterior distribution. The penalty term means, “compute the variance in log-probabilities for each observation i, and then sum up these variances to get the total penalty.” So you can think of each observation as having its own personal penalty score. And since these scores measure overfitting risk, you can also assess overfitting risk at the level of each observation.</p>
<p>Like PSIS, WAIC is pointwise. Prediction is considered case-by-case, or point-by-point, in the data. Several things arise from this. 1) First, WAIC also has an approximate standard error.</p>
<ol start="2" style="list-style-type: decimal">
<li><p>Second, since some observations have stronger influence on the posterior distribution, WAIC notes this in its pointwise penalty terms.</p></li>
<li><p>Third, just like cross-validation and PSIS, because WAIC allows splitting up the data into independent observations, it is sometimes hard to define. Consider for example a model in which each prediction depends upon a previous observation. This happens, for example, in a time series. In a time series, a previous observation becomes a predictor variable for the next observation. So it’s not easy to think of each observation as independent or exchangeable. In such a case, you can of course compute WAIC as if each observation were independent of the others, but it’s not clear what the resulting value means.</p></li>
</ol>
<p>WAIC makes no assumption about the shape of the posterior.</p>
<p><strong>Information criteria and consistency.</strong> As mentioned previously, information criteria like AIC and WAIC do not always assign the best expected Dtest to the “true” model. In statistical jargon, information criteria are not consistent for model identification. These criteria aim to nominate the model that will produce the best predictions, as judged by out-of-sample deviance, so it shouldn’t surprise us that they do not also do something that they aren’t designed to do. Other metrics for model comparison are however consistent. So are information criteria broken? They are not broken, if you care about prediction. Consistency is evaluated asymptotically. This means that we imagine the sample size N approaching infinity. Then we ask how a procedure behaves in this large-data limit. With practically infinite data, AIC and WAIC and cross-validation will often select a more complex model, so they are sometimes accused of “overfitting.” But at the large-data limit, the most complex model will make predictions identical to the true model (assuming it exists in the model set). The reason is that with so much data every parameter can be very precisely estimated. And so using an overly complex model will not hurt prediction.</p>
</div>
<div id="comparing-cross-validation-psis-and-waic" class="section level3">
<h3>comparing cross-validation, PSIS, and WAIC</h3>
<p>While all three criteria get the expected out-of-sample deviance approximately correct, it is also true that in any particular sample they usually miss it by some amount. So we should look at the average error as well.</p>
<p>PSIS and WAIC perform very similarly in the context of ordinary linear models. there are important differences, they lie in other model types, where the posterior distribu- tion is not approximately Gaussian or in the presence of observations that strongly influence the posterior. CV and PSIS have higher variance as estimators of the K-L Divergence, while WAIC has greater bias. So we should expect each to be slightly better in different contexts. However, in practice any advantage may be much smaller than the expected error. Watan- abe recommends computing both WAIC and PSIS and contrasting them. If there are large differences, this implies one or both criteria are unreliable.</p>
<p>Estimation aside, PSIS has a distinct advantage in warning the user about when it is unreliable. The k values that PSIS computes for each observation indicate when the PSIS score may be unreliable, as well as identify which observations are at fault.</p>
<p>the train-test prediction task is not representative of everything we might wish to do with models. For example, some statisticians prefer to evaluate predictions using a prequential framework, in which models are judged on their accumulated learning error over the training sample. And once you start using multilevel models, “prediction” is no longer uniquely defined, because the test sample can differ from the training sample in ways that forbid use of some the parameter esti- mates. We’ll worry about that issue in Chapter 13.</p>
<p>Perhaps a larger concern is that our train-test thought experiment pulls the test sample from exactly the same process as the training sample. This is a kind of uniformitarian assumption, in which future data are expected to come from the same process as past data and have the same rough range of values. This can cause problems. For example, suppose we fit a regression that predicts height using body weight. The training sample comes from a poor town, in which most people are pretty thin. The relationship between height and weight turns out to be positive and strong. Now also suppose our prediction goal is to guess the heights in another, much wealthier, town. Plugging the weights from the wealthy individuals into the model fit to the poor individuals will predict outrageously tall people. The reason is that, once weight becomes large enough, it has essentially no relationship with height. WAIC will not automatically recognize nor solve this problem. Nor will any other isolated procedure. But over repeated rounds of model fitting, attempts at prediction, and model criticism, it is possible to overcome this kind of limitation. As always, statistics is no substitute for science.</p>
<p><strong>cross-validation, PSIS, and WAIC for MODEL COMPARISON</strong></p>
<p>Model comparison is a more general approach than model selection that uses multiple models to understand both how different variables influence predictions and, in combination with a causal model, implied conditional independencies among variables help us infer causal relationships.</p>
<p>When there are several plausible (and hopefully un-confounded) models for the same set of observations, how should we compare the accuracy of these models? Following the fit to the sample is no good, because fit will always favor more complex models. Information divergence is the right measure of model accuracy, but even it will just lead us to choose more and more complex and wrong models. We need to somehow evaluate models out-of-sample. How can we do that? A meta- model of forecasting tells us two important things. First, flat priors produce bad predictions. Regularizing priors—priors which are skeptical of extreme parameter values—reduce fit to sample but tend to improve predictive accuracy. Second, we can get a useful guess of predictive accuracy with the criteria CV, PSIS, and WAIC. Regularizing priors and CV/PSIS/WAIC are complementary. Regularization reduces overfitting, and predictive criteria measure it.</p>
<p>How do we use regularizing priors and CV/PSIS/WAIC? A very common use of cross-validation and information criteria is to perform model selection, which means choosing the model with the lowest criterion value and then dis- carding the others. But you should never do this.</p>
<ul>
<li><p>This kind of selection procedure discards the information about relative model accuracy contained in the differences among the CV/PSIS/WAIC values. Why are the differences useful? Because sometimes the differences are large and sometimes they are small. Just as relative posterior probability provides ad- vice about how confident we might be about parameters (conditional on the model), relative model accuracy provides advice about how confident we might be about models (conditional on the set of models compared).</p></li>
<li><p>Another reason to never select models based upon WAIC/CV/PSIS alone is that we might care about causal inference. Maximizing expected predictive accuracy is not the same as inferring causation. Highly confounded models can still make good predictions, at least in the short term. They won’t tell us the consequences of an intervention, but they might help us forecast. So we need to be clear about our goals and not just toss variables into the causal salad and let WAIC select our meal.</p></li>
</ul>
<p>So what good are these criteria then?</p>
<ul>
<li><p>They measure expected predictive value of a variable on the right scale, accounting for overfitting. This helps in testing model implications, given a set of causal models.</p></li>
<li><p>They also provide a way to measure the overfitting tendency of a model, and that helps us both design models and understand how statistical inference works.</p></li>
<li><p>Finally, minimizing a criterion like WAIC can help in designing models, especially in tuning parameters in multilevel models.</p></li>
</ul>
</div>
<div id="plant-treatment-fungus-example-mcelreath2020-with-model-comparison" class="section level3">
<h3>plant-treatment-fungus example <span class="citation">@mcelreath2020</span> with model comparison</h3>
<p>Suppose for example that you are growing some plants in a greenhouse. You want to know the difference in growth under different anti- fungal soil treatments, because fungus on the plants tends to reduce their growth. Plants are initially seeded and sprout. Their heights are measured. Then different soil treatments are applied. Final measures are the height of the plant and the presence of fungus. There are four variables of interest here: initial height, final height, treatment, and presence of fungus.</p>
<pre class="r"><code># simulate data based on that experiment
set.seed(71)
# number of plants 
N &lt;- 100
# simulate initial heights 
h0 &lt;- rnorm(N,10,2)
# assign treatments and simulate fungus and growth 
treatment &lt;- rep( 0:1 , each=N/2 )
fungus &lt;- rbinom( N , size=1 , prob=0.5 - treatment*0.4 ) 
h1 &lt;- h0 + rnorm(N, 5 - 3*fungus)
# compose a clean data frame
d &lt;- data.frame( h0=h0 , h1=h1 , treatment=treatment , fungus=fungus ) 
precis(d)</code></pre>
<pre><code>##               mean        sd      5.5%    94.5%    histogram
## h0         9.95978 2.1011623  6.570328 13.07874 ▁▂▂▂▇▃▂▃▁▁▁▁
## h1        14.39920 2.6880870 10.618002 17.93369     ▁▁▃▇▇▇▁▁
## treatment  0.50000 0.5025189  0.000000  1.00000   ▇▁▁▁▁▁▁▁▁▇
## fungus     0.23000 0.4229526  0.000000  1.00000   ▇▁▁▁▁▁▁▁▁▂</code></pre>
<p>We know that the plants at time t = 1 should be taller than at time t = 0, whatever scale they are measured on. So if we put the parameters on a scale of proportion of height at time t = 0, rather than on the absolute scale of the data, we can set the priors more easily. To make this simpler, let’s focus right now only on the height variables, ignoring the predictor variables. We might have a linear model like:</p>
<p><span class="math inline">\(h_{1,i} \sim Normal(\mu_i, \sigma)\)</span> <span class="math inline">\(\mu_i= h_{0,i}*p\)</span></p>
<p>where <span class="math inline">\(h_{0,i}\)</span> is plant i’s height at time t = 0, <span class="math inline">\(h_{1,i}\)</span> is plant i’s height at time t = 1, <span class="math inline">\(p= h_{1,i}/h_{0,i}\)</span> is a parameter measuring the proportion of h0,i that h1,i is. If p = 1,the plant has no change in height. We have to ensure that p &gt; 0, because it is a proportion, so we use a Log-Normal distribution as a prior, because it is always positive.</p>
<p><strong>only intercept model </strong></p>
<pre class="r"><code>m6.6 &lt;- quap( alist(
h1 ~ dnorm( mu , sigma ), 
mu &lt;- h0*p,
p ~ dlnorm( 0 , 0.25 ), 
sigma ~ dexp( 1 )
), data=d ) 
precis(m6.6)</code></pre>
<pre><code>##           mean         sd     5.5%    94.5%
## p     1.426628 0.01759834 1.398503 1.454754
## sigma 1.792106 0.12496794 1.592383 1.991829</code></pre>
<p>About 40% growth, on average.</p>
<p>Now to include the treatment and fungus variables. We’d like to measure the impact of both the treatment and the fungus itself. The parameters for these variables will also be on the proportion scale. They will be changes in proportion growth. So we’re going to make a linear model of p now.</p>
<p><span class="math inline">\(h_{1,i} \sim Normal(\mu_i, \sigma)\)</span> <span class="math inline">\(\mu_i= h_{0,i}*p\)</span> <span class="math inline">\(p = \alpha + \beta_TT_i +\beta_FF_i\)</span></p>
<p><strong>Trt and fungus model</strong></p>
<pre class="r"><code>m6.7 &lt;- quap( alist(
h1 ~ dnorm( mu , sigma ),
mu &lt;- h0 * p,
p &lt;- a + bt*treatment + bf*fungus, 
a ~ dlnorm( 0 , 0.2 ) ,
bt ~ dnorm( 0 , 0.5 ),
bf ~ dnorm( 0 , 0.5 ),
sigma ~ dexp( 1 )
), data=d ) 
precis(m6.7)</code></pre>
<pre><code>##              mean         sd        5.5%       94.5%
## a      1.48139094 0.02451068  1.44221815  1.52056373
## bt     0.00241255 0.02986963 -0.04532488  0.05014998
## bf    -0.26671805 0.03654770 -0.32512833 -0.20830777
## sigma  1.40879638 0.09862052  1.25118174  1.56641102</code></pre>
<p>That a parameter is the same as p before. And it has nearly the same posterior. The marginal posterior for bt, the effect of treatment, is solidly zero, with a tight interval. The treatment is not associated with growth. The fungus seems to have hurt growth, however. Given that we know the treatment matters, because we built the simulation that way, what happened here?</p>
<p>The problem is that fungus is mostly a consequence of treatment. This is to say that fungus is a post-treatment variable. So when we control for fungus, the model is implicitly answering the question: Once we already know whether or not a plant developed fungus, does soil treatment matter? The answer is “no,” because soil treatment has its effects on growth through reducing fungus. But we actually want to know, based on the design of the experiment, is the impact of treatment on growth. To measure this properly, we should omit the post-treatment variable fungus.</p>
<p><strong>Trt no fungus model</strong></p>
<pre class="r"><code>m6.8 &lt;- quap( alist(
h1 ~ dnorm( mu , sigma ), 
mu &lt;- h0 * p,
p &lt;- a + bt*treatment,
a ~ dlnorm( 0 , 0.2 ), 
bt ~ dnorm( 0 , 0.5 ), 
sigma ~ dexp( 1 )
), data=d ) 
precis(m6.8)</code></pre>
<pre><code>##             mean         sd       5.5%     94.5%
## a     1.38035157 0.02517700 1.34011386 1.4205893
## bt    0.08499494 0.03429912 0.03017831 0.1398116
## sigma 1.74641704 0.12193300 1.55154456 1.9412895</code></pre>
<p>Now the impact of treatment is clearly positive, as it should be. It makes sense to control for pre-treatment differences, like the initial height h0, that might mask the causal influence of treatment. But including post-treatment variables can actually mask the treatment itself. This doesn’t mean you don’t want the model that includes both treatment and fungus. The fact that including fungus zeros the coefficient for treatment suggests that the treatment works for exactly the anticipated reasons. It tells us about mechanism. But a correct inference about the treatment still depends upon omitting the post-treatment variable.</p>
<p><img src="index_files/figure-html/fungus%20dag-1.png" width="672" /></p>
<pre><code>## F _||_ H_0
## H_0 _||_ T
## H_1 _||_ T | F</code></pre>
<p>When we include F, the post-treatment effect, in the model, we end up blocking the path from the treatment to the outcome. This is the DAG way of saying that learning the treatment tells us nothing about the outcome, once we know the fungus status. Conditioning on F effectively blocks the directed path T → F → H1, making T and H1 independent (d-separated). In the previous chapter, you saw the notation H1 ⊥ T|F for this kind of statement.</p>
<p><strong>MODEL COMPARISON</strong></p>
<p>Cross-validation and WAIC aim to find models that make good predictions. They don’t solve any causal inference problem.</p>
<p>m6.6 is the model with just an intercept, m6.7 is the model that include both treatment and fungus (the post-treatment variable), and m6.8 is the model that includes treatment but omits fungus. It’s m6.8 that allows us to correctly infer the causal influence of treatment. However the model that conditions on fungus will make better predictions than the model that omits it.</p>
<pre class="r"><code>set.seed(77)
compare( m6.6 , m6.7 , m6.8 , func=WAIC )</code></pre>
<pre><code>##          WAIC       SE    dWAIC      dSE    pWAIC       weight
## m6.7 361.8901 14.26191  0.00000       NA 3.839493 1.000000e+00
## m6.8 402.7753 11.28120 40.88517 10.47814 2.645589 1.324032e-09
## m6.6 405.9174 11.66153 44.02729 12.23018 1.582861 2.751664e-10</code></pre>
<pre class="r"><code>compare( m6.6 , m6.7 , m6.8 , func=PSIS )</code></pre>
<pre><code>##          PSIS       SE    dPSIS      dSE    pPSIS       weight
## m6.7 361.8546 14.24683  0.00000       NA 3.770466 1.000000e+00
## m6.8 402.7944 11.24936 40.93980 10.43842 2.683834 1.288356e-09
## m6.6 406.3763 11.85462 44.52163 12.29540 1.789302 2.149075e-10</code></pre>
<p>The first column contains the WAIC values. Smaller values are better, and the models are ordered by WAIC, from best to worst. The model that includes the fungus variable has the smallest WAIC, as promised. The pWAIC column is the penalty term of WAIC. These values are close to, but slightly below, the number of dimensions in the posterior of each model, which is to be expected in linear regressions with regularizing priors.</p>
<p>The dWAIC column is the difference between each model’s WAIC and the best WAIC in the set. So it’s zero for the best model and then the differences with the other models tell you how far apart each is from the top model. So m6.7 is about 40 units of deviance smaller than both other models. The intercept model, m6.6, is 3 units worse than m6.8. Are these big differences or small differences? One way to answer that is to ask a clearer question: Are the models easily distinguished by their expected out-of-sample accuracy? To answer that question, we need to consider the error in the WAIC estimates. Since we don’t have the target sample, these are just guesses, and we know from the simulations that there is a lot of variation in WAIC’s error.</p>
<p>That is what the two standard error columns, SE and dSE, are there to help us with. SE is the approximate standard error of each WAIC. In a very approximate sense, we expect the uncertainty in out-of-sample accuracy to be normally distributed with mean equal to the reported WAIC value and a standard deviation equal to the standard error. When the sample is small, this approximation tends to dramatically underestimate the uncertainty. But it is still better than older criteria like AIC, which provide no way to gauge their uncertainty.</p>
<p>Now to judge whether two models are easy to distinguish, we don’t use their standard errors but rather the standard error of their difference. What does that mean? Just like each WAIC value, each difference in WAIC values also has a standard error. To compute the standard error of the difference between models m6.7 and m6.8, we just need the pointwise breakdown of the WAIC values.</p>
<p>The difference between the models is 40.9 and the standard error about 10.4. If we imagine the 99% (corresponding to a z-score of about 2.6) interval of the difference, it’ll be about:</p>
<pre class="r"><code>  40.0 + c(-1,1)*10.4*2.6</code></pre>
<pre><code>## [1] 12.96 67.04</code></pre>
<p>Model m6.7 is a lot better. You might be able to see all of this better, if we plot the compare table:</p>
<pre class="r"><code> plot( compare( m6.6 , m6.7 , m6.8 ) )</code></pre>
<p><img src="index_files/figure-html/compare%20fungus%20plots-1.png" width="672" /> The filled points are the in-sample deviance values. The open points are the WAIC values. Notice that naturally each model does better in-sample than it is expected to do out-of- sample. The line segments show the standard error of each WAIC. These are the values in the column labeled SE in the table above. So you can probably see how much better m6.7 is than m6.8. What we really want however is the standard error of the difference in WAIC between the two models. That is shown by the lighter line segment with the triangle on it, between m6.7 and m6.8.</p>
<p>What does this all of this mean? It means that WAIC cannot be used to infer causation.</p>
<p>Similarly, we can ask about the difference between models m6.8, the model with treat- ment only, and model m6.6, the intercept model. Model m6.8 provides pretty good evidence that the treatment works. You can inspect the posterior again, if you have forgotten. But WAIC thinks these two models are quite similar. There difference is only 3 units of deviance.</p>
<pre class="r"><code>set.seed(93)
compare( m6.6 , m6.7 , m6.8 )@dSE</code></pre>
<pre><code>##           m6.6     m6.7      m6.8
## m6.6        NA 12.20638  4.934353
## m6.7 12.206380       NA 10.426576
## m6.8  4.934353 10.42658        NA</code></pre>
<p>We can use WAIC/CV/PSIS to measure how big a difference some variable makes in prediction. But we cannot use these criteria to decide whether or not some effect exists. We need the posterior distributions of multiple models, maybe examining the implied conditional independencies of a relevant causal graph, to do that.</p>
</div>
<div id="posterior-predictive-accuracy-in-multilevel-models" class="section level3">
<h3>POSTERIOR PREDICTIVE ACCURACY IN MULTILEVEL MODELS</h3>
<ol style="list-style-type: decimal">
<li><p>we should no longer expect the model to exactly retrodict the sample, because adaptive regularization has as its goal to trade off poorer fit in sample for better inference and hopefully better fit out of sample. That is what shrinkage does for us. Of course, we should never be trying to really retrodict the sample. But now you have to expect that even a perfectly good model fit will differ from the raw data in a systematic way.</p></li>
<li><p>“prediction” in the context of a multilevel model requires additional choices. If we wish to validate a model against the specific clusters used to fit the model, that is one thing. But if we instead wish to compute predictions for new clusters, other than the ones observed in the sample, that is quite another. We’ll consider each of these in turn, continuing to use the chimpanzees model from the previous section.</p></li>
</ol>
</div>
<div id="posterior-prediction-for-the-same-clusters" class="section level3">
<h3>posterior prediction for the same clusters</h3>
<p>When working with the same clusters as you used to fit a model, varying intercepts are just parameters. The only trick is to ensure that you use the right intercept for each case in the data.</p>
<p>Before computing predictions, note again that we should no longer expect the posterior predictive distribution to match the raw data, even when the model worked correctly. Why? The whole point of partial pooling is to shrink estimates towards the grand mean. So the estimates should not necessarily match up with the raw data, once you use pooling.</p>
<p>For example, in data(chimpanzees), there are 7 unique actors. These are the clusters. The varying intercepts model, m13.4, estimated an intercept for each, in addition to two parameters to describe the mean and standard deviation of the population of actors.</p>
<p><span class="math inline">\(L_i \sim binomial(1,p_i)\)</span></p>
<p><span class="math inline">\(logit(p_i)= \alpha_{actor[i]} + \gamma_{block[i]} + \beta_{treatment[i]}\)</span></p>
<p>βj ∼ Normal(0, 0.5) , , for j = 1..4 αj ∼ Normal(<span class="math inline">\(\bar{\alpha}\)</span>, <span class="math inline">\(\sigma_{\alpha}\)</span>) , for j = 1..7 γj ∼Normal(0,<span class="math inline">\(\sigma_{\gamma}\)</span>) , for j=1..6 <span class="math inline">\(\bar{\alpha}\)</span> ∼ Normal(0, 1.5) <span class="math inline">\(\sigma_{\alpha}\)</span> ∼ Exponential(1) <span class="math inline">\(\sigma_{\gamma}\)</span> ∼ Exponential(1)</p>
<p>For actors, the vector is α, and it has length 7, because there are 7 chimpanzees in the sample. For blocks, the vector is γ, and it has length 6, because there are 6 blocks. Each cluster variable needs its own standard deviation parameter that adapts the amount of pooling across units, be they actors or blocks. These are σα and σγ , respectively. Finally, note that there is only one global mean parameter α ̄. We can’t identify a separate mean for each varying intercept type, because both intercepts are added to the same linear prediction. If you do include a mean for each cluster type, it won’t be the end of the world, however. It’ll be like the right leg and left leg example</p>
<pre class="r"><code>library(rethinking)
data(chimpanzees)
d &lt;- chimpanzees

d$treatment &lt;- 1 + d$prosoc_left + 2*d$condition

dat_list &lt;- list(
pulled_left = d$pulled_left,
actor = d$actor,
block_id = d$block,
treatment = as.integer(d$treatment) )

set.seed(13) 
m13.4 &lt;- ulam(
alist(
pulled_left ~ dbinom( 1 , p ) ,
logit(p) &lt;- a[actor] + g[block_id] + b[treatment] ,
b[treatment] ~ dnorm( 0 , 0.5 ),
## adaptive priors
a[actor] ~ dnorm( a_bar , sigma_a ),
g[block_id] ~ dnorm( 0 , sigma_g ),
## hyper-priors
a_bar ~ dnorm( 0 , 1.5 ), 
sigma_a ~ dexp(1),
sigma_g ~ dexp(1)
) , data=dat_list , chains=4 , cores=4 , log_lik=TRUE )

precis( m13.4 , depth=2 )</code></pre>
<pre><code>##                mean        sd        5.5%       94.5%     n_eff    Rhat4
## b[1]    -0.11313378 0.2994842 -0.56736626  0.36216651  530.9201 1.005944
## b[2]     0.41484801 0.3072984 -0.06134618  0.91222316  457.1542 1.006079
## b[3]    -0.45242856 0.3016649 -0.93501529  0.04024289  509.8297 1.007060
## b[4]     0.29572234 0.3002147 -0.16992128  0.79321886  559.9583 1.008623
## a[1]    -0.38397215 0.3625454 -0.97937299  0.17891527  465.7727 1.004672
## a[2]     4.58870853 1.2190650  2.96023315  6.73313263 1041.8122 1.002441
## a[3]    -0.68379833 0.3614917 -1.27640399 -0.13190054  488.5157 1.003387
## a[4]    -0.68856332 0.3689351 -1.29552595 -0.12984335  540.0827 1.001998
## a[5]    -0.37777783 0.3571678 -0.94649853  0.18815734  441.8281 1.004621
## a[6]     0.56704326 0.3634753 -0.01929119  1.13996789  444.9970 1.005201
## a[7]     2.08755254 0.4630353  1.36063439  2.83129087  645.8250 1.004894
## g[1]    -0.16786921 0.2096114 -0.56457533  0.07732807  488.5842 1.003115
## g[2]     0.04075829 0.1801517 -0.22951777  0.33540151 1073.7119 1.000451
## g[3]     0.05730518 0.1825078 -0.19744546  0.37367544  677.8763 1.002223
## g[4]     0.01359270 0.1658458 -0.23168756  0.28364144 1183.4456 1.000367
## g[5]    -0.02621294 0.1686431 -0.32110410  0.22657078 1100.8752 1.000164
## g[6]     0.11378798 0.1879611 -0.10752507  0.46009875  712.5907 1.002426
## a_bar    0.56719916 0.7240903 -0.58704056  1.72022372  856.1618 1.000126
## sigma_a  1.98309010 0.6035389  1.18874331  3.10480024 1078.6780 1.001276
## sigma_g  0.20979765 0.1708190  0.03778379  0.50538341  359.1150 1.009165</code></pre>
<p><img src="index_files/figure-html/m13.4%20plot-1.png" width="672" /></p>
<p>computing and plotting posterior predictions for actor number 2:</p>
<ul>
<li>using the rethinking::link function</li>
</ul>
<pre class="r"><code>chimp &lt;- 2 
d_pred &lt;- list(
actor = rep(chimp,4), treatment = 1:4, block_id = rep(1,4)
)
p &lt;- link( m13.4 , data=d_pred ) 
p_mu &lt;- apply( p , 2 , mean ) 
p_ci &lt;- apply( p , 2 , PI )</code></pre>
<div class="figure">
<img src="notes%20screenshots/Screen%20Shot%202020-12-16%20at%2018.14.45.png" alt="" />
<p class="caption">mcelreath figure 11.4</p>
</div>
<ul>
<li>not using the rethinking::link function</li>
</ul>
<p>The only difficulty is that when we work with the samples from the posterior, the varying intercepts will be a matrix of samples. Let’s take a look:</p>
<pre class="r"><code>post &lt;- extract.samples(m13.4) 
str(post)</code></pre>
<pre><code>## List of 6
##  $ b      : num [1:2000, 1:4] -0.7261 -0.4423 0.4382 0.0606 -0.1603 ...
##  $ a      : num [1:2000, 1:7] -0.03064 0.43584 -0.36912 -0.44558 0.00558 ...
##  $ g      : num [1:2000, 1:6] 0.0314 -0.7262 -0.2167 -0.7357 -0.4458 ...
##  $ a_bar  : num [1:2000(1d)] 0.594 0.908 0.779 1.817 -0.249 ...
##  $ sigma_a: num [1:2000(1d)] 1.51 1.57 1.32 1.64 2.85 ...
##  $ sigma_g: num [1:2000(1d)] 0.0955 0.4996 0.1515 0.404 0.2786 ...
##  - attr(*, &quot;source&quot;)= chr &quot;ulam posterior: 2000 samples from m13.4&quot;</code></pre>
<pre class="r"><code>#The a matrix has samples on the rows and actors on the columns. So to plot, for example, the density for actor 5:
 dens( post$a[,5] )</code></pre>
<p><img src="index_files/figure-html/no%20link%20chimp-1.png" width="672" /></p>
<pre class="r"><code> p_link &lt;- function( treatment , actor=1 , block_id=1 ) { 
   logodds &lt;- with( post ,
a[,actor] + g[,block_id] + b[,treatment] ) 
   return( inv_logit(logodds) )
 }
 
p_raw &lt;- sapply( 1:4 , function(i) p_link( i , actor=2 , block_id=1 ) ) 
p_mu &lt;- apply( p_raw , 2 , mean )
p_ci &lt;- apply( p_raw , 2 , PI )</code></pre>
</div>
<div id="posterior-prediction-for-new-clusters" class="section level3">
<h3>posterior prediction for new clusters</h3>
<p>Theproblemofmakingpredictionsfornew clusters is really a problem of generalizing from the sample. In general, there is no unique procedure for generalizing predictions outside of a sample. The right thing to do depends upon the causal model, the statistical model, and your goals. But if you have a generative model, then you can often think your way through it. The key idea is to use the posterior to parameterize a simulation that embodies the target generalization</p>
<p>EXAMPLE</p>
<p>Suppose you want to predict how chimpanzees in another population would respond to our lever pulling experiment. The particular 7 chimpanzees in the sample allowed us to estimate 7 unique intercepts. But these individual actor intercepts aren’t of interest, because none of these 7 individuals is in the new population. One way to grasp the task of constructing posterior predictions for new clusters is to imagine leaving out one of the clusters when you fit the model to the data. For example, suppose we leave out actor number 7 when we fit the chimpanzees model. Now how can we assess the model’s accuracy for predicting actor number 7’s behavior? We can’t use any of the a parameter estimates, because those apply to other individuals. But we can make good use of the a_bar and sigma_a parameters. These parameters describe a statistical population of actors, and we can simulate new actors from it. First, let’s see how to construct posterior predictions for a new, previously unobserved average actor. By “average,” I mean an individual chimpanzee with an intercept exactly at a_bar (α ̄), the population mean. Since there is uncertainty about the population mean, there is still uncertainty about this average individual’s intercept. But as you’ll see, the uncertainty is much smaller than it really should be, if we wish to honestly represent the problem of what to expect from a new individual.</p>
<p>Notice that the function ignores block. This is because we are extrapolating to new blocks, so we assume the average block effect is about zero</p>
<pre class="r"><code>p_link_abar &lt;- function( treatment ) {
logodds &lt;- with( post , a_bar + b[,treatment] ) 
return( inv_logit(logodds) )
}

post &lt;- extract.samples(m13.4)
p_raw &lt;- sapply( 1:4 , function(i) p_link_abar( i ) ) 
p_mu &lt;- apply( p_raw , 2 , mean )
p_ci &lt;- apply( p_raw , 2 , PI )
plot( NULL , xlab=&quot;treatment&quot; , ylab=&quot;proportion pulled left&quot; ,
    ylim=c(0,1) , xaxt=&quot;n&quot; , xlim=c(1,4) )
axis( 1 , at=1:4 , labels=c(&quot;R/N&quot;,&quot;L/N&quot;,&quot;R/P&quot;,&quot;L/P&quot;) )
lines( 1:4 , p_mu )
shade( p_ci , 1:4 )</code></pre>
<p><img src="index_files/figure-html/predict%20new%20chimp-1.png" width="672" /> Setting the varying inter- cept a to the mean a_bar produces predictions for an average actor. These predictions ignore uncertainty arising from variation among actors.</p>
<p>The gray region shows the 89% compatibility interval for an actor with an average intercept. The predictions just set the actor to the average, ignoring variation among actors. This kind of calculation makes it easy to see the impact of prosoc_left, as well as uncertainty about where the average is, but it doesn’t show the variation among actors.</p>
<p>To show the variation among actors, we’ll need to use sigma_a in the calculation. First we simply use rnorm to sample some random chimpanzees, using mean a_bar and standard deviation sigma_a. Then we write a link function that references those simulated chimpanzees, not the ones in the posterior. It’s important to do the chimpanzee sampling outside the link function, because we want to reference the same simulate chimpanzee, whichever treatment we consider. This is the code:</p>
<pre class="r"><code>a_sim &lt;- with( post , rnorm( length(post$a_bar) , a_bar , sigma_a ) ) 

p_link_asim &lt;- function( treatment ) {
logodds &lt;- with( post , a_sim + b[,treatment] )
return( inv_logit(logodds) ) }

p_raw_asim &lt;- sapply( 1:4 , function(i) p_link_asim( i ) )
p_mu &lt;- apply( p_raw_asim , 2 , mean )
p_ci &lt;- apply( p_raw_asim, 2 , PI )
plot( NULL , xlab=&quot;treatment&quot; , ylab=&quot;proportion pulled left&quot; ,
    ylim=c(0,1) , xaxt=&quot;n&quot; , xlim=c(1,4) )
axis( 1 , at=1:4 , labels=c(&quot;R/N&quot;,&quot;L/N&quot;,&quot;R/P&quot;,&quot;L/P&quot;) )
lines( 1:4 , p_mu )
shade( p_ci , 1:4 )</code></pre>
<p><img src="index_files/figure-html/sim%20new%20chimp-1.png" width="672" /> Simulating varying intercepts using the posterior standard deviation among actors, sigma_a, produces predictions that account for variation among actors. These posterior predictions are marginal of actor, which means that they average over the uncertainty among actors.</p>
<p>At this point, students usually ask, “So which one should I use?” The answer is, “It depends.” Both are useful, depending upon the question. The predictions for an average actor help to visualize the impact of treatment. The predictions that are marginal of actor illustrate how variable different chimpanzees are, according to the model. You probably want to compute both for yourself, when trying to understand a model. But which you include in a report will depend upon context.</p>
<p>In this case, we can do better by making a plot that displays both the treatment effect and the variation among actors. We can do this by forgetting about intervals and instead simulating a series of new actors in each of the four treatments. By drawing a line for each actor across all four treatments, we’ll be able to visualize both the zig-zag impact of prosoc_left as well as the variation among individuals.</p>
<p>We just need to use the rows in p_raw_asim from above. Each row contains a single trend, a single simulated chimpanzee. So instead of sum- marizing with mean and PI, we can just loop over rows and plot:</p>
<pre class="r"><code>plot( NULL , xlab=&quot;treatment&quot; , ylab=&quot;proportion pulled left&quot; ,
    ylim=c(0,1) , xaxt=&quot;n&quot; , xlim=c(1,4) )
axis( 1 , at=1:4 , labels=c(&quot;R/N&quot;,&quot;L/N&quot;,&quot;R/P&quot;,&quot;L/P&quot;) )
for ( i in 1:100 ) lines( 1:4 , p_raw_asim[i,] , col=grau(0.25) , lwd=2 )</code></pre>
<p><img src="index_files/figure-html/plot%20each%20sim%20chimp-1.png" width="672" /></p>
<p>100 simulated actors with unique intercepts sampled from the posterior. Each simulation maintains the same parameter values across all four treatments.</p>
</div>
<div id="forecasting-accuracy" class="section level3">
<h3>FORECASTING ACCURACY</h3>
<p>From <a href="https://otexts.com/fpp2/accuracy.html" class="uri">https://otexts.com/fpp2/accuracy.html</a></p>
<p>It is important to evaluate forecast accuracy using genuine forecasts. Consequently, the size of the residuals is not a reliable indication of how large true forecast errors are likely to be. The accuracy of forecasts can only be determined by considering how well a model performs on new data that were not used when fitting the model.</p>
<p>When choosing models, it is common practice to separate the available data into two portions, training and test data, where the training data is used to estimate any parameters of a forecasting method and the test data is used to evaluate its accuracy. Because the test data is not used in determining the forecasts, it should provide a reliable indication of how well the model is likely to forecast on new data.</p>
<p>The following points should be noted:</p>
<ul>
<li><p>A model which fits the training data well will not necessarily forecast well.</p></li>
<li><p>A perfect fit can always be obtained by using a model with enough parameters.</p></li>
<li><p>Over-fitting a model to data is just as bad as failing to identify a systematic pattern in the data.</p></li>
</ul>
<p><strong>forecast error</strong></p>
<p>forecast errors are different from residuals in two ways. First, residuals are calculated on the training set while forecast errors are calculated on the test set. Second, residuals are based on one-step forecasts while forecast errors can involve multi-step forecasts.</p>
<p>We can measure forecast accuracy by summarising the forecast errors in different ways.</p>
<p><span class="math display">\[e_{T+h}= y_{T+h} - \hat{y}_{T+h|T}\]</span> where</p>
<p>training dta: <span class="math inline">\(y_1,...,y_T\)</span></p>
<p>testing data: <span class="math inline">\(y_{T+1},y_{T+2}...\)</span></p>
</div>
<div id="scale-dependent-errors" class="section level3">
<h3>scale-dependent errors</h3>
<p>The forecast errors are on the same scale as the data. Accuracy measures that are based only on <span class="math inline">\(e_{t}\)</span> are therefore scale-dependent and cannot be used to make comparisons between series that involve different units.</p>
<ul>
<li><strong>mean absolute error = MAE</strong></li>
</ul>
<p><span class="math display">\[MAE= mean(|e_{t}|)\]</span></p>
<p>A forecast method that minimises the MAE will lead to forecasts of the median</p>
<p><img src="notes%20screenshots/Screen%20Shot%202020-12-17%20at%2011.57.51.png" /></p>
<ul>
<li><strong>root mean squared error = RMSE</strong></li>
</ul>
<p><span class="math display">\[RMSE= \sqrt{mean(e_{t}^2)}\]</span></p>
<p>Minimising the RMSE will lead to forecasts of the mean.</p>
</div>
<div id="scaled-errors" class="section level3">
<h3>scaled errors</h3>
<p>Scaled errors were proposed by Hyndman &amp; Koehler (2006) as an alternative to using percentage errors when comparing forecast accuracy across series with different units. They proposed scaling the errors based on the training MAE from a simple forecast method.</p>
<p>Because the numerator and denominator both involve values on the scale of the original data,<span class="math inline">\(q_{j}\)</span> is independent of the scale of the data.</p>
<ul>
<li><strong>naïve forecasts</strong></li>
</ul>
<p>For a non-seasonal time series, a useful way to define a scaled error uses naïve forecasts:</p>
<p><span class="math display">\[q_{j}= \frac{e_j}{\frac{1}{T-1}\sum^T_{t=2}|y_t-y_{t-1}|}\]</span></p>
<ul>
<li><strong>seasonal naïve forecasts</strong></li>
</ul>
<p>For a seasonal time series, a useful way to define a scaled error uses naïve forecasts:</p>
<p><span class="math display">\[q_{j}= \frac{e_j}{\frac{1}{T-m}\sum^T_{t=m+1}|y_t-y_{t-m}|}\]</span></p>
<p><span class="math inline">\(q_{j}&lt; 1\)</span> if it arises from a better forecast than the average naïve forecast computed on the training data.</p>
<p><span class="math inline">\(q_{j}&gt;1\)</span> the forecast is worse than the average naïve forecast computed on the training data.</p>
<ul>
<li><strong>mean absolute scaled error= MASE</strong></li>
</ul>
<p><span class="math display">\[MASE= mean(|q_{j}|)\]</span></p>
<p>EXAMPLE</p>
<pre class="r"><code>beer2 &lt;- window(ausbeer,start=1992,end=c(2007,4))
beerfit1 &lt;- meanf(beer2,h=10)
beerfit2 &lt;- rwf(beer2,h=10)
beerfit3 &lt;- snaive(beer2,h=10)
autoplot(window(ausbeer, start=1992)) +
  autolayer(beerfit1, series=&quot;Mean&quot;, PI=FALSE) +
  autolayer(beerfit2, series=&quot;Naïve&quot;, PI=FALSE) +
  autolayer(beerfit3, series=&quot;Seasonal naïve&quot;, PI=FALSE) +
  xlab(&quot;Year&quot;) + ylab(&quot;Megalitres&quot;) +
  ggtitle(&quot;Forecasts for quarterly beer production&quot;) +
  guides(colour=guide_legend(title=&quot;Forecast&quot;))</code></pre>
<p><img src="index_files/figure-html/aus%20beer%20forecasting-1.png" width="672" /></p>
<p>The figure shows three forecast methods applied to the quarterly Australian beer production using data only to the end of 2007. The actual values for the period 2008–2010 are also shown.</p>
<p>We compute the forecast accuracy measures for this period.</p>
<pre class="r"><code>beer3 &lt;- window(ausbeer, start=2008)
accuracy(beerfit1, beer3)</code></pre>
<pre><code>##                   ME     RMSE      MAE        MPE     MAPE     MASE        ACF1
## Training set   0.000 43.62858 35.23438 -0.9365102 7.886776 2.463942 -0.10915105
## Test set     -13.775 38.44724 34.82500 -3.9698659 8.283390 2.435315 -0.06905715
##              Theil&#39;s U
## Training set        NA
## Test set      0.801254</code></pre>
<pre class="r"><code>accuracy(beerfit2, beer3)</code></pre>
<pre><code>##                       ME     RMSE      MAE         MPE     MAPE     MASE
## Training set   0.4761905 65.31511 54.73016  -0.9162496 12.16415 3.827284
## Test set     -51.4000000 62.69290 57.40000 -12.9549160 14.18442 4.013986
##                     ACF1 Theil&#39;s U
## Training set -0.24098292        NA
## Test set     -0.06905715  1.254009</code></pre>
<pre class="r"><code>accuracy(beerfit3, beer3)</code></pre>
<pre><code>##                     ME     RMSE  MAE        MPE     MAPE      MASE       ACF1
## Training set -2.133333 16.78193 14.3 -0.5537713 3.313685 1.0000000 -0.2876333
## Test set      5.200000 14.31084 13.4  1.1475536 3.168503 0.9370629  0.1318407
##              Theil&#39;s U
## Training set        NA
## Test set      0.298728</code></pre>
<p>It is obvious from the graph that the seasonal naïve method is best for these data, although it can still be improved, as we will discover later. Sometimes, different accuracy measures will lead to different results as to which forecast method is best. However, in this case, all of the results point to the seasonal naïve method as the best of these three methods for this data set.</p>
</div>
</div>
</div>
<div id="spatial" class="section level1">
<h1><strong>SPATIAL</strong></h1>
<div id="spatial-data-types" class="section level2">
<h2>SPATIAL DATA TYPES</h2>
<div id="point-pattern" class="section level3">
<h3>point-pattern</h3>
<p>The goal of point pattern analysis is to determine whether/where the observed pattern is different from what would be expected by random chance</p>
</div>
<div id="lattice" class="section level3">
<h3>lattice</h3>
<p>• Usually consists of areal data (polygons) • Aggregate data (sum, mean, etc.) for each area • Very common in public health surveillance</p>
</div>
<div id="geostatistical" class="section level3">
<h3>geostatistical</h3>
<p>Analysis aims to characterize spatial variation and predict values at unobserved locations</p>
<ul>
<li><p>measures of location/ center</p>
<ul>
<li><p>mean center: arithmetic average of x and y coordinates of all features</p></li>
<li><p>weighted mean center: e.g., by disease prevalence or population</p></li>
<li><p>median center: identifies a point location that minimizes the Euclidean distance to all features</p></li>
<li><p>central feature: feature that minimizes distances to all other features</p></li>
<li><p>centroid: “Center of gravity” for areal units; arithmetic mean of all [hypothetical] points within the feature (not simply the vertices)</p></li>
</ul></li>
<li><p>measures of dispersion</p>
<ul>
<li><p>bounding box: total range of x and y values</p></li>
<li><p>convex hull: Smallest convex polygon that encloses a group of geometries (imagine rubber band around the shape: the band would define straight lines between the outermost points)</p></li>
<li><p>standard distance: radius from the mean center</p></li>
<li><p>standard deviational ellipse</p></li>
</ul></li>
</ul>
</div>
</div>
<div id="clustering" class="section level2">
<h2>CLUSTERING</h2>
<div id="definitions" class="section level3">
<h3>definitions</h3>
<p><strong>Cluster</strong>: an unusual aggregation, real or perceived, of health events that are grouped together in time and space, or both.</p>
<p><strong>Spatial point process</strong>: set of locations irregularly distributed within a region and generated by some stochastic (i.e., random) mechanism in d-dimensional space (usually d=2 or d=3) (adapted from Diggle, 2003). Ex Poisson process</p>
<p><strong>Spatial point pattern</strong> – a realization from a spatial point process (a particular collection of points from a point process) Ex a particular hospital</p>
<p><strong>Point</strong>: any location within a study area where a health event could occur</p>
<p><strong>Event</strong>: location within a study area where an event did occur</p>
<p><strong>Stationarity</strong>: Spatial point process whose properties do not vary with space: there is no spatial trend, no spatial periodicity, the covariance is the same at all locations.</p>
<p>• 1st order: No variation in intensity over space The point has the same characteristics anywhere in space • 2ndorder:No interaction between cases</p>
<p><strong>Isotropy</strong>: Spatial point process whose properties do not vary with direction: relationships among events depend only on distance, not direction (the process is invariant to rotations).</p>
<p><strong>Spatial dependence</strong>:propensity for nearby locations to influence each other and to possess similar attributes (M. Goodchild). Ex individuals who are closer together are more likely be affected similarly.</p>
<p><strong>Spatial autocorrelation</strong>:statistical measure of similarity (correlation) between nearby observations: they can be similar or cluster together in space (positive spatial autocorrelation) or dissimilar and disperse (negative spatial autocorrelation).</p>
<p><strong>CSR</strong>: complete spatial randomness.</p>
</div>
<div id="spatial-autocorrelation" class="section level3">
<h3>spatial autocorrelation</h3>
<p>In traditional statistics, two of the foremost assumptions/conditions are that samples must be random and independent</p>
<p>– Randomness implies no systematic patterns beyond those explained by a statistical model</p>
<p>– Independence implies that the outcome of one event does not impact the probability of the outcome for a second event (e.g. rolling dice)</p>
<p>Spatial data almost always violate these fundamental requirements. e.g. the temperature in Davis is likely to be similar to the temperature in Sacramento</p>
<p><strong>Spatial autocorrelation</strong> measures the extent to which the occurrence of an event in a spatial unit alters the probability of events in neighboring units.</p>
<p>With such redundancy in the data, each new data point provides less information than expected based on n, the sample size.</p>
<p>Potential consequence of ignoring the spatial dependence in a statistical analysis is to underestimate errors and to overestimate statistical significance levels. It increases the risk of making a Type I error – Reject H0 when it is true (False Positive)</p>
</div>
</div>
<div id="global-tests" class="section level2">
<h2>global tests</h2>
<p>whether data are spatially autocorrelated</p>
<div id="g-function-nearest-neighbor-index" class="section level3">
<h3>g function = nearest neighbor index</h3>
<p><strong>data type</strong>: for point data</p>
<p><strong>evaluate</strong>: Calculating the average distance between features = measures the distribution of distances from an arbitrary point (e.g., case) to its nearest neighbor and compares to simulated values from random distributions.</p>
<p><strong>result</strong>: Nearest neighbor index, z-score</p>
<p><strong>caveats</strong>: Results may be biased if there are many features near edge of study area</p>
<p><img src="notes%20screenshots/Lect5B_GlobalTestsforSpatialClustering1.jpg" /></p>
</div>
<div id="ripleys-k-and-l-functions" class="section level3">
<h3>ripley’s k and l functions</h3>
<p><strong>data type</strong>: for point data</p>
<p><strong>evaluate</strong>: Counts the number of features within defined distances = summarizes spatial dependence (clustering or dispersion) over a range of distances</p>
<p>Step1: measure the distribution of distances from an arbitrary point (e.g., case) to its nearest neighbor</p>
<p>Step2: Compare the observed patterns of cases with that generated by a homogenous Poisson process. Uses multiple simulations to create a random distribution envelope</p>
<p><strong>result</strong>: K-function.</p>
<p><strong>caveats</strong>: Patterns are suspect at larger distances due to edge effects</p>
<p><img src="notes%20screenshots/Lect5B_GlobalTestsforSpatialClustering2.jpg" /></p>
</div>
<div id="cuzik-edwards-test" class="section level3">
<h3>cuzik-edwards test</h3>
<p><strong>data type</strong>: for point data</p>
<p><strong>evaluate</strong>: the total number of case pairs within q nearest neighbors</p>
<p><img src="notes%20screenshots/Lect5B_GlobalTestsforSpatialClustering3.jpg" /></p>
</div>
<div id="global-morans-i" class="section level3">
<h3>global moran’s i</h3>
<p><strong>data type</strong>: for point or aggregated data</p>
<p><strong>evaluate</strong>: weighted average of similarity between observations: calculate the similarity of values at locations i and j then weight the similarity by the proximity of locations i and j</p>
<p>summarize the degree to which similar observations tend to occur near each other</p>
<p>Compares the value of the variable at any one location/zone with the value at all other locations or zones.</p>
<p>Similar to Pearson’s correlation but not bounded on [-1, 1] because of the spatial weights</p>
<p>Null hypothesis: NO spatial association (~CSR)</p>
<p>Commonly used to test whether regression residuals are spatially autocorrelated. If so, additional covariates may be needed for spatial structure may be introduced through random effects</p>
<p><strong>what inputs to use?</strong></p>
<p>determine the distance that will ensure each feature has at least one neighbor: calculate the nearest-neighbor distance for every household and report average and maximum distance.</p>
<p><em>beginning distance</em>: use the maximum distance that ensures each feature has at least one neighbor</p>
<p><em>distance increment</em>: average distance between features.</p>
<p><em>distance method</em>: euclidean.</p>
<p><img src="notes%20screenshots/Lect6A_SpatialAutocorrelation1.jpg" /> <img src="notes%20screenshots/Lect6A_SpatialAutocorrelation2.jpg" /></p>
<p><img src="notes%20screenshots/Lect6A_SpatialAutocorrelation3.jpg" /></p>
<p><strong>result</strong>: Statistic to evaluate spatial autocorrelation globally</p>
<p><span class="math display">\[z_I = \frac{I-E[I]}{\sqrt{V[I]}}\]</span> I = Observed Moran’s I</p>
<p>E[I]= Expected Moran’s I</p>
<p><span class="math inline">\(\sqrt{V[I]}\)</span> = standard error of Moran’s I</p>
<p>Z-scores are standard deviations and can be plotted on a normal curve. The smaller the number (-26 is smaller than -5) the farther down on the tail of the normal curve the z-score falls; the area under the curve gets very small in the tails and this area represents the probability that the spatial pattern of your points is randomly distributed. A z-score of 0 would fall right in the middle of the curve, in the location with the largest area under the curve and so the probability that the spatial pattern is random would be large. With very small z-scores there is a very small probability (less than 1% likelihood) that the spatial pattern is random. For this tool, when the z-score is in the left tail, the spatial pattern is more clustered than we would find with a random pattern. If the z-score is positive, in the right tail, the spatial pattern is more dispersed than we would find in a random pattern.</p>
<p>The z-score calculation is strongly influenced by the size of the study area. So the best way to use this tool is to compare different distributions within a fixed study area. In our case, we are comparing the spatial pattern of homes to the spatial pattern of Dengue fever cases and we find that the clustering is much more intense for the Dengue fever cases than it is for the homes. We can conclude, then, that the spatial pattern of dengue fever cases is clustered, and that the observed clustering is more pronounced than we would expect, given the underlying clustering of the homes.</p>
<p><strong>caveats</strong>: Results may be biased if there are many features near edge of study area</p>
</div>
</div>
<div id="local-test" class="section level2">
<h2>local test</h2>
<p>where is the spatial autocorrelation occurring?</p>
<div id="anselin-morans-i" class="section level3">
<h3>anselin moran’s i</h3>
<p>cluster and outlier analysis</p>
<p><strong>data type</strong>: point or polygons (in which case it uses the centroid)</p>
<p><strong>evaluate</strong>: Method is similar to the Global Moran’s I. It compares each value in a pair of neighbors to the mean value for all of the features in the study area. Emphasizes how features differ from the values in the study area as a whole</p>
<p><strong>result</strong>:</p>
<ul>
<li><p>local moran’s i value:</p>
<ul>
<li><p>positive I = clustered: a feature is surrounded by features with similar values, high or low</p></li>
<li><p>negative I = outlier: a feature is surrounded by features with dissimilar values</p></li>
</ul></li>
<li><p>z-score</p></li>
<li><p>p-value</p></li>
<li><p>cluster type code (COType)</p>
<ul>
<li><p>HH: cluster of high values</p></li>
<li><p>LL: cluster of low values</p></li>
<li><p>HL: high outlier value surrounded by primarily low values</p></li>
<li><p>LH: low outlier value surrounded by primarily high values</p></li>
</ul></li>
</ul>
<p><img src="notes%20screenshots/Lect6B_Local%20tests%20for%20spatial%20clustering1.jpg" /></p>
<p><strong>caveats</strong>: Use this tool when you desire a graphic output on the map, and the suspected clustering is due to both location and an attribute associated with the features</p>
</div>
<div id="getis-ord-hotspot-analysis-gi" class="section level3">
<h3>getis-ord hotspot analysis (Gi*)</h3>
<p><strong>data type</strong>: points or areas.</p>
<p><strong>evaluate</strong>:</p>
<p>Looks at each feature within the context of neighboring features. A feature with a high value may not be a statistically significant hot spot unless it is also surrounded by other features with high values.</p>
<p>The local sum for a feature and its neighbors is compared proportionally to the sum of all features; when the local sum is much different than the expected local sum, and that difference is too large to be the result of random chance, a statistically significant Z score results.</p>
<p><strong>result</strong>:</p>
<ul>
<li><p>p-value</p></li>
<li><p>z-score</p></li>
</ul>
<p>The larger the z-score, the more intense the clustering of high values (a hot spot)</p>
<p>The smaller the z-score the more intense the clustering of low values (a cold spot)</p>
<p><img src="notes%20screenshots/Screen%20Shot%202021-01-09%20at%2017.40.40.png" /></p>
<p><strong>caveats</strong>:</p>
<p>The hardest part is to determine the correct distance &amp; conceptualization of the spatial relationships.</p>
<p>Fixed Distance Band is the preferred method.</p>
<p>Larger distances will tend to create larger hot/cold spots.</p>
<p>Smaller distances will tend to make multiple small hot/cold spots</p>
<p>By creating a rate or ratio prior to analysis, you can control for certain expected relationships (e.g., the number of crimes is a function of population; the number of foreclosures is a function of housing stock) and identify unexpected hot/cold spots.</p>
</div>
</div>
<div id="space-time" class="section level2">
<h2>space-time</h2>
<p>Does clustering in space depend on the time period?</p>
<p>Analogous to other tests for interaction</p>
<p>Null expectation is usually based on the fraction of events (e.g., cases) in a particular time period multiplied by the fraction of events in an particular unit of space</p>
<div id="knox-test" class="section level3">
<h3>knox test</h3>
<p>Do we have more cases that are “close” in space and time than we expect by random chance?</p>
<p><strong>evaluate</strong>:</p>
<ol style="list-style-type: decimal">
<li><p>First, we must calculate the spatial and temporal separation of all case pairs for n points of interest.</p></li>
<li><p>Then we define two thresholds, one for space and one for time, for what is considered “near”, usually based on biological knowledge of the system</p></li>
<li><p>Dichotomize the distances into “near” and “far” in both space and time to produce a 2 x 2 contingency table</p></li>
</ol>
<p><img src="notes%20screenshots/Lect7A_Clustering_in_Space_and_Time1.jpg" /></p>
<p><strong>result</strong>:</p>
<ul>
<li><p>knox test statistic</p></li>
<li><p>poisson, chi-square or monte-carlo simulation result.</p></li>
</ul>
<p><img src="notes%20screenshots/Lect7A_Clustering_in_Space_and_Time2.jpg" /></p>
<p><strong>caveats</strong>: you need to choose a distance you determine is close or far.</p>
</div>
<div id="mantel-test" class="section level3">
<h3>mantel test</h3>
<p>generalization of the knox test that does not require dichotomization of the spatial and temporal distances.</p>
<p><strong>evaluate</strong>:</p>
<p><span class="math display">\[Z_M = \sum_{i-1}^{n-1}\sum_{j=i+1}^{n}s_{ij}t_{ij}\]</span></p>
<p>Significance can be tested by randomly reassigning values in space and time by Monte Carlo sampling.</p>
</div>
<div id="space-time-scan-statistic-satscan" class="section level3">
<h3>space-time scan statistic: SaTScan</h3>
<p>Scan statistics are used to detect and evaluate clusters of cases in either a purely temporal, purely spatial or space-time setting. This is done by gradually scanning a window across time and/or space, noting the number of observed and expected observations inside the window at each location, defined by a cylindrical window with a circular geographic base and height corresponding to time:</p>
<ul>
<li><p>Base reflects the spatial window of potential clusters</p></li>
<li><p>Height reflects the time period of potential clusters</p></li>
</ul>
<p>The cylindrical window is then moved in space and time, so that for each possible geographic location and size, it also considers each possible continuous time period. In effect, we obtain an infinite number of overlapping cylinders of different size, where each cylinder represents a possible cluster</p>
<p>H0: Risk inside the cylinder = Risk outside the cylinder</p>
<p>For each cylinder, the # of cases inside and outside are compared with the expected number, potentially adjusted for the population at risk, and the likelihood is calculated. Cylinders that represent high-risk clusters (unlikely by random chance) are identified, in order of the likelihood that they represent a cluster. Significance is determined by Monte Carlo simulation</p>
<p><strong>discrete scan statistics</strong></p>
<p>Based on data observed at discrete locations that are considered to be non-random, as defined by a regular or irregular lattice of location points. That is, the locations of the observations are considered to be fixed, and we evaluate the spatial randomness of the observation conditioning on the lattice.</p>
<p>The data may be either aggregated at the census tract, zip code, county or other geographical level, or there may be unique coordinates for each observation. SaTScan adjusts for the underlying spatial inhomogeneity of a background population. It can also adjust for any number of categorical covariates provided by the user, as well as for temporal trends, known space-time clusters and missing data. It is possible to scan multiple data sets simultaneously to look for clusters that occur in one or more of them.</p>
<ul>
<li><strong>discrete Poisson model</strong>: where the number of events in a geographical location is Poisson-distributed, according to a known underlying population at risk. the user must specify a population size for each location (population file). The population may vary over time.</li>
</ul>
<p>Example: For the discrete Poisson model, cases may be stroke occurrences while the population is the combined number of person-years lived, calculated as 1 for someone living in the area for the whole time period and 1⁄2 for someone dying or moving away in the middle of the time period. The discrete Poisson model requires case and population counts for a set of data locations such as counties, parishes, census tracts or zip code areas, as well as the geographical coordinates for each of those locations. These need to be provided to SaTScan using the case, population and coordinates files. The population data need not be specified continuously over time, but only at one or more specific ‘census times’. For times in between, SaTScan does a linear interpolation based on the population at the census times immediately preceding and immediately following. For times before the first census time, the population size is set equal to the population size at that first census time, and for times after the last census time, the population is set equal to the population size at that last census time. To get the population size for a given location and time period, the population size, as defined above, is integrated over the time period in question.</p>
<ul>
<li><strong>Bernoulli model</strong>, with 0/1 event data such as cases and controls. it is necessary to specify the number of controls at each location (control file).</li>
</ul>
<p>Example: For the Bernoulli model, cases may be newborns with a certain birth defect while controls are all newborns without that birth defect.</p>
<p><strong>continuous scan statistics</strong></p>
<ul>
<li><strong>continuous Poisson model</strong>:</li>
</ul>
<p>In continuous scan statistics, observations may be located anywhere within a study area, such as a square or rectangle. The stochastic aspect of the data consists of these random spatial locations, and we are interested to see if there are any clusters that are unlikely to occur if the observations where independently and randomly distributed across the study area. Under the null hypothesis, the observations follow a homogeneous spatial Poisson process with constant intensity throughout the study area, with no observations falling outside the study area.</p>
<p>Example: The data may consist of the location of bird nests in a square kilometer area of a forest. The interest may be to see whether the bird nests are randomly distributed spatially, or in other words, whether there are clusters of bird nests or whether they are located independently of each other.</p>
<p><em>Discrete versus Homogeneous Poisson Model</em></p>
<p>Instead of using the homogeneous Poisson model, the data can be approximated by the discrete Poisson model by dividing the study area into many small pieces. For each piece, a single coordinates point is specified, the size of the piece is used to define the population at that location and the number of observations within that small piece of area is the number of cases in that location. As the number of pieces increases towards infinity, and hence, as their size decreases towards zero, the discrete Poisson model will be asymptotically equivalent to the homogeneous Poisson model.</p>
<p><strong>likelihood ratio test</strong></p>
<p>The likelihood function is maximized over all window locations and sizes, and the one with the maximum likelihood constitutes the most likely cluster. This is the cluster that is least likely to have occurred by chance. The likelihood ratio for this window constitutes the maximum likelihood ratio test statistic. Its distribution under the null-hypothesis is obtained by repeating the same analytic exercise on a large number of random replications of the data set generated under the null hypothesis. The p-value is 14 obtained through Monte Carlo hypothesis testing , by comparing the rank of the maximum likelihood from the real data set with the maximum likelihoods from the random data sets. If this rank is R, then p = R / (1 + #simulation). In order for p to be a ‘nice looking’ number, the number of simulations is restricted to 999 or some other number ending in 999 such as 1999, 9999 or 99999. That way it is always clear whether to reject or not reject the null hypothesis for typical cut-off values such as 0.05, 0.01 and 0.001.</p>
<ul>
<li>under the Poisson assumption</li>
</ul>
<p><span class="math display">\[(\frac{c}{E[c]})^c(\frac{C-c}{C-E[c]})^{C-c}I()\]</span> where C is the total number of cases, c is the observed number of cases within the window and E[c] is the covariate adjusted expected number of cases within the window under the null-hypothesis. Note that since the analysis is conditioned on the total number of cases observed, C-E[c] is the expected number of cases outside the window. I() is an indicator function. When SaTScan is set to scan only for clusters with high rates, I() is equal to 1 when the window has more cases than expected under the null-hypothesis, and 0 otherwise.</p>
<p><strong>inputs</strong></p>
<p>For each grid point, the radius of the window varies continuously in size from zero to some upper limit specified by the user. In this way, the circular window is flexible both in location and size. In total, the method creates an infinite number of distinct geographical circles with different sets of neighboring data locations within them. Each circle is a possible candidate cluster.</p>
</div>
</div>
<div id="spatial-regression" class="section level2">
<h2>SPATIAL REGRESSION</h2>
<p>Examine how phenomena vary over space (where things actually occur)</p>
<p>• Predict where phenomena may occur</p>
<p>• Help explain the factors behind observed spatial patterns</p>
<div id="ordinary-least-squares-ols" class="section level3">
<h3>Ordinary Least Squares = OLS</h3>
<ul>
<li><p>Global regression model</p></li>
<li><p>One equation, calibrated using data from all features</p></li>
<li><p>Relationships are fixed</p></li>
</ul>
<p>Spatial dependence suggests many statistical tools and inferences are inappropriate</p>
<p>– OLS regressions assume that the observations are independent realizations of the process being studied</p>
<p>– If the observations are spatially clustered, the estimates obtained from the OLS estimator will be:</p>
<p>• Biased: because the areas with higher concentration of events will have a greater impact on the model estimate</p>
<p>• Overly precise: since events tend to be concentrated, there are actually fewer number of independent observations than are being assumed</p>
<p><strong>CHECK IF YOUR MODEL IS VALID</strong></p>
<ol style="list-style-type: decimal">
<li>Model performance</li>
</ol>
<ul>
<li><p>R-squared</p></li>
<li><p>relatively low AIC</p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Spatial autocorrelation of residuals:</li>
</ol>
<p>– When you are missing variables, you see a pattern in the residuals (clustering)</p>
<p>– When you have a properly specified model, the residuals reflect random noise</p>
<ul>
<li><p><strong>Moran’s I</strong> to look for clustering of resuduals.</p></li>
<li><p><strong>Jarque-Bera test</strong></p></li>
</ul>
<p>The residuals of a good model should be normally distributed with a mean of zero</p>
<p>When the Jarque-Bera test is statistically significant:</p>
<p>– The model is biased</p>
<p>– Results are not reliable</p>
<p>– Often indicates that a key variable is missing from the model</p>
<ol start="3" style="list-style-type: decimal">
<li><p>Coefficients have expecteds sign.</p></li>
<li><p>Coefficients ares tatistically significant.</p></li>
<li><p>Variables aren’t reduntant or collinear.</p></li>
</ol>
<ul>
<li><p>scatterplot matrix</p></li>
<li><p><strong>Variance Inflation Factor = VIF</strong></p></li>
</ul>
<p>Explanatory variables with a VIF &gt; 7.5 should be removed one by one, until the redundancy is gone</p>
<ol start="6" style="list-style-type: decimal">
<li>Relationships don’t vary significantly accross the study area.</li>
</ol>
<ul>
<li><strong>Koenker statistic</strong></li>
</ul>
<p>when significant it shows that we have regional variation (non-stationarity) for the relationships we are modeling</p>
<p>– The robust probabilities are still significant (so it is reasonable to trust our model)</p>
<p>– But we can do better! We can move from a global regression model (OLS) to a method that allows regional variation – Geographically Weighted Regression</p>
</div>
<div id="geographically-weighted-regression-gwr" class="section level3">
<h3>Geographically Weighted Regression = GWR</h3>
<p>For each explanatory variable, GWR creates a coefficient surface showing where the relationships are the strongest.</p>
<p>– Local regression model</p>
<p>– One equation for every feature, calibrated using data from nearby features</p>
<p>– Relationships are allowed to vary across the study area</p>
<p><strong>differences between OLS and GWR</strong></p>
<ul>
<li><p>Do not include spatial regime (dummy) variables. Eg. Census tracts within the urban core are 1 and those outside are 0. GWR will capture the spatial effects without those variables (using them creates local collinearity)</p></li>
<li><p>Avoid explanatory variables with little value variation: They tend to have problems with local redundancy</p></li>
<li><p>Avoid multicollinearity</p></li>
</ul>
<p>• Two variables telling the same story</p>
<p>• Review GWR output for ‘condition’ numbers. Those &gt; 30 indicate local variable redundancy problems</p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
